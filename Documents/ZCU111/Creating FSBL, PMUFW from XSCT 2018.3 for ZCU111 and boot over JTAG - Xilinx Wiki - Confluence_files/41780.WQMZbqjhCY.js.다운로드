"use strict";(self._cf=self._cf||[]).push([[41780],{103206:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(122551),n=s(733437),i=s(269375);const o=(0,r.memo)((({children:e,testId:t,isBold:s=!1,appearance:o="default",maxWidth:a=200,style:l})=>{const u=s?"bold":"subtle",d=o in c[u]?o:"default",f="string"==typeof a?a:`${a}px`,p="string"==typeof a&&/%$/.test(a);return r.createElement(n.Z,{as:"span",display:"inlineFlex",backgroundColor:c[u][d],borderRadius:"normal",paddingInline:"space.050",position:"static",testId:t,overflow:"hidden",UNSAFE_style:{backgroundColor:null==l?void 0:l.backgroundColor,maxWidth:p?a:"100%"}},r.createElement(i.Z,{fontSize:"size.050",fontWeight:"bold",lineHeight:"lineHeight.100",textTransform:"uppercase",color:h[u][d],shouldTruncate:!0,UNSAFE_style:{color:null==l?void 0:l.color,maxWidth:p?"100%":`calc(${f} - var(--ds-space-100, 8px))`},testId:t&&`${t}--text`},e))}));o.displayName="Lozenge";const a=o,c={bold:{default:"neutral.bold",inprogress:"information.bold",moved:"warning.bold",new:"discovery.bold",removed:"danger.bold",success:"success.bold"},subtle:{default:"neutral",inprogress:"information",moved:"warning",new:"discovery",removed:"danger",success:"success"}},h={bold:{default:"inverse",inprogress:"inverse",moved:"warning.inverse",new:"inverse",removed:"inverse",success:"inverse"},subtle:{default:"subtle",inprogress:"information",moved:"warning",new:"discovery",removed:"danger",success:"success"}}},893547:(e,t,s)=>{s.d(t,{p:()=>r});const r="fabric-elements"},845130:(e,t,s)=>{s.d(t,{bj:()=>f,a3:()=>u,Hb:()=>d,ZP:()=>p});var r=s(991332),n=s(319209),i=s(978699),o=s(923924),a=s(822814),c=s(26011),h=s.n(c);const l=()=>({params:{},headers:{}});class u{constructor(){this.changeListeners=new Map,this.allResultsListeners=new Map,this.errListeners=new Map,this.infoListeners=new Map,this.analyticsListeners=new Map}subscribe(e,t,s,r,n,i){t&&this.changeListeners.set(e,t),s&&this.errListeners.set(e,s),r&&this.infoListeners.set(e,r),n&&this.allResultsListeners.set(e,n),i&&this.analyticsListeners.set(e,i)}unsubscribe(e){this.changeListeners.delete(e),this.errListeners.delete(e),this.infoListeners.delete(e),this.allResultsListeners.delete(e),this.analyticsListeners.delete(e)}}class d extends u{shouldHighlightMention(e){return!1}filter(e){throw new Error(`not yet implemented.\nParams: query=${e}`)}recordMentionSelection(e){}isFiltering(e){return!1}_notifyListeners(e,t){(0,o.ZP)("ak-mention-resource._notifyListeners",e&&e.mentions&&e.mentions.length,this.changeListeners),this.changeListeners.forEach(((s,r)=>{try{s(e.mentions.slice(0,20),e.query,t)}catch(n){(0,o.ZP)(`error from listener '${r}', ignoring`,n)}}))}_notifyAllResultsListeners(e){(0,o.ZP)("ak-mention-resource._notifyAllResultsListeners",e&&e.mentions&&e.mentions.length,this.changeListeners),this.allResultsListeners.forEach(((t,s)=>{try{t(e.mentions.slice(0,20),e.query)}catch(r){(0,o.ZP)(`error from listener '${s}', ignoring`,r)}}))}_notifyErrorListeners(e,t){this.errListeners.forEach(((s,r)=>{try{s(e,t)}catch(n){(0,o.ZP)(`error from listener '${r}', ignoring`,n)}}))}_notifyInfoListeners(e){this.infoListeners.forEach(((t,s)=>{try{t(e)}catch(r){(0,o.ZP)(`error from listener '${s}', ignoring`,r)}}))}_notifyAnalyticsListeners(e,t,s,r){this.analyticsListeners.forEach(((n,i)=>{try{n(e,t,s,r)}catch(a){(0,o.ZP)(`error from listener '${i}', ignoring`,a)}}))}}const f=e=>!!(e&&e.supportsMentionNameResolving&&e.supportsMentionNameResolving()),p=class extends d{constructor(e){super(),this.verifyMentionConfig(e),this.config=e,this.lastReturnedSearch=0,this.activeSearches=new Set,this.productName=e.productName,this.shouldEnableInvite=!!e.shouldEnableInvite,this.inviteExperimentCohort=e.inviteExperimentCohort,this.onInviteItemClick=e.onInviteItemClick,this.userRole=e.userRole||"basic",this.config.debounceTime&&(this.filter=h()(this.filter,this.config.debounceTime))}shouldHighlightMention(e){return!!this.config.shouldHighlightMention&&this.config.shouldHighlightMention(e)}notify(e,t,s){if(e>this.lastReturnedSearch)this.lastReturnedSearch=e,this._notifyListeners(t,{duration:Date.now()-e});else{const t=new Date(e).toISOString().substr(17,6);(0,o.ZP)("Stale search result, skipping",t,s)}this._notifyAllResultsListeners(t)}notifyError(e,t){this._notifyErrorListeners(e,t),t&&this.activeSearches.delete(t)}async filter(e,t){try{const s=Date.now();let r;if(e){this.activeSearches.add(e);const s=this.search(e,t);r=await s.mentions}else r=await this.initialState(t);this.notify(s,r,e)}catch(s){this.notifyError(s,e)}}recordMentionSelection(e,t){return this.recordSelection(e,t).then((()=>{}),(e=>(0,o.ZP)(`error recording mention selection: ${e}`,e)))}isFiltering(e){return this.activeSearches.has(e)}resolveMentionName(e){return this.config.mentionNameResolver?this.config.mentionNameResolver.lookupName(e):{id:e,name:"",status:i.dP.UNKNOWN}}cacheMentionName(e,t){this.config.mentionNameResolver&&this.config.mentionNameResolver.cacheName(e,t)}supportsMentionNameResolving(){return!!this.config.mentionNameResolver}updateActiveSearches(e){this.activeSearches.add(e)}verifyMentionConfig(e){if(!e.url)throw new Error("config.url is a required parameter");e.securityProvider||(e.securityProvider=l)}initialState(e){return this.remoteInitialState(e)}clearContext(e={}){return Object.keys(e).filter((t=>e[t])).reduce(((t,s)=>(0,r.Z)({[s]:e[s]},t)),{})}getQueryParams(e){const t={};return this.config.containerId&&(t.containerId=this.config.containerId),this.config.productId&&(t.productIdentifier=this.config.productId),(0,r.Z)((0,r.Z)({},t),this.clearContext(e))}async remoteInitialState(e){const t={path:"bootstrap",queryParams:this.getQueryParams(e)};try{const e=await n.utils.requestService(this.config,t);return this._notifyAnalyticsListeners(a.oX,a.O3.INITIAL_STATE,a.eX.SUCCEEDED),this.transformServiceResponse(e,"")}catch(s){throw this._notifyAnalyticsListeners(a.oX,a.O3.INITIAL_STATE,a.eX.FAILED),s}}search(e,t){return{mentions:this.remoteSearch(e,t)}}async remoteSearch(e,t){const s={path:"search",queryParams:(0,r.Z)({query:e,limit:100},this.getQueryParams(t))};try{const t=await n.utils.requestService(this.config,s);return this._notifyAnalyticsListeners(a.oX,a.O3.SEARCH,a.eX.SUCCEEDED),this.transformServiceResponse(t,e)}catch(i){throw this._notifyAnalyticsListeners(a.oX,a.O3.SEARCH,a.eX.FAILED),i}}transformServiceResponse(e,t){const s=e.mentions.map((e=>{let s;return((0,i.Lp)(e)||(0,i.kK)(e))&&(s=e.userType),(0,r.Z)((0,r.Z)({},e),{},{lozenge:s,query:t})}));return(0,r.Z)((0,r.Z)({},e),{},{mentions:s,query:e.query||t})}async recordSelection(e,t){const s={path:"record",queryParams:(0,r.Z)({selectedUserId:e.id},this.getQueryParams(t)),requestInit:{method:"POST"}},o=(0,i.kK)(e)?a.O3.SELECT_TEAM:a.O3.SELECT;try{const e=await n.utils.requestService(this.config,s);return this._notifyAnalyticsListeners(a.oX,o,a.eX.SUCCEEDED),e}catch(c){throw this._notifyAnalyticsListeners(a.oX,o,a.eX.FAILED),c}}}},513100:(e,t,s)=>{s.d(t,{ZP:()=>u});var r=s(29298),n=s(923924),i=s(845130);class o{constructor(e,t){this.presence=e,this.expiry=Date.now()+t}expired(){return Date.now()>this.expiry}}class a extends i.a3{refreshPresence(e){throw new Error(`not yet implemented.\nParams: userIds=${e}`)}notifyListeners(e){this.changeListeners.forEach(((t,s)=>{try{t(e)}catch(r){(0,n.ZP)(`error from listener '${s}', ignoring`,r)}}))}}class c extends a{constructor(e){if(super(),!e.url)throw new Error("config.url is a required parameter");if(!e.cloudId)throw new Error("config.cloudId is a required parameter");this.config=e,this.config.url=c.cleanUrl(e.url),this.presenceCache=e.cache||new h(e.cacheExpiry),this.presenceParser=e.parser||new l}refreshPresence(e){const t=this.presenceCache.getBulk(e);this.notifyListeners(t);const s=this.presenceCache.getMissingUserIds(e);s.length&&this.retrievePresence(s)}retrievePresence(e){this.queryDirectoryForPresences(e).then((e=>this.presenceParser.parse(e))).then((e=>{this.notifyListeners(e),this.presenceCache.update(e)}))}queryDirectoryForPresences(e){const t={query:"query getPresenceForMentions($organizationId: String!, $userIds: [String!], $productId: String) {\n                PresenceBulk(organizationId: $organizationId, product: $productId, userIds: $userIds) {\n                  userId\n                  state\n                  stateMetadata\n                }\n              }",variables:{organizationId:this.config.cloudId,userIds:e}};this.config.productId&&(t.variables.productId=this.config.productId);const s={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)};return fetch(this.config.url,s).then((e=>e.json()))}static cleanUrl(e){return"/"!==e.substr(-1)&&(e+="/"),e}}class h{constructor(e,t){this.expiryInMillis=e||h.defaultTimeout,this.flushTrigger=t||h.defaultFlushTrigger,this.cache={},this.size=0}_delete(e){delete this.cache[e],this.size--}_deleteIfExpired(e){this.contains(e)&&this.cache[e].expired()&&this._delete(e)}_removeExpired(){Object.keys(this.cache).forEach((e=>{this._deleteIfExpired(e)}))}contains(e){return this.cache.hasOwnProperty(e)}get(e){return this._deleteIfExpired(e),this.contains(e)?this.cache[e].presence:{}}getBulk(e){const t={};for(const s of e)this.contains(s)&&(t[s]=this.get(s));return t}getMissingUserIds(e){return e.filter((e=>!this.contains(e)))}update(e){this.size>=this.flushTrigger&&this._removeExpired(),Object.keys(e).forEach((t=>{this.cache[t]=new o(e[t],this.expiryInMillis),this.size++}))}}(0,r.Z)(h,"defaultTimeout",2e4),(0,r.Z)(h,"defaultFlushTrigger",50);class l{mapState(e){return"unavailable"===e?"offline":"available"===e?"online":e}parse(e){const t={};if(e.hasOwnProperty("data")&&e.data.hasOwnProperty("PresenceBulk")){const s=e.data.PresenceBulk;for(const e of s)if(e.userId&&e.state){const s=l.extractState(e)||e.state;t[e.userId]={status:this.mapState(s)}}else e.hasOwnProperty("userId")&&e.hasOwnProperty("state")||console.error("Unexpected response from presence service contains keys: "+Object.keys(e))}return t}static extractState(e){return l.isFocusState(e)?l.FOCUS_STATE:e.state}static isFocusState(e){if(e.stateMetadata)try{const t=JSON.parse(e.stateMetadata);return t&&!!t.focus}catch(t){console.error(`Failed to parse presence's stateMetadata for user with id ${e.userId}: ${e.stateMetadata}`),console.error(t)}return!1}}(0,r.Z)(l,"FOCUS_STATE","focus");const u=c},978699:(e,t,s)=>{let r,n,i,o;function a(e){return!!e&&e===n[n.NONE]}function c(e){return!!e.userType&&e.userType===i[i.SPECIAL]}function h(e){return e.userType&&e.userType===i[i.APP]}function l(e){return e.userType&&e.userType===i[i.TEAM]}function u(e){return e&&("@all"===e||"@here"===e)}s.d(t,{ue:()=>r,kI:()=>n,FW:()=>i,dP:()=>o,X:()=>a,kz:()=>c,Lp:()=>h,kK:()=>l,ks:()=>u,tI:()=>d}),function(e){e[e.SELF=0]="SELF",e[e.RESTRICTED=1]="RESTRICTED",e[e.DEFAULT=2]="DEFAULT"}(r||(r={})),function(e){e[e.NONE=0]="NONE",e[e.SITE=1]="SITE",e[e.APPLICATION=2]="APPLICATION",e[e.CONTAINER=3]="CONTAINER"}(n||(n={})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SPECIAL=1]="SPECIAL",e[e.APP=2]="APP",e[e.TEAM=3]="TEAM",e[e.SYSTEM=4]="SYSTEM"}(i||(i={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SERVICE_ERROR=1]="SERVICE_ERROR",e[e.OK=2]="OK"}(o||(o={}));const d=e=>!(!e||!e.then)},822814:(e,t,s)=>{s.d(t,{eX:()=>d,vn:()=>u,oX:()=>c,tv:()=>h,O3:()=>l,zW:()=>y,KE:()=>g,Ng:()=>E,AW:()=>f,nU:()=>p,XK:()=>m});var r=s(991332),n=s(134545),i=s(893547);const o=JSON.parse('{"u2":"@atlaskit/mention","i8":"21.0.19"}');var a=s(978699);const c="sli",h="smart";let l,u,d;!function(e){e.SEARCH="searchUser",e.SEARCH_TEAM="searchTeam",e.INITIAL_STATE="initialState",e.SELECT="select",e.SELECT_TEAM="selectTeam"}(l||(l={})),function(e){e.TYPEAHEAD="mentionTypeahead",e.MENTION="mention",e.TEAM_MENTION_HIGHLIGHT="teamMentionHighlight"}(u||(u={})),function(e){e.VIEWED="viewed",e.CLICKED="clicked",e.CLOSED="closed",e.SUCCEEDED="succeeded",e.FAILED="failed"}(d||(d={}));const f=e=>(t,s,r=[],a)=>{if(e.createAnalyticsEvent){const c={action:t,actionSubject:u.TYPEAHEAD,attributes:{packageName:o.u2,packageVersion:o.i8,componentName:u.MENTION,duration:Math.round(s),userIds:r,queryLength:a?a.length:0},eventType:n.Ru};e.createAnalyticsEvent(c).fire(i.p)}},p=e=>(t,s,r,a,c)=>{if(e){const h={action:s,actionSubject:t,actionSubjectId:a,eventType:n._d,attributes:{source:r,packageName:o.u2,packageVersion:o.i8,componentName:u.TEAM_MENTION_HIGHLIGHT,viewedCount:c}};e(h).fire(i.p)}},g=e=>(t,s,r,c,h)=>{const l={action:s,actionSubject:t,eventType:n._d,attributes:{packageName:o.u2,packageVersion:o.i8,componentName:u.MENTION,accessLevel:h,isSpecial:(0,a.ks)(r),userId:c}},d=e(l);return d.fire(i.p),d},m=e=>(t,s)=>{if(e.createAnalyticsEvent){const r=y(t,s);e.createAnalyticsEvent(r).fire(i.p)}},y=(e,t,s)=>({action:t,actionSubject:e,eventType:n.Ru,attributes:(0,r.Z)({packageName:o.u2,packageVersion:o.i8,componentName:u.MENTION},s)}),E=e=>(t,s,r,a)=>{if(e.createAnalyticsEvent){const c={action:t,actionSubject:u.MENTION,actionSubjectId:"hydration",attributes:{packageName:o.u2,packageVersion:o.i8,componentName:u.MENTION,userId:s,fromCache:r,duration:Math.round(a)},eventType:n.Ru};e.createAnalyticsEvent(c).fire(i.p)}}},923924:(e,t,s)=>{s.d(t,{ZP:()=>n});let r=!1;function n(e,...t){r&&console.log(e,...t)}}}]);
//# sourceMappingURL=41780.WQMZbqjhCY.js.map