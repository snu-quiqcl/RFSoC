WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-edit', location = 'com/atlassian/confluence/extra/calendar3/components/calendar-restriction-dialog/calendar-restrictons-dialog.js' */
define("tc/calendar-restriction-dialog",["jquery","underscore","tc-backbone","tc/templates","tc/calendar-util","confluence-ui-components/js/user-select2"],function(f,b,g,d,c,a){var e=g.View.extend({restrictionDialog:null,calendarDiv:null,subCalendar:null,calendarPlugin:null,calendarCache:null,editDialog:null,initialize:function(h){this.calendarDiv=h.calendarDiv;this.subCalendar=h.subCalendar;this.calendarPlugin=h.calendarPlugin;this.calendarCache=h.calendarCache;this.editDialog=h.editDialog;this.$el.html(d.restrictSubCalendar({elementIdSuffix:this.calendarPlugin.getParameter(this.calendarDiv,"elementIdSuffix")}));this.editDialog.addPanel("Restrictions",this.$el,"setup-calendar-panel")},render:function(){var j=this;var h=j.calendarPlugin.getParameter(j.calendarDiv,"elementIdSuffix");this.editDialog.getCurrentPanel().onselect=function(){f("#edit-calendar-dialog").find(".button-panel-button.submit").removeClass("hidden")};var i=f("form",j.editDialog.getCurrentPanel().body);f("input[name='subCalendarId']",i).val(j.subCalendar.id||"");f(".field-group-permissions",i).each(function(){var k=f(this);f(".permissions-details",k).each(function(m){var n=f(this);a.bind(k);var l=f("#permissionsUserPicker-"+h,k);l.bind("selected",function(p){var o=function(q){if(!q.startsWith("ari:")){return"ari:cloud:identity::user/"+q}else{return q}};j._addUsersToPermissionFieldGroup(k,{id:o(p.choice.id),fullName:p.choice.text,avatarUrl:p.choice.imgSrc},true);l.val("");l.auiSelect2("data",[])}).focus(function(){if(l.hasClass("with-hint")){l.removeClass("with-hint").val("")}}).blur(function(){if(!l.val()){l.addClass("with-hint").val("Enter user name")}}).keydown(function(o){if(o.keyCode===13&&!f(".autocomplete .aui-dropdown .active").length){setTimeout(function(){var p=l.val();if(p){j._addGroupsToPermissionFieldGroup(k,p.split(","),true,true);l.val("")}else{j.submitRestrictionsDialog(j.editDialog)}},300);f(".autocomplete .aui-dropdown .no-results").trigger("click");return false}});f(".group-picker-trigger",n).click(function(){var o="Team_Calendars_group_picker_callback_"+h+"_"+m;window[o]=function(p){j._addGroupsToPermissionFieldGroup(k,p.split(","),false,true)};window.open(j.calendarPlugin.getParameter(j.calendarDiv,"baseUrl")+"/spaces/opengrouppicker.action?key=ds&startIndex=0&actionName=dosearchgroups.action&onPopupSubmit="+encodeURIComponent(o),o,"dependent=1,height=512,width=384,resizable=1,status=0").focus();return false})})});f(".field-group-permissions",i).each(function(){var l=f(this);var m=f(".option-view-restrictions",l);var k=f(".option-edit-restrictions",l);j._addUsersToPermissionFieldGroup(l,j.subCalendar.usersPermittedToEdit||[]);j._addGroupsToPermissionFieldGroup(l,j.subCalendar.groupsPermittedToEdit||[]);k.removeAttr("checked");m.attr("checked","checked");j._addUsersToPermissionFieldGroup(l,j.subCalendar.usersPermittedToView||[]);j._addGroupsToPermissionFieldGroup(l,j.subCalendar.groupsPermittedToView||[])});return j.editDialog},submitRestrictionsDialog:function(l){var m=this;var p=f("form",l.getCurrentPanel().body);var k=function(q){return f.map(f(".permitted-entity",q),function(s){var r=f(s).data("entity");return f.isPlainObject(r)?r.id:null})};var j=function(q){return f.map(f(".permitted-entity",q),function(s){var r=f(s).data("entity");return typeof r==="string"?r:null})};var i={subCalendarId:f("input[name='subCalendarId']",p).val()};c.putCalendarContextParams(i);var n=f(".view-permissions",p);if(n.length){i.updateUsersPermittedToView=true;i.usersPermittedToView=k(n);if(!i.usersPermittedToView.length){delete i.usersPermittedToView}i.updateGroupsPermittedToView=true;i.groupsPermittedToView=j(n);if(!i.groupsPermittedToView.length){delete i.groupsPermittedToView}}var o=f(".edit-permissions",p);if(o.length){i.updateUsersPermittedToEdit=true;i.usersPermittedToEdit=k(o);if(!i.usersPermittedToEdit.length){delete i.usersPermittedToEdit}i.updateGroupsPermittedToEdit=true;i.groupsPermittedToEdit=j(o);if(!i.groupsPermittedToEdit.length){delete i.groupsPermittedToEdit}}if(m.calendarPlugin.getParameter(m.calendarDiv,"include")){i.include=m.calendarPlugin.getParameter(m.calendarDiv,"include")}if(!m.calendarPlugin.isProcessingSubCalendar(m.calendarDiv)){var h=m.calendarPlugin.setSubCalendarSpinnerIconVisible(true);f.ajax({cache:false,converters:{"text json":function(q){return q}},data:i,dataType:"json",dataFilter:function(q){var r=f.parseJSON(q);if(r.success){m.calendarPlugin.mergeSubCalendarObjectsToArray(r.payload)}return r},error:function(q,s,r){m.calendarPlugin.showAjaxError(m.calendarDiv,q,s,r,m.calendarPlugin.ERROR_CLASS_SUB_CALENDAR_UPDATE);m.calendarPlugin.setProcessingSubCalendar(m.calendarDiv,false)},success:function(q){m.calendarCache.removeCalendar(m.subCalendar.id);m.calendarPlugin.setGenericErrors(m.calendarDiv,null,m.calendarPlugin.ERROR_CLASS_SUB_CALENDAR_UPDATE);m.calendarPlugin.setSubCalendars(m.calendarDiv,q.payload);m.calendarPlugin.updateAvailableSubCalendarsInSubCalendarPanel(m.calendarDiv);m.calendarPlugin.setProcessingSubCalendar(m.calendarDiv,false);l.hide()},complete:function(){if(h){h.resolve()}},type:"PUT",timeout:m.calendarPlugin.ajaxTimeout,url:m.calendarPlugin.getCalendarServiceBaseUrl(m.calendarDiv,"/subcalendars/restrictions.json")})}return false},_showHideHint:function(i){var h=f(".permission-table",i);var j=f(".permitted-entities",h);if(f(".permitted-entity",j).length){i.addClass("has-restrictions");h.removeClass("hidden")}else{i.removeClass("has-restrictions");h.addClass("hidden")}},_getRestrictionGroup:function(h){return f("input[name='restriction-type']:checked",h).val()==="view"?f(".view-permissions",h):f(".edit-permissions",h)},_addUsersToPermissionFieldGroup:function(m,o,i){var h=this;var k=h._getRestrictionGroup(m);var l=f(".permitted-entities",k);var n=function(p){return f(".permitted-entity",l).filter(function(){var q=f(this).data("entity");return f.isPlainObject(q)&&q.id===p.id}).length};var j;if(f.isPlainObject(o)){j=[o]}else{if(f.isArray(o)){j=o}}if(f.isArray(j)){f.each(j,function(q,p){if(!n(p)){var r=f(document.createElement("tr")).addClass("permitted-entity").append(f(document.createElement("td")).append(f(document.createElement("img")).attr("src",p.avatarUrl)).append(f(document.createElement("span")).addClass("full-name").text(p.fullName))).append(f(document.createElement("td")).addClass("delete-permitted-entity").append(f(document.createElement("a")).addClass("remove").attr("href","#").attr("title","Delete").text("Delete").click(function(){f(this).closest("tr").remove();h._showHideHint(k);return false}))).data("entity",p);if(i){r.prependTo(l)}else{l.append(r)}}});f(".error",m).empty()}h._showHideHint(k)},_addGroupsToPermissionFieldGroup:function(k,t,p,l){var n=this;var i=n._getRestrictionGroup(k),o=f(".permitted-entities",i),q=function(u){return f(".permitted-entity",o).filter(function(){var v=f(this).data("entity");return(typeof v==="string")&&v===u}).length},s=function(u){return f("<td/>").append(f("<span/>",{"class":"group",text:u}))};if(t.length){var h=function(u){f.each(u,function(v,x){x=f.trim(x);if(x&&!q(x)){var w=f(document.createElement("tr")).addClass("permitted-entity").append(s(x)).append(f(document.createElement("td")).addClass("delete-permitted-entity").append(f(document.createElement("a")).addClass("remove").attr("href","#").attr("title","Delete").text("Delete").click(function(){f(this).closest("tr").remove();n._showHideHint(i);return false}))).data("entity",x);if(l){w.prependTo(o)}else{o.append(w)}}})};var j=f(".error",k);if(p){var m;var r;f.ajax({cache:false,data:{groupNames:f.map(t,function(u){return f.trim(u)})},dataType:"json",success:function(u){m=u;r=f.map(t,function(v){return f.inArray(f.trim(v),m)===-1?f.trim(v):null});h(m);j.empty();if(r.length){j.text(AJS.format("Invalid group names(s) specified: {0}",r.join(", ")))}n._showHideHint(i)},type:"GET",timeout:n.calendarPlugin.ajaxTimeout,url:n.calendarPlugin.getCalendarServiceBaseUrl(n.calendarDiv,"/util/validate/group.json")})}else{j.empty();h(t);n._showHideHint(i)}}}});return e});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-edit', location = 'com/atlassian/confluence/extra/calendar3/components/calendar-edit-dialog/calendar-edit-dialog.js' */
define("tc/calendar-edit-dialog",["jquery","underscore","tc-backbone","tc/calendar-util","tc/util","tc/myCalendarTour","tc/eventtypes-edit-dialog","tc/calendar-restriction-dialog","tc/calendar-share-dialog","tc/calendar-ical-address-dialog"],function(d,k,j,g,i,h,b,f,a,e){var c=j.View.extend({subCalendarType:null,editForm:null,subCalendarTypeObj:null,editDialog:null,subCalendar:null,callbackHandler:null,submitButton:null,eventTypesEditDialogView:null,shareCalendarDialogView:null,calendarIcalAddressDialog:null,calendarDiv:null,calendarPlugin:null,calendarCache:null,restrictionDialog:null,initialize:function(l){this.options=d.extend({},this.defaults,l);if(!this.options.subCalendar){AJS.debug("tc/eventtypes-edit-dialog: requires 'subCalendar' object")}if(!this.options.callbackHandler){AJS.debug("tc/eventtypes-edit-dialog: requires 'callbackHandler' object")}this.callbackHandler=this.options.callbackHandler;this.subCalendar=this.options.subCalendar;this.subCalendarType=(typeof this.subCalendar==="string")?this.subCalendar:this.subCalendar.type;this.subCalendarTypeObj=Confluence.TeamCalendars.subcalendar[this.subCalendarType];this.calendarDiv=l.calendarDiv;this.calendarPlugin=l.calendarPlugin;this.calendarCache=l.calendarCache},render:function(){this._editCalendarDialog();if(g.isInternalSubscriptionSubCalendar(this.subCalendar)&&g.isJiraSubCalendar(this.subCalendar)){return this.editDialog}this.eventTypesEditDialogView=new b({editDialog:this.editDialog,subCalendar:this.subCalendar,callbackHandler:this.callbackHandler});this.eventTypesEditDialogView.render();this.restrictionDialog=new f({editDialog:this.editDialog,calendarPlugin:this.calendarPlugin,calendarDiv:this.calendarDiv,subCalendar:this.subCalendar,calendarCache:this.calendarCache});this.restrictionDialog.render();this.shareCalendarDialogView=new a({editDialog:this.editDialog,subCalendar:this.subCalendar,calendarPlugin:this.calendarPlugin,calendarDiv:this.calendarDiv});this.shareCalendarDialogView.render();this.calendarIcalAddressDialog=new e({editDialog:this.editDialog,subCalendar:this.subCalendar,calendarPlugin:this.calendarPlugin,calendarDiv:this.calendarDiv});this.calendarIcalAddressDialog.render();return this.editDialog},showRestrictionOption:function(){this.editDialog.gotoPanel(g.panelEditCalendar.RESTRICTION_PANEL)},showShareOption:function(){this.editDialog.gotoPanel(g.panelEditCalendar.SHARE_EMBEDDED_PANEL)},showSubscriptionOption:function(){this.editDialog.gotoPanel(g.panelEditCalendar.SUBSCRIBE_PANEL)},selectCustomEvent:function(l){this.editDialog.gotoPanel(g.panelEditCalendar.EVENT_TYPE_PANEL);this.eventTypesEditDialogView.selectCustomEvent(l)},showAddEventTypeForm:function(){this.editDialog.gotoPanel(g.panelEditCalendar.EVENT_TYPE_PANEL);this.eventTypesEditDialogView.showAddEventypeForm()},_editCalendarDialog:function(){var l=this;l.editDialog=new AJS.ConfluenceDialog({width:l.subCalendarTypeObj.dialogWidth||630,height:l.subCalendarTypeObj.dialogHeight||537,onSubmit:function(){l.editForm.submit();return false},onCancel:function(){l._callBackCancel(l.editDialog,l.callbackHandler);l.editDialog.remove()},id:"edit-calendar-dialog"});l.subCalendarTypeHandler=l.subCalendarTypeObj.getDialog(l.editDialog,d.isPlainObject(l.subCalendar)?l.subCalendar:null,l.callbackHandler);l.editDialog.popup.element.css("overflow","visible");l.editForm=l.subCalendarTypeHandler.initializeForm(k.bind(l._callBackCancel,l,l.editDialog,l.callbackHandler));l.submitButton=l.editDialog.popup.element.find(".submit");l.editForm.submit(function(){if(l.editDialog.getCurrentPanel()!==undefined){if(l.editDialog.getCurrentPanel().id===g.panelEditCalendar.GENERAL_PANEL){return l._submitCalendarEdit(l.callbackHandler,l.subCalendarTypeHandler,l.editDialog,l.editForm,l.subCalendarTypeObj)}else{if(l.editDialog.getCurrentPanel().id===g.panelEditCalendar.EVENT_TYPE_PANEL){var o=l.editDialog.getCurrentPanel().body;var n=d("form.sub-calendar-edit-event-types-form",o);var m=d("#edit-custom-event-type-form",n);if(d(m).length){d(m).find(".tooltip-warning").removeClass("hidden");d(o).scrollTop(d(m).find("form.form-add-custom").position().top);d(m).find(".custom-event-title input").focus();return false}return l._submitEventTypesEdit(n,l.editDialog,l.callbackHandler,l.subCalendarTypeHandler,l.submitButton)}else{if(l.editDialog.getCurrentPanel().id===g.panelEditCalendar.RESTRICTION_PANEL){return l._submitRestrictionEdit(l.editDialog)}}}}})},_submitCalendarEdit:function(n,o,r,t,w){if(n.isProcessingSubCalendar()){return false}n.setProcessingSubCalendar(true);var l=n.setSubCalendarSpinnerIconVisible(true);o.onSubmitStart();var p=o.getFormDataAsAjaxData();if(n.getIncludedCalendars()){p.include=n.getIncludedCalendars()}var q=p.subCalendarId;var y=p.spaceKey;var s=p.viewingSpaceKey;var v=this.subCalendar.spaceKey;var m=this.calendarPlugin;var x=this.calendarDiv;var u=this.subCalendar.childSubCalendars;d.ajax({cache:false,converters:{"text json":function(z){return z}},data:p,dataFilter:function(z){var A=d.parseJSON(z);if(A.success){g.mergeSubCalendarObjectsToArray(A.payload)}return A},dataType:"json",error:function(z,B,A){n.showAjaxUpdateError(z,B,A);o.onSubmitEnd();n.setProcessingSubCalendar(false)},success:function(z){n.setGenericUpdateError();if(z.success){g.setFieldErrors(t,null);if((y!==v)&&(s!=="")){q=z.modifiedSubCalendarId;d("input[name='subCalendarId']",t).val(q);m.removeSubCalendarEventSource(x,q);m.removeSubCalendarEventSource(x,u);n.setSubCalendars(q,z.payload)}else{if(q){n.setSubCalendars(q,z.payload);n.reloadSubCalendar(q)}else{q=z.modifiedSubCalendarId;d("input[name='subCalendarId']",t).val(q);n.setSubCalendars(q,z.payload)}}n.refreshCalendarInfo(z.payload);n.updateAvailableSubCalendarsInSubCalendarPanel();o.onSubmitEnd();r.remove()}else{g.setFieldErrors(t,z.fieldErrors);o.onSubmitEnd();if(!w.dynamicDialogHeight){i.showDialogInUpdatedHeight(r)}}n.setProcessingSubCalendar(false)},complete:function(){if(l){l.resolve()}},type:"PUT",timeout:g.ajaxTimeout,url:g.getCalendarServiceBaseUrl("/subcalendars.json")});return false},_submitEventTypesEdit:function(m,r,p,l,q){var o=this._getEventTypeData(m);var s=o.subCalendarId;var n=p.setSubCalendarSpinnerIconVisible(true);d(q).text("Updating...").attr("disabled","disabled").addClass("ui-state-disabled");d.ajax({cache:false,converters:{"text json":function(t){return t}},data:o,dataFilter:function(t){var u=d.parseJSON(t);if(u.success){g.mergeSubCalendarObjectsToArray(u.payload)}return u},dataType:"json",error:function(t,v,u){p.showAjaxUpdateError(t,v,u);l.onSubmitEnd();d(q).text("OK").removeAttr("disabled").removeClass("ui-state-disabled");AJS.trigger("remove-dialog-edit-event.teamcalendar")},success:function(t){if(t.success){if(s){p.setSubCalendar(s,t.payload);p.reloadSubCalendar(s)}p.updateAvailableSubCalendarsInSubCalendarPanel();l.onSubmitEnd();r.remove();AJS.trigger("show-dialog-edit-event.teamcalendar")}},complete:function(){if(n){n.resolve()}},type:"PUT",timeout:g.ajaxTimeout,url:g.getCalendarServiceBaseUrl("/eventtype/disable.json")});return false},_getEventTypeData:function(l){var m=this.eventTypesEditDialogView.getDisableEventTypes();return{subCalendarId:d("input[name='subCalendarId']",l).val(),disableEventTypes:m}},_callBackCancel:function(n,m){if(this.CalendarTour){this.CalendarTour.start()}var l=m.setSubCalendarSpinnerIconVisible(true);var o=d("input[name='subCalendarId']",n.getCurrentPanel().body).val();d.ajax({cache:false,converters:{"text json":function(p){return p}},data:{subCalendarId:o},dataFilter:function(p){var q=d.parseJSON(p);if(q.success){g.mergeSubCalendarObjectsToArray(q.payload)}return q},dataType:"json",error:function(p,r,q){m.showAjaxUpdateError(p,r,q)},success:function(p){if(p.success){if(o&&p.payload&&p.payload.length){d.each(p.payload,function(q,r){if(r.id===o){m.setSubCalendar(o,r);m.reloadSubCalendar(o)}})}m.updateAvailableSubCalendarsInSubCalendarPanel();AJS.trigger("show-dialog-edit-event.teamcalendar")}},complete:function(){l.resolve()},type:"GET",timeout:g.ajaxTimeout,url:g.getCalendarServiceBaseUrl("/subcalendars.json")})},_submitRestrictionEdit:function(l){this.restrictionDialog.submitRestrictionsDialog(l);return false}});return c});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:calendar-edit', location = 'com/atlassian/confluence/extra/calendar3/components/calendar-edit-dialog/calendar-edit-dialog-compat.js' */
require(["tc/calendar-edit-dialog"],function(a){if(!Confluence.TeamCalendars.Dialogs){Confluence.TeamCalendars.Dialogs={}}Confluence.TeamCalendars.Dialogs.getSubCalendarEditDialog=function(d,c,f,e,b){return new a({subCalendar:d,callbackHandler:c,calendarDiv:f,calendarPlugin:e,calendarCache:b})}});
}catch(e){WRMCB(e)};