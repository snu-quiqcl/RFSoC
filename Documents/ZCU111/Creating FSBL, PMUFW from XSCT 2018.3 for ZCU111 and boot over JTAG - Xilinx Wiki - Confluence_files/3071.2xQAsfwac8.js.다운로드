"use strict";(self._cf=self._cf||[]).push([[3071],{541580:(e,t,n)=>{n.d(t,{i:()=>s,m:()=>l});var o=n(122551);const s=(0,o.createContext)({hasContentChanged:!1,onChange:()=>{},resetContentChanged:()=>{},isCommentContentReady:!1,onCommentContentReady:()=>{}});s.displayName="CommentContentContext";const l=({children:e})=>{const[t,n]=(0,o.useState)(!1),[l,i]=(0,o.useState)(!1);return o.createElement(s.Provider,{value:{hasContentChanged:t,onChange:e=>n(e),resetContentChanged:()=>n(!1),isCommentContentReady:l,onCommentContentReady:()=>i(!0)}},e)};l.displayName="CommentContentProvider"},34868:(e,t,n)=>{n.d(t,{v:()=>o});const o=(0,n(28201).y$)({__loadable_id__:"4bSdP",name:"CommentWarningDialog",loader:async()=>(await Promise.all([n.e(12705),n.e(61769),n.e(78248),n.e(89990),n.e(12953),n.e(41476)]).then(n.bind(n,174863))).CommentWarningDialog})},328446:(e,t,n)=>{n.d(t,{l:()=>a});var o=n(991332),s=n(29298),l=n(122551),i=n(507080);class a extends i.W2{constructor(e=[]){super(),(0,s.Z)(this,"nextKey",void 0),(0,s.Z)(this,"showModal",((e,t,n)=>{this.showDialog(e,t,n)})),(0,s.Z)(this,"showDialog",((e,t,n)=>{const s=this.nextKey,i=t||{};this.nextKey++;const a=l.createElement(e,(0,o.Z)((0,o.Z)({},i),{},{onClose:(...e)=>this.onChildClose(s,...e),onCloseComplete:(...e)=>this.onChildCloseComplete(s,...e)}),n);return this.setState((e=>({stack:[...e.stack,{key:s,component:a,alive:!0,originalProps:{onClose:"onClose"in i?i.onClose:void 0,onCloseComplete:"onCloseComplete"in i?i.onCloseComplete:void 0}}]}))),()=>{this.onChildClose(s)}})),this.nextKey=0,this.state={stack:e},e&&e.forEach((e=>{this.nextKey=Math.max(this.nextKey,e.key+1)}))}onChildClose(e,...t){const n=this.state.stack.find((t=>t.key===e));n&&(n.originalProps.onClose&&n.originalProps.onClose(...t),this.setState((e=>({stack:e.stack.map((e=>e===n?(0,o.Z)((0,o.Z)({},e),{},{alive:!1}):e))}))))}onChildCloseComplete(e,...t){const n=this.state.stack.find((t=>t.key===e));n&&(n.originalProps.onCloseComplete&&n.originalProps.onCloseComplete(...t),this.setState((e=>({stack:e.stack.filter((e=>e!==n))}))))}}},449328:(e,t,n)=>{n.r(t),n.d(t,{InlineCommentsHighlighterComponent:()=>w,InlineCommentsHighlighter:()=>L});var o=n(122551),s=n(507080),l=n(325834),i=n(684157),a=n(920872),r=n(358372),c=n(259220),m=n(526938),d=n(541580),C=n(350844),h=n(328446),u=n(34868),g=n(511461),E=n(170915),f=n(616158),_=n(528365),k=n(628933),y=n(772610),S=n(595500),p=n(61271),v=n(203574);const R=(0,f.j)("inline-comment"),I=e=>e&&null!==(0,a.w)(e),w=({pageId:e,dialogs:t})=>{const{match:n}=(0,o.useContext)(y.M),{removeCommentQueryParams:s}=(0,r.n)(),{markerRefs:m,markerRefMap:h,loading:g}=(0,k.Q)({pageId:e}),{hasContentChanged:E,resetContentChanged:f}=(0,o.useContext)(d.i),{createAnalyticsEvent:w}=(0,l._)(),{onHighlightClick:L}=(0,o.useContext)(C.s),N=(0,o.useRef)(null),M=(0,o.useRef)(null),P="string"==typeof(null==n?void 0:n.query.focusedCommentId)?null==n?void 0:n.query.focusedCommentId:void 0,{cohort:b}=(0,i.a)(p.TQ,["variation","not-enrolled","control"],"not-enrolled",!0),x="variation"===b,A=(0,o.useCallback)(((e,t=!1)=>{let n=!1;for(;e&&I(e);){if(t){const t=(0,a.w)(e);n=Boolean(t&&m.includes(t))}else n=e.classList.contains(S.EL);if(n)break;e=e.parentElement}return{isValid:n,element:e}}),[m]),T=(0,o.useCallback)(((e,t)=>{const n=Object.keys(h).find((t=>(null==h?void 0:h[t])===e));w({type:"sendUIEvent",data:{action:"clicked",actionSubject:"inlineCommentHighlight",attributes:{mode:"view",context:"default",isSSR:t},objectType:"inlineComment",objectId:n&&h[n],source:"viewPageScreen"}}).fire()}),[w,h]),H=(0,o.useCallback)((({element:e,markerRef:t,isSSR:n=!1}={})=>{f(),!n&&e.classList.contains(S.GR)?((0,S.o1)(),L(null)):((0,S.o1)(),e.classList.add(S.GR),(0,S.QR)(t),L(t),T(t,n))}),[L,f,T]),O=(0,o.useCallback)((e=>{const{isValid:t,element:n}=A(e,!0);if(!n||!t)return;v.lD.start();const o=(0,a.w)(n);N.current=o,H({element:n,markerRef:o,isSSR:!0})}),[H,A]),D=(0,o.useCallback)((e=>{const{target:n}=e,{isValid:o,element:l}=A(n);if(!l||!o)return;e.preventDefault(),v.lD.start(),s();const i=(0,a.w)(l);E?t.showModal(u.v,{onConfirm:()=>H({element:l,markerRef:i})}):H({element:l,markerRef:i})}),[E,t,H,A,s]);(0,o.useEffect)((()=>{try{if(!N.current&&m.length>0&&window.__SSR_INLINE_COMMENTS_EVENTS_CAPTURE__&&window.__SSR_INLINE_COMMENTS_EVENTS_CAPTURE__.clickedInlineHighlightElements&&Array.isArray(window.__SSR_INLINE_COMMENTS_EVENTS_CAPTURE__.clickedInlineHighlightElements)){const e=window.__SSR_INLINE_COMMENTS_EVENTS_CAPTURE__.clickedInlineHighlightElements,t=e[e.length-1];t&&O(t)}}catch(e){R.log`An error occurred when opening SSR Inline higlight - ${e}`}}),[m]),(0,o.useEffect)((()=>{const e=document.querySelector("#content");if(e)return e.addEventListener("click",D),()=>{e.removeEventListener("click",D)}}),[D,e]),(0,o.useEffect)((()=>{const e=document.querySelectorAll((0,S.YU)()),t={};new Set(Array.from(e).map((e=>(0,a.w)(e)))).forEach((n=>{const o=Array.from(e).filter((e=>(0,a.w)(e)===n));n&&(t[n]={start:o[0],end:o[o.length-1]})})),e.forEach((e=>{const n=(0,a.w)(e);if(n){m.includes(n)?(e.classList.add(S.EL),e===t[n].start&&e.classList.add(S.dX),e===t[n].end&&e.classList.add(S.QM)):(e.classList.remove(S.EL),e.classList.remove(S.dX),e.classList.remove(S.QM)),N.current===n?(e.classList.add(S.GR),N.current=null):x&&!M.current&&P&&h[P]===n&&(e.classList.add(S.GR),M.current=!0)}})),v.nH.markFMP((0,_.es)("CFP-63.ssr-ttr")),v.nH.mark("highlightsRendered")}),[m,e,P,x,h]);const V=m&&Array.isArray(m)?m.length:0;return g?null:o.createElement(c.M,{key:`stop-${e}`,metric:v.nH,customData:{numberOfInlineComments:V}})},L=({pageId:e})=>o.createElement(g.k,{attribution:E.x.COLLABORATION},o.createElement(s.xs,{to:[h.l]},(t=>o.createElement(o.Fragment,null,o.createElement(m.q,{key:`start-${e}`,metric:v.nH}),o.createElement(w,{pageId:e,dialogs:t})))));L.displayName="InlineCommentsHighlighter"}}]);
//# sourceMappingURL=3071.2xQAsfwac8.js.map