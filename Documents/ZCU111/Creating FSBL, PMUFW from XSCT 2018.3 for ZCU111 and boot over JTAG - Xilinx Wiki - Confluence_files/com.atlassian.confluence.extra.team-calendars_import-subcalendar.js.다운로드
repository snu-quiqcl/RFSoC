WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:import-subcalendar', location = 'com/atlassian/confluence/extra/calendar3/components/import-subcalendar/import-subcalendar.soy' */
// This file was automatically generated from import-subcalendar.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.TeamCalendars.Templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.TeamCalendars == 'undefined') { Confluence.TeamCalendars = {}; }
if (typeof Confluence.TeamCalendars.Templates == 'undefined') { Confluence.TeamCalendars.Templates = {}; }


Confluence.TeamCalendars.Templates.importSubcalendar = function(opt_data, opt_ignored) {
  return '<div class="aui-message error calendar-error hidden"><p class="title"><span class="aui-icon icon-error"></span><strong>' + soy.$$escapeHtml('Error(s) occurred.') + '</strong></p><div class="error-content"><ul class="error-messages hidden"></ul></div></div><div class="aui-message warning tc-need-timezone hidden"><p class="title"><span class="aui-icon icon-warning"></span><strong>' + soy.$$escapeHtml('Unable to determine calendar timezone') + '</strong></p><p>' + soy.$$escapeHtml('The timezone for this calendar could not be determined. Please set the timezone below.') + '</p></div><form name="importSubCalendarForm" class="sub-calendar-import-form aui" method="POST" action="' + soy.$$escapeHtml("/wiki") + '/plugins/calendar/importsubcalendar.action" enctype="multipart/form-data" target="import-iframe-sink"><input type="hidden" name="calendarId" value=""><input type="hidden" name="decorator" value="none"><input type="hidden" name="color" value=""><input type="hidden" name="spaceKey" value=""><div class="field-group"><label for="import-name">' + soy.$$escapeHtml('Name') + '<span class="aui-icon icon-required"></span></label><input name="name" id="import-name"  type="text" class="text" value="" autocomplete="off"><div class="description">' + soy.$$escapeHtml('Leave this blank to use the calendar\x27s name from the ICS file.') + '</div><div class="error name-error"></div></div><div class="field-group"><label for="import-description">' + soy.$$escapeHtml('Description') + '</label><textarea name="description" id="import-description" rows="4" class="textarea"></textarea></div><div class="field-group field-group-space-permission"><label for="spaceKeyAutocomplete">' + soy.$$escapeHtml('Linked space') + '<span class="aui-icon icon-required"></span></label><input name="spaceKeyAutocomplete" id="spaceKeyAutocomplete" type="text" class="autocomplete-space text" data-max="5" data-none-message="' + soy.$$escapeHtml('No spaces found') + '"><div class="description">' + soy.$$escapeHtml('Link this calendar to a space.') + '</div><div class="error spaceKeyAutocomplete-error"></div></div><div class="field-group"><label for="ical-file">' + soy.$$escapeHtml('Upload iCal') + '<span class="aui-icon icon-required"></span></label><input type="file" class="file upfile" name="file_0" size="25"><div class="error file_0-error"></div></div><div class="field-group tc-field-group-timezone hidden"><label for="timeZone">' + soy.$$escapeHtml('Time zone') + '<span class="aui-icon icon-required"></span></label><select name="timeZoneId" class="select timeZone"></select><span class="spinner aui-icon aui-icon-wait"></span><div class="error timeZoneId-error"></div></div></form>';
};
if (goog.DEBUG) {
  Confluence.TeamCalendars.Templates.importSubcalendar.soyTemplateName = 'Confluence.TeamCalendars.Templates.importSubcalendar';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:import-subcalendar', location = 'com/atlassian/confluence/extra/calendar3/components/import-subcalendar/import-subcalendar.js' */
define("tc/import-subcalendar",["jquery","underscore","document","tc/util","tc-backbone","tc/templates","tc/calendar-util"],function(f,b,a,g,h,d,c){var e=h.View.extend({dialog:null,$uploadIframe:null,$submitButton:null,options:null,template:d.importSubcalendar(),events:{"selected.autocomplete-content input[name='spaceKeyAutocomplete']":"_selectSpace"},defaults:{callbackHandler:null,textTitleDialog:"Import calendar",textBtnImport:"Import",textLinkCancel:"Cancel"},initialize:function(i){this.options=f.extend({},this.defaults,i);if(!this.options.callbackHandler){AJS.debug("tc/import-subcalendar: requires 'callbackHandler' object")}},render:function(){this._createSubCalendarImportDialog();this._populateSubCalendarImportForm();this.$submitButton=this.dialog.popup.element.find(".submit");return this.dialog},_createSubCalendarImportDialog:function(){var i=this;var k=false;var j=function(){if(k){return}var l=i.$el.find("form.sub-calendar-import-form");k=true;f.ajax({type:"POST",headers:{"X-Atlassian-Token":"no-check"},url:Confluence.getContextPath()+"/plugins/calendar/importsubcalendar.action",cache:false,contentType:false,processData:false,data:new FormData(l[0]),success:function(m){k=false;i._loadedResultImport(m)},error:function(){k=false}});i._submit();return false};if(this.dialog){return}this.dialog=new AJS.ConfluenceDialog({height:429,width:512,onSubmit:j,id:"import-calendar-dialog"});this.dialog.addHeader(this.options.textTitleDialog);this.dialog.addPanel("",this.template,"calendar-dialog-panel");this.dialog.addButton(this.options.textBtnImport,j,"submit");this.dialog.addLink(this.options.textLinkCancel,b.bind(this._cancelDialog,this));this.el=this.dialog.getCurrentPanel().body;this.$el=f(this.el);this.$uploadIframe=this.$el.find(".subcalendar-import-result");this.delegateEvents()},_populateSubCalendarImportForm:function(){this.$el.find("input[name='name'], textarea[name='description'], input[name='spaceKey'], input[name='spaceKeyAutocomplete']").val("");this.$el.find("input[name='color']").val(this.options.callbackHandler.getNextCalendarColor());this.$el.find(".field-group .error").empty();if(AJS.Meta.get("space-key")){this.$el.find("input[name='spaceKey']").val(AJS.Meta.get("space-key"));var i=f(".field-group-space-permission",this.$el);i.css("display","none")}},_submit:function(){this.options.callbackHandler.setProcessingSubCalendar(true);this.spinnerDefer=this.options.callbackHandler.setSubCalendarSpinnerIconVisible(true);c.disableButton(this.$submitButton,"Importing...")},_selectSpace:function(j,i){this.$el.find("input[name='spaceKey']").val(i.content.key);this.$el.find("input[name='spaceKeyAutocomplete']").val(i.content.name)},_cancelDialog:function(){this.dialog.remove();this.dialog=null;return false},_loadedResultImport:function(m){var l=this;var k=a.createElement("html");k.innerHTML=m;var j=f(k).find(".subcalendar-id").text();if(f(".import-timezone-required",k).length){c.disableButton(this.$submitButton);l.$el.find(".tc-need-timezone").show();l.$el.find(".tc-field-group-timezone").show();Confluence.TeamCalendars.populateTimeZoneDropDown(l.$el.find(".tc-field-group-timezone .timeZone"),Confluence.TeamCalendars.getUserTimeZone(),function(){c.enableButton(l.$submitButton,"Import")},function(o,q,p){l.options.callbackHandler.showAjaxError(o,q,p)});l.dialog.updateHeight()}else{if(!f(".import-successful",k).length){var i=[];f(".field-errors input",k).each(function(){i.push({field:this.name,errorMessages:[this.value]})});if(i.length){Confluence.TeamCalendars.setFieldErrors(l.$el.find(".sub-calendar-import-form")[0],i);l.dialog.updateHeight()}var n=[];f(".action-error",k).each(function(){n.push(f(this).text())});if(n.length){Confluence.TeamCalendars.setGenericErrors(l.el,n,"error-subcalendar-update")}}else{l.dialog.remove();l.options.callbackHandler.handleImport(j)}}c.enableButton(this.$submitButton,"Import");if(this.spinnerDefer){this.spinnerDefer.resolve()}l.options.callbackHandler.setProcessingSubCalendar(false)}});return e});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:import-subcalendar', location = 'com/atlassian/confluence/extra/calendar3/components/import-subcalendar/import-subcalendar-compat.js' */
require(["tc/import-subcalendar"],function(a){if(!Confluence.TeamCalendars.Dialogs){Confluence.TeamCalendars.Dialogs={}}Confluence.TeamCalendars.Dialogs.getSubCalendarImportDialog=function(b){return new a({callbackHandler:b}).render()}});
}catch(e){WRMCB(e)};