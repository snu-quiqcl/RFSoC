"use strict";(self._cf=self._cf||[]).push([[80241],{415294:(e,o,r)=>{r.d(o,{F6:()=>t,T1:()=>l,BG:()=>n,CW:()=>a,pm:()=>s});const t="mentions-query",l="profile-card-query",n="space-navigation-query",a="legacy-extension-loading",s="fabric-publish-page"},242517:(e,o,r)=>{r.d(o,{t:()=>l});var t=r(96962);const l=()=>{const{isExternalCollaborator:e,loading:o,error:r}=(0,t.Q)();return{canViewUserProfile:!e,loading:o,error:r}}},987528:(e,o,r)=>{r.d(o,{w:()=>i});var t=r(122551),l=r(464984),n=r(524798),a=r(57198);const s=(0,l.defineMessages)({follow:{id:"profile.card.follow",defaultMessage:"Follow"},unfollow:{id:"profile.card.unfollow",defaultMessage:"Unfollow"},followTooltip:{id:"profile.card.follow.tooltip",defaultMessage:"See activity in feed"},unfollowTooltip:{id:"profile.card.unfollow.tooltip",defaultMessage:"Stop seeing activity in feed"}}),i=({followed:e})=>{const o=(0,n.Z)();return t.createElement(a.Z,{content:o.formatMessage(e?s.unfollowTooltip:s.followTooltip),position:"bottom"},t.createElement("span",null,o.formatMessage(e?s.unfollow:s.follow)))};i.displayName="FeedFollow"},333125:(e,o,r)=>{r.d(o,{K:()=>d});var t=r(991332),l=r(122551),n=r(507080),a=r(464984),s=r(883383),i=r(961634),u=r(185346);const c=(0,a.defineMessages)({followMutationErrorTitle:{id:"profile.card.feed.follow.mutation.error.title",defaultMessage:"We're having trouble doing that"},followMutationErrorDescription:{id:"profile.card.feed.follow.mutation.error.description",defaultMessage:"Try following or unfollowing this user again"}}),d=({feedConfigError:e,mutationError:o,showErrorFlag:r})=>l.createElement(l.Fragment,null,e?l.createElement(i.X,{error:e}):null,o?l.createElement(i.X,{error:o},l.createElement(n.xs,{to:[u.Q]},(e=>(r&&e.showErrorFlag({title:l.createElement(s.Z,(0,t.Z)({},c.followMutationErrorTitle)),description:l.createElement(s.Z,(0,t.Z)({},c.followMutationErrorDescription))}),null)))):null)},863305:(e,o,r)=>{r.d(o,{M:()=>d});var t=r(122551),l=r(499082),n=r(325834),a=r(158466),s=r(331377);const i=s.ZP`query FeedFollowQuery{getFeedUserConfig{accountIds}}`,u=s.ZP`mutation FeedFollowMutation($follow:[ID]$unfollow:[ID]){setFeedUserConfig(input:{followUsers:$follow unfollowUsers:$unfollow}){success}}`;let c=!1;function d(){const{featureFlagClient:e,isLicensed:o}=(0,a.D)(),r=e.getBooleanValue("confluence.frontend.feed.profile-card.follow",{default:!1,shouldTrackExposureEvent:!0}),{createAnalyticsEvent:s}=(0,n._)(),d=r&&o,{data:f,loading:p,error:w}=(0,l.aM)(i,{skip:!d||c,onError:e=>c=(e=>{var o;return null==e||null===(o=e.graphQLErrors)||void 0===o?void 0:o.some((e=>{var o,r;return(null==e||null===(o=e.path)||void 0===o?void 0:o.includes("getFeedUserConfig"))&&(null==e||null===(r=e.message)||void 0===r?void 0:r.includes("User not permitted to access Confluence"))}))})(e)}),[g,{error:E}]=(0,l.Db)(u,{refetchQueries:["FeedFollowQuery"]}),m=null==f?void 0:f.getFeedUserConfig.accountIds,v=(0,t.useCallback)(((e,o,r)=>async()=>{if(e){s({type:"sendUIEvent",data:{action:"clicked",actionSubject:"button",actionSubjectId:"feedFollow",source:r,attributes:{id:e,settingType:"user",actionType:o?"unfollow":"follow"}}}).fire();try{o?await g({variables:{unfollow:[e]}}):await g({variables:{follow:[e]}})}catch(t){}}}),[g,s]);return{renderFeedFollow:!(p||w||c)&&d,loading:p,getToggleFollowUser:v,feedConfigError:w,mutationError:E,followedUsers:m}}},580241:(e,o,r)=>{r.d(o,{t:()=>C});var t=r(991332),l=r(122551),n=r(464984),a=r(883383),s=r(507080),i=r(325834),u=r(588566),c=r(242517),d=r(917465),f=r(772610),p=r(158466),w=r(185346),g=r(961634),E=r(863305),m=r(987528),v=r(911508),F=r(861635),y=r(333125);const b=(0,n.defineMessages)({viewProfile:{id:"profile.card.viewProfile",defaultMessage:"View profile"}}),C=({position:e="bottom-start",userId:o,isAnonymous:r=!1,canViewProfile:n=!0,children:C,trigger:h="hover"})=>{const{push:P}=(0,l.useContext)(f.M),{canViewUserProfile:M,error:U}=(0,c.t)(),Z=U&&l.createElement(g.X,{error:U}),{userId:I,cloudId:T,featureFlags:k}=(0,p.D)(),{createAnalyticsEvent:x}=(0,i._)(),{feedConfigError:q,followedUsers:D,getToggleFollowUser:R,mutationError:A,renderFeedFollow:L}=(0,E.M)();if(r||!n||!o||!I||!M)return l.createElement(l.Fragment,null,Z,C);const N={label:l.createElement(a.Z,(0,t.Z)({},b.viewProfile)),id:"view-profile",callback:()=>(0,F.Rq)(o).then(P),shouldRender:e=>!!e&&(e.status&&"inactive"!==e.status),link:(0,F.p)(o,"",d.b)},S=!(!o||null==D||!D.includes(o)),Q={label:l.createElement(m.w,{followed:S}),id:"feed-follow-user",callback:R(o,S,"profileCard"),shouldRender:e=>L&&Boolean(o)&&o!==I&&"active"===(null==e?void 0:e.status)};return l.createElement(s.xs,{to:[w.Q]},(r=>l.createElement(l.Fragment,null,Z,l.createElement(y.K,{feedConfigError:q,mutationError:A,showErrorFlag:!0}),l.createElement(u.ZP,{cloudId:T,userId:o,resourceClient:(0,v.F)(T,k),position:e,trigger:h,actions:[N,Q],reportingLinesProfileUrl:`${d.b}/people`,onReportingLinesClick:e=>{return o=e.accountIdentifier,x({type:"sendUIEvent",data:{source:"profileCardWrapper",action:"clicked",actionSubject:"viewProfile",actionSubjectId:"userProfileCard",attributes:{clickTarget:"userReportingLine"}}}).fire(),void(window.self!==window.top?window.open((0,F.p)(o,"",d.b),"_blank","noreferrer"):(0,F.Rq)(o).then(P,(()=>{})));var o},addFlag:e=>r.showFlag(e)},C))))};C.displayName="ProfileCardWrapper"},911508:(e,o,r)=>{r.d(o,{F:()=>y});var t=r(991332),l=r(69210),n=r(308131),a=r(755492),s=r(622739),i=r(950535),u=r(315677);let c;!function(e){e.ANONYMOUS="ANONYMOUS",e.APP="APP",e.EXTERNAL="EXTERNAL",e.INTERNAL="INTERNAL",e.JSD="JSD"}(c||(c={}));var d=r(331377),f=r(910194);const p=d.ZP`query UserProfileClientForConfluenceQuery($userId:ID){user(current:false id:$userId){id confluence{permissionType}}...ExternalCollaboratorEntitlementFragment}${f.$}`;var w=r(172033),g=r(415294);const E=(0,w.FO)({key:g.T1});class m extends n._l{async makeRequest(e,o){E.start();const r=(0,u.WQ)().query({query:p,variables:{userId:o}}),[l,n]=await Promise.allSettled([r,super.makeRequest(e,o)]);if("rejected"===n.status)return E.stop({customData:{isExCoEnabled:!0,success:!1}}),Promise.reject(n.reason);const a=[];if("fulfilled"===l.status){var d,f;const e=l.value.data;(0,i.D)(e)&&(null==e||null===(d=e.user)||void 0===d||null===(f=d.confluence)||void 0===f?void 0:f.permissionType)===c.EXTERNAL&&a.push((0,t.Z)((0,t.Z)({},s.ExternalUserLozengeProps),{},{key:"ExternalUserLozenge"}))}return E.stop({customData:{isExCoEnabled:!0,success:!0}}),(0,t.Z)((0,t.Z)({},n.value),{},{customLozenges:a})}}class v extends n._l{async makeRequest(e,o){let r;E.start();try{r=await super.makeRequest(e,o)}catch(t){return E.stop({customData:{isExCoEnabled:!1,success:!1}}),Promise.reject(t)}return E.stop({customData:{isExCoEnabled:!1,success:!0}}),r}}const F={url:"/gateway/api/directory/graphql",cacheSize:100,cacheMaxAge:3e5},y=(0,l.default)(((e,o)=>{const r=!0===o["confluence.frontend.enable.profilecard.with.atlas.features"]?(0,t.Z)((0,t.Z)({},F),{},{teamCentralUrl:"/gateway/api/watermelon/graphql",teamCentralBaseUrl:"https://team.atlassian.com",productIdentifier:"confluence",cloudId:e}):F;return new n.ZP(r,{userClient:!0===o[a.pA]?new m(r):new v(r)})}))},308131:(e,o,r)=>{r.d(o,{_l:()=>l.Z,ZP:()=>n});r(763283);var t=r(477185),l=(r(902295),r(746433));const n=t.Z},588566:(e,o,r)=>{r.d(o,{ZP:()=>t});r(280794);const t=r(242436).Z}}]);
//# sourceMappingURL=80241.NwFYf85QvN.js.map