"use strict";(self._cf=self._cf||[]).push([[61284],{656562:(e,t,r)=>{r.d(t,{X:()=>s,F:()=>a});const s={DISCOVER_ROUTE:"discover.route.last",SPACE_ROUTE:"space.route.last",GLOBAL_SIDEBAR_PANEL:"sidebar.global.panel",TINYMCE_PAGE_JUST_PUBLISHED:"editor.tinyMCE.just.published",EDITOR_SURVEY_LAST_SUBMITTED:"editor.survey.last.submitted",SUPERADMIN_SURVEY_REQUESTED:"superadmin.survey.requested",SUPERADMIN_SURVEY_SUBMITTED:"superadmin.survey.submitted",SUPERADMIN_SESSION_EXPIRED:"superadmin.session.expired",RESTRICTED_PAGE_CONFIRMED:"restricted.page.confirmed",HOME_ONBOARDING:"home.onboarding",PAGE_JUST_CONVERTED:"migration.page.just.converted",NAVIGATION_CLASSIC_OPT_OUT:"navigation.classic.opt.out",NAVIGATION_HOME_OPT_OUT:"navigation.home.opt.out",NAVIGATION_DEFAULT_OPTED_OUT:"navigation.default.opted.out",NAVIGATION_OPT_IN_SEEN_SPOTLIGHT:"navigation.opt.in.seen.spotlight",NAVIGATION_CLICKED_LOUD_OPT_IN_OR_VIEWED_FLAG:"navigation.clicked.loud.opt.in.or.viewed.flag",HOME_SECTION_COLLAPSED:"home.section.collapsed",RECENTLY_WATCHED_SPACE:"recentlyWatchedSpace",GROWTH_EXPERIMENT_REQUEST_UPGRADE_SENT:"growth.experiment.request.upgrade.sent",GROWTH_EXPERIMENT_UPGRADE_DISMISSED_COUNT:"growth.experiment.engagedUpgrade.dismissed.count",GROWTH_EXPERIMENT_UPGRADE_LAST_DISMISSED_DATE:"growth.experiment.engagedUpgrade.last.dismissed.date",LOCAL_STORAGE_DISPLAYS_NEXT_AT_KEY:"growth.experiment.engagedBilling.displays.next.at",LOCAL_STORAGE_HAS_BILLING_DETAILS:"growth.experiment.engagedBilling.has.billing.details",LOCAL_STORAGE_BILLING_API_NEXT_CALLED_AT_KEY:"growth.experiment.engagedBilling.billing.api.next.called.at",LOCAL_STORAGE_CONTENT_VIEW_CLOSEST_ELEMENT_SCROLL_POSITION:"ce.content.view.best.element.scroll.position",CONFLUENCE_SLACK_APP_IS_ENABLED:"growth.experiment.confluence.slack-is-enabled",HOME_SIDEBAR_WIDTH:"home.sidebar.width",STARRED_FEATURE_FLAGS:"confluence-frontend-next.starredFeatureFlags",COPIED_SPACE_PERMISSIONS:"copied.space.permissions",PERSIST_SCROLL_POSITION_IN_VIEW_PAGE:"editor-persit-scroll-position",ID_START_CONTENT_IN_VIEW_PAGE:"main-content",FABRIC_PAGE_OPTIN_MIGRATION_BANNER:"fabric.page.optin.migration.banner.discovery.feature",FABRIC_TEMPLATE_MIGRATION_SUCCESS_FLAG:"fabric-template-migration.success.flag",FABRIC_TEMPLATE_MIGRATION_ERROR_FLAG:"fabric-template-migration.error.flag",ONBOARDING_PAGE_REDIRECT:"onboardingPageRedirect",OVERRIDES_STORAGE_KEY:"confluence-frontend-next.featureFlagLocalOverrides",BYLINE_APPS_SHOW_ALL:"byline.apps.show-all",SPACENAV_APPS_SHOW_ALL:"spacenav.apps.show-all",HIDE_BULK_CONFIRMATION_DIALOG_LOCAL_STORAGE_KEY:"archive-pages.bulk-archive.confirmation-dialog.opt-out",ONBOARDING_STEP_INDEX:"onboarding.account.setup.step.index",ONBOARDING_FORM_VALUES:"onboarding.account.setup.form.values",ONBOARDING_QUICKSTART_TOUR_STATE:"onboarding.quickstart.tour.state",RIGHT_SIDEBAR:"right.sidebar",CONNECT_APP_ANALYTICS:"ecosystem.confluence.connect.analytics",UPDATE_TEMPLATE_PROPERTIES_SET_ERROR:"update.template.properties.set.error",EDITOR_REVERTED:"autoconverted.pages.reverted",BLOGPOST_PERMISSIONS_NOTICE:"blogpost.permissions.notice.error",QUERY_OVERRIDES:"query.overrides"},a={PERSISTED_LEFT_SIDEBAR_WIDTH:"persisted.left.sidebar.width",PERSISTED_LEFT_SIDEBAR_COLLAPSED:"persisted.left.sidebar.collapsed",PERSISTED_GROWTH_PERSISTENT_UPGRADE_PRETRIAL_BANNER:"persisted.growth.persistent.upgrade.preTrial.banner",PERSISTED_GUEST_SURVEY_NEXT_TIME_TO_SHOW:"persisted.guest.survey.next.time.to.show",PERSISTED_GROWTH_SEARCH_APP_RECOMMENDATION_DISMISSED:"persisted.growth.search.app.recommendation.dismissed",PERSISTED_REMOVE_RECOMMENDATIONS_IN_APP_MENU:"persisted.economy-growth.remove.recommendations.in.app.menu"}},306311:(e,t,r)=>{r.d(t,{Ar:()=>u,BC:()=>l});var s=r(29298),a=r(616158),o=r(596207);const n=r(331377).ZP`mutation UpdateLocalStorageMutation($storageinput:LocalStorageInput!$stringKeys:[String]!$booleanKeys:[String]!){updateLocalStorage(localStorage:$storageinput){stringValues(keys:$stringKeys){key value}booleanValues(keys:$booleanKeys){key value}}}`;var i=r(656562),_=r(86294);const E=(0,a.j)("storage-manager");function l(e){if(e&&"code"in e)switch(e.code){case 22:return!0;case 1014:if("NS_ERROR_DOM_QUOTA_REACHED"===e.name)return!0;break;default:return!1}return!1}function g(e){if(!e)return e;try{return JSON.parse(e)}catch(t){return e}}class u{constructor(e,t,r,a,{userId:u,isLicensed:c}){(0,s.Z)(this,"_storageManager",void 0),(0,s.Z)(this,"_delimiter","#"),(0,s.Z)(this,"_namespace",void 0),(0,s.Z)(this,"_userId",void 0),(0,s.Z)(this,"_isLicensedUser",void 0),(0,s.Z)(this,"_hasQuotaErrorBeenSubmitted",!1),(0,s.Z)(this,"getItem",(e=>{if(!this._storageManager)return E.warn`Local/session storage not supported on browser`,null;try{const t=(0,_.x)(e,`${this._namespace}.${e}`);let r=this._storageManager.getItem(t);if(r||(r=this._storageManager.getItem(e),r&&(this._incrementLocalStorageMigrationEntries(),this.setItem(e,r),this._storageManager.removeItem(`${e}`))),r){let t;r=g(r);const s=/(\d+)#/;if("string"==typeof r&&(t=s.exec(r))){const s=r.replace(t[0],""),a=parseInt(t[1],10);return!isNaN(a)&&Date.now()>a?(this.removeItem(e),null):s}return r}return null}catch(t){return this._submitError(t,`Error getting value from storage manager for key:${e} : ${t}`),null}})),(0,s.Z)(this,"getAndRemoveItem",(e=>{if(!this._storageManager)return E.warn`Local/session storage not supported on browser`,null;try{const t=this.getItem(e);return t?(this.removeItem(e),t):null}catch(t){return this._submitError(t,`Error getting and removing value from storage manager for key:${e} : ${t}`),null}})),(0,s.Z)(this,"getAllItems",(()=>{const e={};if(!this._storageManager)return E.warn`Local/session storage not supported on browser`,e;const t=this._storageManager.length;try{for(let r=0;r<t;r++){const t=this._storageManager.key(r);if(t&&t.includes(`${this._namespace}.`)){const r=t.split(`${this._namespace}.`)[1],s=this._storageManager.getItem(t);e[r]=g(s)}}return e}catch(r){return this._submitError(r,`Error getting all items from storage manager : ${r}`),e}})),(0,s.Z)(this,"doesContain",(e=>{if(!this._storageManager)return E.warn`Local/session storage not supported on browser`,!1;try{const t=this.getItem(e);return"boolean"==typeof t?!t:!!t}catch(t){return this._submitError(t,`Error getting value from storage manager for key ${e}: ${t}`),!1}})),(0,s.Z)(this,"getItemAsBoolean",(e=>{if(!this._storageManager)return E.warn`Local/session storage not supported on browser`,!1;try{const t=this.getItem(e);return!(t&&"string"==typeof t&&t.indexOf("false")>=0)&&(!!(t&&"string"==typeof t&&t.indexOf("true")>=0)||!!t)}catch(t){return this._submitError(t,`Error getting value as boolean from storage manager for key ${e}: ${t}`),!1}})),(0,s.Z)(this,"setItem",((e,t,r)=>{if(!this._storageManager)return E.warn`Local/session storage not supported on browser`,null;try{const s=(0,_.x)(e,`${this._namespace}.${e}`);if("object"!=typeof t&&(t=`${this._getPrefix(r)}${t}`),t=JSON.stringify(t),this._storageManager.setItem(s,t),Object.values(i.F).indexOf(e)>-1&&!sessionStorage.getItem("confluence.disable-persisted-storage-for-tests")&&window.GLOBAL_APOLLO_CLIENT&&this._userId&&this._isLicensedUser){const r={storageinput:{stringValues:[{key:s,value:t}]},stringKeys:[s],booleanKeys:[]};window.GLOBAL_APOLLO_CLIENT.mutate({mutation:n,variables:r}).catch((r=>{this._submitError(r,`Error updating user preferences with key ${e} and value ${t}: ${r}`)}))}return JSON.parse(t)}catch(s){return l(s)?(this._hasQuotaErrorBeenSubmitted||(this._submitError(new Error(`Quota exceeded on key "${e}"`)),this._hasQuotaErrorBeenSubmitted=!0),E.error`Storage quota exceeded when for key ${e} and value ${t}; original error: ${s}`):this._submitError(s,`Error setting value from storage manager with key ${e} and value ${t}: ${s}`),null}})),(0,s.Z)(this,"removeItem",(e=>{if(this._storageManager)try{const t=(0,_.x)(e,`${this._namespace}.${e}`);return void this._storageManager.removeItem(`${t}`)}catch(t){return void this._submitError(t,`Error removing value from storage manager for key ${e}: ${t}`)}else E.warn`Local/session storage not supported on browser`})),(0,s.Z)(this,"initializeFromServer",(e=>{if(Array.isArray(e)&&!sessionStorage.getItem("confluence.disable-persisted-storage-for-tests"))try{e.forEach((e=>this._storageManager&&this._storageManager.setItem(e.key,e.value)))}catch(t){l(t)?this._submitError(new Error("Quota exceeded on intializing persisted values from server")):this._submitError(t,`Error setting value from storage manager while initializing persisted values from server: ${t}`)}})),(0,s.Z)(this,"_submitError",((e,t)=>{t&&E.error`${t}`,(0,o.U)().submitError(e,{attribution:"unknown"})})),(0,s.Z)(this,"_incrementLocalStorageMigrationEntries",(()=>{(0,o.U)().incrementCounter("localstorage-migration-entries")})),this._storageManager=e,this._namespace=u?`${a}/${t}.${u}.${r}`:`${a}/null`,this._userId=u,this._isLicensedUser=null!=c&&c}_getPrefix(e){const t=1e3*(e||0);return t?Date.now()+t+this._delimiter:""}}},86294:(e,t,r)=>{r.d(t,{i:()=>n,x:()=>i});var s=r(656562),a=r(900836);const o=/[^A-Za-z0-9\-._\/]/g,n=e=>{const t=[];let r=`${a.Ll}/${a.hP}.${e}.${a.Vw}`;return r=r.replace(o,"_"),Object.keys(s.F).forEach((e=>t.push(`${r}.${s.F[e]}`))),t},i=(e,t)=>(Object.values(s.F).indexOf(e)>-1&&(t=t.replace(o,"_")),t)},361284:(e,t,r)=>{r.d(t,{FK:()=>_,LT:()=>d,R2:()=>S,aN:()=>I});var s=r(28201),a=r(306311),o=r(900836);const n=r(331377).ZP`query LocalStorageQuery($stringKeys:[String]!$booleanKeys:[String]!){localStorage{stringValues(keys:$stringKeys){key value}booleanValues(keys:$booleanKeys){key value}}}`;var i=r(86294);const _=(0,s.y$)({__loadable_id__:"g_xHX",name:"LocalStorageQuotaSubscriber",loader:async()=>{const{LocalStorageQuotaSubscriber:e}=await Promise.all([r.e(61769),r.e(78248),r.e(54936),r.e(11216),r.e(98876)]).then(r.bind(r,485282));return e}}),E="object"==typeof window?window.localStorage:{},l="object"==typeof window?window.sessionStorage:{},g=(e,t)=>(e=>{try{return void 0!==e&&"setItem"in e&&!!e.setItem}catch(t){return!1}})(e)?e:null,u=g(l),c=g(E);let d,S;const I=async({userId:e,isLicensed:t})=>{d=new a.Ar(c,o.hP,o.Vw,o.Ll,{userId:e,isLicensed:t}),S=new a.Ar(u,o.hP,o.Vw,o.XC,{userId:e,isLicensed:t});let r=null;window.__USER_PREFERENCES__?r=window.__USER_PREFERENCES__:window.GLOBAL_APOLLO_CLIENT&&(r=await(async(e,t,r)=>{if(!r||!t)return null;try{const r={stringKeys:(0,i.i)(t),booleanKeys:[]},{data:s,errors:a}=await e.query({query:n,context:{allowOnExternalPage:!0},variables:r});if(a)return null;if(s&&s.localStorage)return s.localStorage.stringValues}catch(s){return null}})(window.GLOBAL_APOLLO_CLIENT,e,t)),r&&d.initializeFromServer(r)}},900836:(e,t,r)=>{r.d(t,{hP:()=>s,Vw:()=>a,Ll:()=>o,XC:()=>n});const s="atlassian",a="frontend",o="localStorage",n="sessionStorage"}}]);
//# sourceMappingURL=61284.NHa46X9u4p.js.map