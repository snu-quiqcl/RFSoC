WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/template/synchrony-presence.soy' */
// This file was automatically generated from synchrony-presence.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.SynchronyPresence.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.SynchronyPresence == 'undefined') { Confluence.Templates.SynchronyPresence = {}; }


Confluence.Templates.SynchronyPresence.container = function(opt_data, opt_ignored) {
  return '<ul id="avatar-list" class="synchrony-doc-' + soy.$$escapeHtml(opt_data.docId) + ' collaborative-avatars-list"></ul><aui-inline-dialog id="more-avatars" alignment="bottom right" responds-to="toggle" aria-hidden="true"><h3>' + soy.$$escapeHtml('More editors') + '</h3><ul id="more-avatars-list" class="collaborative-avatars-list"></ul></aui-inline-dialog>';
};
if (goog.DEBUG) {
  Confluence.Templates.SynchronyPresence.container.soyTemplateName = 'Confluence.Templates.SynchronyPresence.container';
}


Confluence.Templates.SynchronyPresence.avatar = function(opt_data, opt_ignored) {
  return '<li class="avatar-item' + ((opt_data.active) ? ' p' + soy.$$escapeHtml(opt_data.telepointer) + ' active' : '') + ((opt_data.currentUser) ? ' no-animate-entry' : '') + '"><span title="' + soy.$$escapeHtml(opt_data.title) + '" avatar="' + soy.$$escapeHtml(opt_data.initial) + '"' + ((opt_data.active) ? ' data-origin="' + soy.$$escapeHtml(opt_data.origin) + '"' : '') + ' class="avatar' + ((opt_data.active) ? ' active' : '') + '"><img src="' + soy.$$escapeHtml(opt_data.avatarUrl) + '"></span></li>';
};
if (goog.DEBUG) {
  Confluence.Templates.SynchronyPresence.avatar.soyTemplateName = 'Confluence.Templates.SynchronyPresence.avatar';
}


Confluence.Templates.SynchronyPresence.overlay = function(opt_data, opt_ignored) {
  return '<span id="synchrony-presence-overlay" class="overlay avatar"><a href="#" aria-controls="more-avatars" class="aui-button" data-aui-trigger></a></span>';
};
if (goog.DEBUG) {
  Confluence.Templates.SynchronyPresence.overlay.soyTemplateName = 'Confluence.Templates.SynchronyPresence.overlay';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/synchrony-presence.js' */
define("confluence-collaborative-editor-plugin/synchrony-presence","backbone confluence-collaborative-editor-plugin/avatar-list-view confluence-collaborative-editor-plugin/overlay-view confluence-collaborative-editor-plugin/cql-user-information confluence-collaborative-editor-plugin/user-information ajs confluence/legacy confluence/meta confluence/templates jquery underscore skate confluence/dark-features confluence/api/constants confluence/api/event".split(" "),function(g,u,o,v,w,x,y,e,z,k,d,p,A,
B,q){function r(a){var b=k.extend({},a);b.id=a.origin;b.fullname=a.fullname||"Anonymous";b.accountId=a.accountId||"anonymous";b.avatarURL=B.CONTEXT_PATH+a.avatarURL;b.active=a.active||true;b.currentUser=a.currentUser||l===a.origin;return b}function m(a){return d.uniq(c.filter(function(b){return b.get("active")===a&&b.get("accountId")!==e.get("atlassian-account-id")}).map(function(b){return b.get("accountId")})).length}function s(){return c.filter(function(a){return a.get("active")}).length}
function n(){var a=[];c.each(function(b){!b.get("active")&&!d.some(i,function(a){return b.get("id")===a.accountId})&&a.push(b)});d.each(a,function(b){c.remove(b)});d.each(i,function(b){if(!(b.accountId===e.get("atlassian-account-id")||c.any(function(a){return a.get("id")===b.accountId}))){b.active=false;b.id=b.accountId;c.add(b)}})}var c=new g.Collection,g={origin:"current-user",active:true,currentUser:true,accountId:e.get("atlassian-account-id")};c.add(r(g));var t=false,l="",j,i=[],h=null,f;p("presence-container",
{type:p.types.ATTRIBUTE,attached:function(){if(!(e.get("content-type")!=="page"&&e.get("content-type")!=="blogpost")){var a=k("#rte-toolbar");h=k(z.SynchronyPresence.container({docId:y.getContentId()}));a.append(h);new u({el:"#avatar-list",collection:c});f=new o({collection:c});a.append(f.render())}},detached:function(){h&&h.remove();f&&f.$el.remove()}});return{appendTo:function(a,b,g){l=a;if(!t){j=j||require("tinymce");t=true;i=g;n();q.bind("editor-heartbeat",function(b,a){if(d.isArray(a.contributors)){i=
a.contributors;n()}});b.on("presence",function(a){f.hideInlineDialog();a.left.forEach(function(a){a.id=a.origin;c.remove(a);n()});a=a.joined.filter(function(a){return a.origin!==l}).map(function(a){return r(a)});if(A.isEnabled("synchrony.user-info-bulk-api")){a=(d.isArray(a)?a:[a]).map(function(a){return a.accountId});a=w(a)}else a=v(a);a.then(function(a){a.forEach(function(a){var b=c.findWhere({active:false,id:a.accountId});b&&c.remove(b);c.add(a,{at:s()})});q.trigger("analyticsEvent",{name:"confluence.synchrony.user.in.session",
data:{contentId:e.get("content-id"),numActiveUsers:m(true)+1,numInactiveUsers:m(false)}})})});j.EditorManager.activeEditor.onClick.add(d.bind(o.prototype.hideInlineDialog,f))}return h},setTinyMce:function(a){j=a},isUserActive:function(a){return c.filter(function(b){return b.get("accountId")===a&&b.get("active")}).length===1},getUniqueUserCount:m,getActiveCount:s,userSessions:c}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/avatar-list-view.js' */
define("confluence-collaborative-editor-plugin/avatar-list-view","backbone confluence-collaborative-editor-plugin/avatar-view confluence-collaborative-editor-plugin/cql-user-information confluence-collaborative-editor-plugin/user-information ajs jquery underscore confluence/dark-features confluence/api/logger".split(" "),function(f,g,h,i,l,m,j,k,e){typeof e!=="function"&&(e=function(){});return f.View.extend({initialize:function(){this.collection.on("add",this.addAvatar,this);this.collection.on("remove",
this.removeAvatar,this);this.collection.each(this.addAvatar,this)},addAvatar:function(a){var c=this;k.isEnabled("synchrony.user-info-bulk-api")?i(a.get("accountId")).then(function(b){if(b&&b.length)for(var d in b[0])b[0].hasOwnProperty(d)&&a.set(d,b[0][d]);c._addAvatar(a)},function(a){console.error(a)}):h([{accountId:a.get("accountId"),username:a.get("username")}]).then(function(b){if(b&&b.length)for(var d in b[0])b[0].hasOwnProperty(d)&&a.set(d,b[0][d]);c._addAvatar(a)},function(){})},_addAvatar:function(a){var c=
new g({model:a});if(a.get("active")){e((a.get("fullname")||a.get("displayName"))+" joined. ("+a.get("origin")+")");a=this.$el.find("li.active").last();c=a.length?c.render().insertAfter(a):c.render().prependTo(this.$el)}else c=c.render().appendTo(this.$el);a=function(a){a.addClass("show");a.children(".avatar").tooltip({fade:true,gravity:"ne"})};this.collection.length===6?a(c):j.defer(a,c);this._manageOverlayClass()},removeAvatar:function(a){a.get("active")&&e(a.get("fullname")+" left. ("+a.get("origin")+
")");this._manageOverlayClass()},_manageOverlayClass:function(){var a=this.collection.length;this.collection.each(function(c,b){c.set("hidden",a>5&&b>=4)});a>5?this.$el.addClass("has-overlay"):this.$el.removeClass("has-overlay")}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/avatar-view.js' */
define("confluence-collaborative-editor-plugin/avatar-view",["backbone","ajs","confluence/templates","confluence/dark-features","jquery"],function(f,d,g,h,e){return f.View.extend({initialize:function(){this.model.on("remove",this.remove,this)},render:function(){return this.$el=e(g.SynchronyPresence.avatar({title:this._determineTitle(),initial:(this.model.get("fullname")||this.model.get("displayName")||"").charAt(0).toUpperCase(),avatarUrl:this.model.get("avatarURL"),origin:this.model.get("origin"),
active:!0,currentUser:this.model.get("currentUser"),telepointer:this._synchronyTelepointerId()}))},remove:function(){this.$el.removeClass().addClass("avatar-item animate");this.model.get("hidden")||this.$el.addClass("removing");this.$el.one(this._getSupportedTransition(),function(){e(this).removeClass("animate removing");e(this).remove()})},_determineTitle:function(){if(this.model.get("currentUser")){var b=["It\'s you, but smaller!","Look at you, getting stuff done!"];
return b[Math.floor(Math.random()*b.length)]}return(this.model.get("fullname")||this.model.get("displayName")||"")+" "+(this.model.get("active")?"is editing this page.":"has made changes that haven\'t been published.")},_getSupportedTransition:function(){var b={transition:"transitionend",MozTransition:"transitionend",OTransition:"oTransitionEnd",MsTransition:"msTransitionEnd",WebkitTransition:"webkitTransitionEnd"},a=document.createElement("_"),c;for(c in b)if(void 0!==
a.style[c])return b[c]},_synchronyTelepointerId:function(){for(var b=""+(this.model.get("sub")||this.model.get("origin")||""),a=0,c=0;c<b.length;c++)a=(a<<5)-a+b.charCodeAt(c),a&=a;return Math.abs(a)%10}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/overlay-view.js' */
define("confluence-collaborative-editor-plugin/overlay-view","backbone aui/inline-dialog2 confluence-collaborative-editor-plugin/avatar-view confluence/templates ajs jquery underscore".split(" "),function(c,g,d,e,f,b){return c.View.extend({initialize:function(){this.collection.on("add remove",this.reconcile,this);this.inlineDialog2=document.querySelector("#more-avatars")},render:function(){this.$el=b(e.SynchronyPresence.overlay());this.$el.children("a").tooltip({fade:true,gravity:"ne"});this.$el.on("click",
function(){b(".tipsy").remove()});return this.$el},reconcile:function(){var a=this.collection.where({hidden:true});if(a.length>0){this.$el.addClass("show");this.$el.children(".aui-button").html("+"+a.length).attr("title",a.length+" "+"other users are editing.");b("#more-avatars-list").children().remove();a.forEach(function(a){a=new d({model:a});b("#more-avatars-list").append(a.render())})}else{this.$el.removeClass("show");this.hideInlineDialog()}},hideInlineDialog:function(){if(this.inlineDialog2&&
this.inlineDialog2.isVisible&&this.inlineDialog2.isVisible())this.inlineDialog2.open=false}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/template/status-indicator.soy' */
// This file was automatically generated from status-indicator.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.CollaborativeEditor.StatusIndicator.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.CollaborativeEditor == 'undefined') { Confluence.Templates.CollaborativeEditor = {}; }
if (typeof Confluence.Templates.CollaborativeEditor.StatusIndicator == 'undefined') { Confluence.Templates.CollaborativeEditor.StatusIndicator = {}; }


Confluence.Templates.CollaborativeEditor.StatusIndicator.container = function(opt_data, opt_ignored) {
  return '<div class="synchrony-status-indicator"><div class="status-indicator-icon aui-icon aui-icon-small' + ((opt_data.error) ? ' aui-iconfont-warning' : (opt_data.saving) ? ' aui-iconfont-devtools-task-in-progress' : ' aui-iconfont-approve') + '" data-tooltip="' + soy.$$escapeHtml(opt_data.tooltipMessage) + '"></div><div class="status-indicator-message" data-tooltip="' + soy.$$escapeHtml(opt_data.tooltipMessage) + '">' + soy.$$escapeHtml(opt_data.statusMessage) + '</div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.CollaborativeEditor.StatusIndicator.container.soyTemplateName = 'Confluence.Templates.CollaborativeEditor.StatusIndicator.container';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/status-indicator-view.js' */
define("confluence-collaborative-editor-plugin/status-indicator-view","confluence/templates backbone confluence/meta ajs confluence/dark-features jquery underscore".split(" "),function(e,f,g,c,i,h,d){return f.View.extend({initialize:function(){this.$el.addClass("synchrony");this.listenTo(this.model,"change:saving change:error",this.render);this.model.set("confluenceUnreachable",false);this.model.set("synchronyUnreachable",false);this.model.set("tokenExpired",false);this.model.set("isNewPage",g.get("new-page"));
c.bind("rte.heartbeat",d.bind(this.onConfluenceConnectedState,this));c.bind("rte.safe-save.error",d.bind(this._errorPublishing,this));c.bind("rte.preview.error",d.bind(this._errorPublishing,this));this.model.set("connecting",true);this._setProgressState()},render:function(){h(".tipsy").remove();this.$el.html(e.CollaborativeEditor.StatusIndicator.container(this.model.attributes))},onConnectedState:function(a){this.model.set("synchronyUnreachable",false);if(!this.model.has("synchronyEntity")){this.model.set("synchronyEntity",
a);var b=this;this.model.get("synchronyEntity").on("update",function(a){b._handleSynchronyUpdateEvent(a,b)});this.model.get("synchronyEntity").on("ack",function(a){b._handleSynchronyAckEvent(a,b)})}this._setSavedState()},onDisconnectedState:function(){this.model.set("synchronyUnreachable",true);this.model.set("connecting",true);this._setErrorState()},onConfluenceConnectedState:function(){if(this.model.get("confluenceUnreachable")){this.model.set("confluenceUnreachable",false);this._setSavedState()}},
onConfluenceDisconnectedState:function(){this.model.set("confluenceUnreachable",true);this.model.set("connecting",true);this._setErrorState()},onTokenRenewedState:function(){if(this.model.get("tokenExpired")){this.model.set("tokenExpired",false);this._setSavedState()}},onTokenExpiredState:function(){this.model.set("tokenExpired",true);this.model.set("connecting",true);this._setErrorState()},_handleSynchronyUpdateEvent:function(a,b){if(a.updateType==="local"){b.model.set("pendingChanges",true);b._saving()}},
_handleSynchronyAckEvent:function(a,b){var c=a.pending.length>0;b.model.set("pendingChanges",c);c||b.model.set("lastSavedTime",(new Date).getTime())},_saving:function(){var a=this,b=function(){setTimeout(function(){a.model.get("pendingChanges")||(new Date).getTime()-a.model.get("lastSavedTime")<a.model.get("minActiveTime")?b():a._setSavedState()},a.model.get("minActiveTime"))};if(!this.model.get("saving")){this.model.set("connecting",false);this._setProgressState();b()}},_reachable:function(){return!this.model.get("confluenceUnreachable")&&
!this.model.get("synchronyUnreachable")&&!this.model.get("tokenExpired")},_errorPublishing:function(a,b){switch(b.status){case 0:this.onConfluenceDisconnectedState();break;case 500:case 503:this.onConfluenceDisconnectedState()}},_setSavedState:function(){if(this._reachable()){this.model.set("statusMessage",this.model.get("connecting")?"Ready to go":"Changes saved");this.model.set("isReadyToGo",this.model.get("connecting")?true:false);this.model.set("tooltipMessage",
"We\'re automatically saving your changes");this.model.set("connecting",false);this.model.set("saving",false);this.model.set("error",false)}else this._setErrorState()},_setErrorState:function(){this.model.set("statusMessage","Can\'t save changes");this.model.set("tooltipMessage","Can\'t reach the server. Check your internet connection, and we\'ll keep trying to reconnect you.");this.model.set("saving",false);this.model.set("error",true)},_setProgressState:function(){if(this._reachable()){this.model.set("statusMessage",this.model.get("connecting")?
"Connecting...":"Saving changes");this.model.set("tooltipMessage","We\'re automatically saving your changes");this.model.set("saving",true);this.model.set("error",false)}else this._setErrorState()}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/initialise-metrics.js' */
define("confluence-collaborative-editor-plugin/initialise-metrics",["confluence/performance-session"],function(a){return function(){a.register("confluence.editor.quickedit.loading.times",{"confluence.editor":!0,"confluence.editor.preload":!0,"confluence.editor.quick.fetchContent":!0,"confluence.editor.tinymce":!0,"confluence.editor.synchrony":!0,"confluence.editor.synchrony.CR":!0,"confluence.editor.synchrony.connect":!0,"confluence.editor.synchrony.deps":!0,"confluence.editor.synchrony.init":!0,
"confluence.editor.synchrony.jsLoad":!0,"confluence.editor.synchrony.snapshot":!0,"confluence.editor.synchrony.unmarshal":!0},{"confluence.editor.synchrony.connect":!0})}});require("confluence/module-exporter").safeRequire("confluence-collaborative-editor-plugin/initialise-metrics",function(a){a()});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/sync-manager.js' */
define("confluence-collaborative-editor-plugin/sync-manager",["ajs","jquery"],function(d,e){var f=["id"],g={START_SYNCHRONIZING_EVENT_NAME:"start",STOP_SYNCHRONIZING_EVENT_NAME:"stop",MAX_CONSECUTIVE_AUTO_RECOVERY_TRIGGERED:10,MAX_WAIT_TIME_TO_RESTART:3E4,DEBUG_MODE:!1},b=function(a,c){this.entity=a;this.settings=e.extend({},g,c||{});this.controlSyncState={};this.recoveryTimeoutTasks={};var b=function(a,c,b){f.every(function(a){return"undefined"!==typeof b[a]})?a(b):this.displayLogMessage("Invalid payload, missing required params",
c,b)};d.bind("synchrony."+this.settings.START_SYNCHRONIZING_EVENT_NAME,b.bind(this,this.enableSynchronization.bind(this)));d.bind("synchrony."+this.settings.STOP_SYNCHRONIZING_EVENT_NAME,b.bind(this,this.disableSynchronization.bind(this)))};b.prototype.getOrCreateControlSyncState=function(a){return this.controlSyncState[a]=this.controlSyncState[a]||{DISABLED_SYNC_STATUS:!1,RECOVERY_TIMER_RUNNING:!1,CONSECUTIVE_AUTO_RECOVERY_TRIGGERED:0}};b.prototype.enableDebug=function(a){this.settings.DEBUG_MODE=
"undefined"!==typeof a?a:!0};b.prototype.displayLogMessage=function(){if(this.settings.DEBUG_MODE){var a=Array.prototype.slice.call(arguments);a.splice(0,0,"DEBUG: "+(new Date).toLocaleTimeString());console.log.apply(console,a)}};b.prototype.disableSynchronization=function(a){var c=a.id;this.getOrCreateControlSyncState(c).DISABLED_SYNC_STATUS=!0;this.clearAutoRecoveryTimer(c);this.setAutoRecoveryTimer(a);this.entity.stop(c);this.displayLogMessage("Stoping entity synchronization",c,e.extend(!0,{},
this.controlSyncState))};b.prototype.enableSynchronization=function(a){a=a.id;this.getOrCreateControlSyncState(a).DISABLED_SYNC_STATUS=!1;this.clearAutoRecoveryTimer(a);this.entity.start(a);this.displayLogMessage("Starting entity synchronization",a,e.extend(!0,{},this.controlSyncState))};b.prototype.clearAutoRecoveryTimer=function(a){var c=this.getOrCreateControlSyncState(a);clearTimeout(this.recoveryTimeoutTasks[a]);delete this.recoveryTimeoutTasks[a];c.RECOVERY_TIMER_RUNNING=!1};b.prototype.setAutoRecoveryTimer=
function(a){var c=a.id,b=this.getOrCreateControlSyncState(c);b.RECOVERY_TIMER_RUNNING=!0;this.recoveryTimeoutTasks[c]=setTimeout(function(){this.displayLogMessage("Auto recovery has been triggered",c);this.clearAutoRecoveryTimer(c);b.DISABLED_SYNC_STATUS=!1;b.RECOVERY_TIMER_RUNNING=!1;b.CONSECUTIVE_AUTO_RECOVERY_TRIGGERED++;d.trigger("analyticsEvent",{name:"confluence.synchrony.syncmanager.failed-to-restart",data:{id:c}});b.CONSECUTIVE_AUTO_RECOVERY_TRIGGERED>=this.settings.MAX_CONSECUTIVE_AUTO_RECOVERY_TRIGGERED&&
(this.displayLogMessage("Auto recovery has been triggered too many times for the same action",c,this.controlSyncState[c].CONSECUTIVE_AUTO_RECOVERY_TRIGGERED),d.trigger("analyticsEvent",{name:"confluence.synchrony.syncmanager.consecutive-failed-to-restart",data:{id:c}}));this.entity.start(c)}.bind(this),a.maxWaitTimeToRestart||this.settings.MAX_WAIT_TIME_TO_RESTART)};return b});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/telepointer-cleaner.js' */
define("confluence-collaborative-editor-plugin/telepointer-cleaner",["confluence-editor-reliable-save/reliable-save","jquery"],function(a,c){a.registerCleanupFunction(function(a){var b=c("<div>");b.append(a);b.find(".synchrony-container, .synchrony-tp").remove();return b.html()})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/editor-blanket.js' */
define("confluence-collaborative-editor-plugin/editor-blanket",["ajs","jquery"],function(i,a){var c,d,e;function f(b){switch(b){case "block":c="editor-block";d="aria-disabled";e="";break;default:c="editor-loading editor-loading-spinner",d="aria-busy",e="editor-loading"}b=a("#editpageform, #createpageform");b.addClass(c);b.attr(d,!0);a("#content-title").attr("tabindex",-1);a("#wysiwygTextarea_ifr").attr("tabindex",-1);a(".aui-toolbar2-primary").addClass(e)}function h(){var b=a("#editpageform, #createpageform");
b.removeClass(c);b.attr(d,!1);a("#rte").css("opacity",1).addClass("editor-blanket-ease-in");a("#content-title").attr("tabindex",1);a("#wysiwygTextarea_ifr").attr("tabindex",100);a("#content-title-div").css("opacity",1).addClass("editor-blanket-ease-in");a(".aui-toolbar2-primary").removeClass(e);e=d=c=void 0}function g(){a("#rte").css("opacity",1);a("#content-title-div").css("opacity",1)}e=d=c=void 0;return{applyBlanket:function(a){"pending"===a.state()?(f(),a.done(h)):g()},showEditor:g,showBlanket:f}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/synchrony-auth.js' */
define("confluence-collaborative-editor-plugin/synchrony-auth","jquery ajs confluence/meta confluence/api/event confluence/get-content-id confluence-collaborative-editor-plugin/synchrony-util".split(" "),function(k,e,f,n,l,g){function m(a){if(a[1]==="error"){var b=a[0].responseText?JSON.parse(a[0].responseText):a[0],b=b||{};b.type=b.type||a[0].status.toString();b.message=b.message||a[0].status+": "+a[0].responseText;return b}return null}function h(a,b,c){a&&n.trigger("analyticsEvent",{name:"confluence.synchrony.request.error."+
(o[a.type]||"unknown"),data:{contentId:l(),origin:"client",trigger:b,cause:a.message,userKey:f.get("remote-user-key"),loggableRequestData:JSON.stringify(c),accountId:f.get("atlassian-account-id")}});return a}function i(a){var b=k.Deferred(),c;if(c=!a){c=parseInt(g.retrieveMetadata("synchrony-expiry"));c=isNaN(c)?false:c>Date.now()/1E3}if(c)b.resolve(g.retrieveMetadata("synchrony-token"));else{e.log("["+new Date+"] Synchrony JWT expired or invalid, retrieving new token.");g.time("confluence.editor.synchrony.token");
c=a&&a.type?"?errorType="+a.type:"";k.ajax({dataType:"json",method:"GET",url:encodeURI(e.contextPath()+"/rest/synchrony/1.0/token/"+l()+"/generate"+c)}).done(function(a){f.set("synchrony-token",a.synchronyToken);f.set("synchrony-expiry",a.synchronyExpiry);j=0;b.resolve(a.synchronyToken);if(d){d.onConfluenceConnectedState();d.onTokenRenewedState()}e.trigger("dismiss.editor.error.message",{messageKey:"synchrony-token-expired",enablePublish:true});e.debug("Synchrony JWT token updated.");g.timeEnd("confluence.editor.synchrony.token")}).fail(function(c){j++;
j>=10&&e.trigger("editor.error.message",{messageKey:"synchrony-token-expired",message:"We couldn\'t process your request, as it was missing a required security token. Copy your work, then re-submit the form or reload the page.",disablePublish:true});if(d){d.onConfluenceDisconnectedState();d.onTokenExpiredState()}e.log(a?a.message:"Confluence failed to renew JWT token.");b.reject({type:"error_creating_jwt",message:c.status+": "+c.responseText})})}return b.promise()}var d,j=0,o={"invalid-ancestor":"invalid_ancestor","out-of-order-revision":"out_of_order_revision","Internal Server Error":"internal_server_error",
"jwt/decryption-failed":"jwt_decryption_failed","jwt/unknown-iss":"jwt_unknown_issuer","unauthorized-access":"unauthorised_access",error_creating_jwt:"error_creating_jwt",404:"not_found",other:"other"};return{init:function(a){d=a},performRequest:function(a,b,c){return i().pipe(a).pipe(function(e){var d=m(e);b==="CR"&&c.ancestor===c.rev&&h({type:"other",message:"Inconsistent revisions"},b,c);return d&&d.type.match(/^jwt\//)?i(d).pipe(a):e}).pipe(function(a){h(m(a),b,c);return a},function(a){return h(a,
b,c)})},getTokenPromise:i}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/unsupported-extension.js' */
define("confluence-collaborative-editor-plugin/unsupported-extension","ajs jquery confluence-editor/editor/page-editor-message window confluence-collaborative-editor-plugin/editor-blanket confluence/legacy-editor-global-AVOID-IF-POSSIBLE".split(" "),function(a,c,e,f,g,d){return{check:function(){var b=a.Rte.getEditor().getBody();if(b.hasAttribute("data-gramm")&&b.hasAttribute("data-gramm_id")){a.trigger("synchrony.stop",{id:"confluence.editor.block.by.grammarly",maxWaitTimeToRestart:31536E6});a.trigger("analyticsEvent",
{name:"confluence.synchrony.editor.grammarly.block"});b.setAttribute("contentEditable",false);c(b).find(".contentLayout2 .innerCell").each(function(){this.setAttribute("contentEditable",false)});g.showBlanket("block");d.UI.setButtonsState(false,d.UI.buttons);e.handleMessage("collaborative-editor-unsupported-extension",{type:"error",title:"Grammarly isn\'t supported",message:a.format("The Grammarly extension doesn\'\'t play well with collaborative editing. Disable it and \u003ca {0}\u003ereload the page\u003c/a\u003e to keep working.",'href="#" id="collabGrammarlyReload"')});c("#collabGrammarlyReload").click(function(){a.trigger("analyticsEvent",
{name:"confluence.synchrony.editor.grammarly.reload.click"});f.location.reload();return false});a.trigger("synchrony-unsupported-extension")}}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/synchrony-entity.js' */
define("confluence-collaborative-editor-plugin/synchrony-entity","jquery ajs confluence-collaborative-editor-plugin/synchrony-auth confluence-collaborative-editor-plugin/synchrony-util confluence-collaborative-editor-plugin/unsupported-extension confluence-collaborative-editor-plugin/cql-user-information confluence-collaborative-editor-plugin/user-information confluence/dark-features".split(" "),function(c,b,h,g,i,j,k,l){function e(d){var b,f=/^[\w\.\-\+\%]+$/i;b=function(b){return null==b||f.test(b)};
return c.extend({},d.whitelists.tinymce,{styles:c.extend({},d.whitelists.tinymce.styles,{"padding-top":false,"padding-right":false,"padding-bottom":false,"padding-left":false,padding:false,display:b,"list-style-type":b}),attributes:c.extend({},d.whitelists.tinymce.attributes,{"data-linked-resource-id":true,"data-linked-resource-version":true,"data-linked-resource-type":true,"data-base-url":true,"data-linked-resource-default-alias":true,"data-linked-resource-shortcut":true,"data-linked-resource-container-id":true,
"data-linked-resource-container-version":true,"data-linked-resource-content-type":true,"data-attachment-copy":true,"data-nice-type":true,"data-content-title":true,"data-space-key":true,"data-posting-day":true,"data-macro-parameters":true,"data-macro-default-parameter":true,"data-macro-name":true,"data-macro-id":true,"data-macro-body":true,"data-macro-schema-version":true,"data-macro-body-type":true,"data-encoded-xml":true,"data-not-permitted":true,"data-card-appearance":true,"data-width":true,"data-original-width":true,
"data-original-height":true,"data-media-id":true,"data-media-type":true,"data-resource-id":true,"data-image-src":true,"data-image-height":true,"data-image-width":true,"data-element-title":true,"data-location":true,"data-unresolved-comment-count":true,"confluence-query-params":true,"data-emoticon-name":true,"data-mce-src":true,"data-ref":true,accesskey:true,datetime:true,"data-anchor":true,"data-highlight-class":true,"data-highlight-colour":true,"data-username":true,"data-entity-id":true,"data-entity-type":true,
"data-favourites-bound":true,"data-atlassian-layout":true,"data-placeholder-type":true,"data-layout":true,"data-title":true,"data-type":true,"data-inline-task-id":true,"data-inline-tasks-content-id":true,userkey:true,username:true,accountid:true}),classes:function(b){switch(b){case "mceSelected":case "active-resizable":return false;default:return true}},elements:c.extend({},d.whitelists.tinymce.elements,{time:true,mark:true,label:true,form:true})})}function m(d,c,f){var g=e(d);return{profile:"tinymce",
selectionCorrections:false,telepointer:{refreshOnResize:true,label:{hover:true,movement:1E3,text:function(a){if(a.accountId)return l.isEnabled("synchrony.user-info-bulk-api")?k(a.accountId).then(function(a){return(a&&a.length>0?b.escapeHtml(a[0].displayName):"Anonymous")[0].toUpperCase()},function(a){console.error(a);return"&#9786;"}):j({accountId:a.accountId}).then(function(a){return(a&&a.length>0?b.escapeHtml(a[0].displayName):"Anonymous")[0].toUpperCase()},
function(a){console.error(a);return"&#9786;"});try{return(a.fullname||"Anonymous")[0].toUpperCase()}catch(d){b.log(d)}return"&#9786;"}}},tinymce:{monkeyPatchUndoManager:true,instance:c},whitelist:function(a){var b=a.domNode===f,c=a.type==="node",e=a.type==="attribute"&&a.name==="data-title",h=a.type==="node"&&a.node.domNode()&&a.node.domNode().getAttribute&&a.node.domNode().getAttribute("id")==="mcepastebin";return b?c||e:h?false:d.isWhitelisted(g,a)},domReadHook:function(){b.trigger("cursor-target-refresh");
i.check()}}}return{bind:function(b,c,f,e,a){return b.entity({url:g.getServiceUrl(),entityId:g.getEntityId(),jwt:h.getTokenPromise,initRev:a.confRev,history:e,presence:true,useFallback:g.getXhrFallbackFlag()}).bind(f,m(b,c,f))},makeWhitelist:e}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/synchrony-handlers.js' */
define("confluence-collaborative-editor-plugin/synchrony-handlers","jquery ajs confluence/meta confluence/dark-features confluence-editor/editor/page-editor-message confluence-collaborative-editor-plugin/sync-manager confluence-collaborative-editor-plugin/synchrony-util confluence-collaborative-editor-plugin/synchrony-content confluence-collaborative-editor-plugin/synchrony-presence confluence-collaborative-editor-plugin/cql-user-information confluence-collaborative-editor-plugin/user-information confluence/get-content-id confluence/legacy-editor-global-AVOID-IF-POSSIBLE".split(" "),
function(d,b,f,w,k,x,g,h,y,z,A,B,l){function m(a,q){if(q.contributors){r=q.contributors;b.unbind(a,m)}}function C(a){i.val(a.rev.toString())}function D(a){i.val(a.rev.toString());b.trigger("synchrony.entity.ack",{pendingChanges:a.pending.length>0})}function E(){n.onDisconnectedState();b.log("Synchrony disconnected!")}function F(a){if(a.errorType==="jwt/tenant-suspended"){b.trigger("analyticsEvent",{name:"confluence.synchrony.tenant-suspended"});d("input#content-title").attr("readonly",true);b.Rte.getEditor().getBody().setAttribute("contenteditable",
false);b.trigger("editor.error.message",{messageKey:"synchrony-tenant-suspended",message:"Your Atlassian Cloud site is unavailable due to scheduled maintenance. Please refer to our page describing \u003ca href=\"https://confluence.atlassian.com/cloud/maintenance-windows-744721660.html\"\u003eMaintenance Windows\u003c/a\u003e for more information.",disablePublish:true})}else a.level==="fatal"&&b.trigger("editor.error.message",{disablePublish:true})}function G(a){g.timeEnd("confluence.editor.synchrony.connect");b.log("Synchrony connected.");d("input#content-title").attr("readonly",false);b.Rte.getEditor().getBody().setAttribute("contenteditable",true);b.trigger("dismiss.editor.error.message",
{messageKey:"synchrony-tenant-suspended",enablePublish:true});y.appendTo(a.sid,c,r);n.onConnectedState(c);b.trigger("synchrony.connected");h.fixTinymceCaretContainer(j,e)}function s(a,b,c){return{origin:"synchrony",cause:a,messageKey:b,disablePublish:c}}function H(a){function b(d){if(!d.pending.length){c.off("ack",b);i.val(d.rev.toString());o.resolve(a)}}var o=d.Deferred();if(c.ackState().pending.length){c.on("ack",b);setTimeout(function(){c.off("ack",b);o.reject(s("timeout"))},5E3)}else o.resolve(a);
return d.when(o,t).promise()}function u(a){a=(a=g.getLatestRevisionWithAttr(a.revisions,"user"))?a.meta.user:"Anonymous";return w.isEnabled("synchrony.user-info-bulk-api")?A(a).then(function(a){return a&&a.length>0?b.escapeHtml(a[0].displayName):"Anonymous"}):z({accountId:a}).then(function(a){return a&&a.length>0?b.escapeHtml(a[0].displayName):"Anonymous"})}function I(a){if(a.updateType==="remote"){i.val(a.revisions[a.revisions.length-
1].rev.toString());g.hasRevisionTrigger(a.revisions,"reset")&&u(a).then(function(a){k.handleMessage("editor.synchrony.revert-page",{type:"info",message:b.format("{0} reverted to a previous version of this page.",a)});f.set("has-collaborated",false);v();b.trigger("analyticsEvent",{name:"confluence.synchrony.external-changes.revert"});b.trigger("editor-shared-drafts-discarded");l.heartbeat()});g.hasRevisionTrigger(a.revisions,"publish")&&u(a).then(function(a){if(h.isUnpublished()){f.set("new-page",false);
f.set("page-id",B());f.set("draft-id","0");l.UI.setButtonState(true,d("#rte-button-discard"))}f.set("has-collaborated",false);v();k.handleMessage("editor.synchrony.page-published",{type:"info",message:b.format("{0} published this page.",b.escapeHtml(a)),close:"auto"});b.trigger("analyticsEvent",{name:"confluence.synchrony.external-changes.publish"});b.trigger("editor-shared-drafts-published");l.heartbeat()});g.hasRevisionType(a.revisions,"external")&&b.trigger("editor.external.change");
var c=g.getLatestRevisionWithAttr(a.revisions,"confVersion");if(c&&c.meta.confVersion){d('meta[name="page-version"]').attr("content",c.meta.confVersion);d('meta[name="ajs-page-version"]').attr("content",c.meta.confVersion);f.set("page-version",c.meta.confVersion)}}else a.updateType==="local"&&e.undoManager.typing&&J();setTimeout(function(){if(a.updateType==="init"||a.updateType==="remote"){b.trigger("editor.remote.change");h.readTitleFromRootElement(j)}h.fixTinymceCaretContainer(j,e);if(a.updateType===
"local"){e.undoManager.hasUndo()||e.setDirty(false);b.trigger("editor.local.change")}},0)}function v(){c.ackState().pending.length===0&&e.setDirty(false)}var i,n,e,j,c,t,r=[],p={},J=b.debounce(function(){e.undoManager.add()},300);p.handle=function(a,b,f,k,m){g.time("confluence.editor.synchrony.connect");c=a;e=b;n=f;t=d.when(k,m).pipe(null,function(a){c.destroy();n.onDisconnectedState();return s(a,"collaborative-editor-load-failure",true)});i=d("#syncRev");j=e.getBody();c.on("init",C).on("update",
I).on("ack",D).on("connected",G).on("disconnected",E).on("error",F);p.entity=c;new x(c,{DEBUG_MODE:true});h.bindPostPasteFix();h.readTitleFromRootElement(j);l.overrideBeforeSave(H);d("#content-title").keyup(h.writeTitleToRootElement)};b.bind("editor-heartbeat",m);return p});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-collaborative-editor-plugin:confluence-collaborative-editor-plugin-resources', location = '/js/synchrony-editor.js' */
define("confluence-collaborative-editor-plugin/synchrony-editor","window jquery ajs backbone confluence/get-content-id confluence-collaborative-editor-plugin/editor-blanket confluence-collaborative-editor-plugin/synchrony-util confluence-collaborative-editor-plugin/synchrony-content confluence-collaborative-editor-plugin/synchrony-auth confluence-collaborative-editor-plugin/synchrony-entity confluence-collaborative-editor-plugin/synchrony-handlers confluence-editor/loader/collaborative-helper confluence/meta confluence/api/event confluence/legacy-editor-global-AVOID-IF-POSSIBLE confluence/api/logger confluence/breadcrumbs confluence-editor/editor/page-editor-message confluence/page-location".split(" "),
function(i,e,g,F,k,G,c,q,u,A,H,v,l,h,M,o,I,B,J){function w(a){g.DarkFeatures.isEnabled("revert.page-migrated.reload.tinymce")&&a!=="timeout"&&a!=="synchrony-requests"&&i.location.reload()}function x(a){var b;switch(a){case "timeout":a="The connection timed out";b="Check you can connect to the internet, then try reloading. If there\'s no problem with your connection, speak to your Confluence admin.";break;case "synchrony-requests":y=true;a="";b="Something went wrong after loading the editor. Copy your unsaved changes and refresh the page to keep editing.";break;default:y=
true;a="";b="It\'s taking longer than usual to load this page. This page will automatically reload."}h.trigger("editor.error.message",{title:a,messageKey:"collaborative-editor-load-failure",message:b,disablePublish:true,close:"manual"})}function C(a,b){var d=e.Deferred();a.done(function(){c.timeEnd(b)},d.resolve);a.fail(d.resolve);return d.promise()}function D(a,b){var d=b[1]==="error"&&b[0].responseText?JSON.parse(b[0].responseText):"",c=false;d.type==="invalid-ancestor"?c="synchrony":d.type==="out-of-order-revision"&&(c="confluence");
if(c){i.__DEBUG__&&g.log("Performing synchrony recovery");e.ajax({url:g.contextPath()+"/rest/synchrony/1.0/content/"+k()+"/recovery?behind="+c+"&conflictingRev="+d["conflicting-rev"],type:"PUT"});return"synchrony-requests"}return b[1]!=="success"&&a[1]!=="success"||b[1]!=="success"&&d.type!=="duplicate-mismatch"?"synchrony-requests":false}function K(a){var b=encodeURI(c.getServiceUrl()+"/data"+c.getEntityId()+"?optimistic=true&rewrite-request=true");if(!a.syncRev&&q.isUnpublished()&&(a.raw.length===
0||/^\s+$/.test(a.raw)))return e.Deferred().resolve([{},"success"]);if(q.isContentEmpty(a.raw)){h.trigger("analyticsEvent",{name:"confluence.synchrony.client.content.reconciliation.blank-content"});return e.Deferred().resolve([{},"success"])}return u.performRequest(function(d){c.time("confluence.editor.synchrony.CR");return C(e.ajax({type:"POST",url:b,dataType:"json",contentType:"text/plain",data:JSON.stringify({body:{ancestor:a.syncRev,rev:a.confRev,state:{format:"html",value:a.html.replace(/(<[^\s]*?>)\1\1\1\1\1\1\1\1\1\1\1\1\1\1\1\1\1\1\1(\1?)*/g,
"$1")},merges:{master:{meta:{type:"client-reconciliation"}}}},headers:{"content-type":"application/json","x-token":d},method:"PUT"})}).pipe(c.asArray,c.asArray),"confluence.editor.synchrony.CR")},"CR",{url:b,rev:a.confRev,ancestor:a.syncRev})}function r(a,b,d){var c=e.Deferred();a&&h.bind(a,function n(b,d){i.__DEBUG__&&o.debug("confluence.editor.synchrony.event: "+b.type+"."+b.namespace);h.unbind(a,n);c.resolve(d)});b&&setTimeout(c.reject,b,d||"timeout");return c}c.time("confluence.editor.synchrony.jsLoad");
var f={},s,p=i.Synchrony=i.Synchrony||{},t,j={},m,y=false;f.hasUnsavedChanges=function(){return m?m.model.get("pendingChanges")||m.model.get("saving"):false};f._bindEditor=function(a,b,d,f,j,n){c.time("confluence.editor.synchrony.init");if(D(d,f))return null;var f=e("#syncRev"),z=null;if(d[1]==="success"){d=d[0];z={base:{rev:p.rev(d.stateAt),state:d.state}};f.val(z.base.rev.toString())}i.__DEBUG__&&g.log("Synchrony will load with contentId: ",k());try{var E=b.getBody();E.setAttribute("data-title",
a.title);t=A.bind(p,b,E,z,a);H.handle(t,b,m,j,n);h.trigger("editor.remote.change");b.setDirty(false);c.timeEnd("confluence.editor.synchrony.init");return t}catch(L){o.logError(L);return null}};f._initialiseCollabEditingComponents=function(a,b){var d=e.Deferred();g.toInit(function(){e("body").addClass("synchrony-active");m=new (require("confluence-collaborative-editor-plugin/status-indicator-view"))({el:"#pluggable-status",model:new F.Model({minActiveTime:500})});u.init(m);d.resolve()});e.when(s,b).pipe(function(a){a.channel({url:c.getServiceUrl(),
topic:l.get("synchrony-app-id")+"/confluence-"+k()+"-page-move",jwt:l.get("synchrony-token")}).on("message",function(a){var b;var d=a.data;b=l.get("space-key");var c=l.get("parent-page-title");if(c===null||c==="")c=null;var e=d.spaceKey,d=d.parentPageTitle;b=l.get("content-type")==="page"?b===e&&c===d:l.get("content-type")==="blogpost"?b===e:void 0;if(!b){c=a.data.userFullName||"Another user";b=a.data;b.moverName=c;c=b.spaceName;b.parentPageTitle&&(c=c+("/"+
b.parentPageTitle));B.closeMessages(["page-moved-heartbeat"]);B.handleMessage("page-moved-heartbeat",{type:"info",title:g.format("{0} moved this page",g.escapeHtml(b.moverName)),message:g.format("It\'\'s ok, though - you can still publish your changes when you\'\'re ready. \u003cbr /\u003e\u003cbr /\u003e New Location: {0}",g.escapeHtml(c)),close:"auto"});I.updateWithPageId(k())}J.set(a.data)})});return d};f._loadSynchrony=function(){c.time("confluence.editor.synchrony.deps");var a=i.Synchrony=i.Synchrony||{};if(!a.ready){var b=a._cbs=a._cbs||[];a.ready=function(a){b.push(a)}}a.init&&
a.state===1&&a.init();a=e.Deferred();p.ready(a.resolve);return e.when(a.promise(),c.loadScript("/js/synchrony.min.js")).pipe(function(a){c.timeEnd("confluence.editor.synchrony.deps");i.__DEBUG__&&console.info("Synchrony successfully initialised.");return a})};f.load=function(a){s||(s=f._loadSynchrony());if((a||!g.DarkFeatures.isEnabled("synchrony-pessimistic-snapshot"))&&(!j.request||j.request.state()==="rejected"||j.result==="error"||j.id!==k()||6E5<Date.now()-j.time)){j.time=Date.now();j.id=k();
var b=encodeURI(c.getServiceUrl()+"/data"+c.getEntityId()+"?state-at=@head&state-format=type-tagged&rewrite-request=true&cached=true"),a=u.performRequest(function(a){c.time("confluence.editor.synchrony.snapshot");return C(e.ajax({type:"POST",url:b,contentType:"text/plain",dataType:"json",data:JSON.stringify({headers:{"content-type":"application/json","x-token":a},method:"GET"})}).pipe(c.asArray,c.asArray),"confluence.editor.synchrony.snapshot")},"snapshot",{url:b});j.request=a;j.request.done(function(a){j.result=
a[1]})}};f.edit=function(a,b){f.load(true);var d=r(null),k=r("synchrony.connected.fake"),l=r("synchrony.connected synchrony.connected.fake"),n=f._initialiseCollabEditingComponents(d,b);b.pipe(function(a){a.getBody().setAttribute("data-synchrony",true);c.time("confluence.editor.synchrony");e.when(Date.now(),k).pipe(function(a){v.setStatus("on");var b=Date.now();h.trigger("analyticsEvent",{name:"confluence.synchrony.editor.loaded",data:{durationMillis:b-a}});h.trigger("rte-collab-ready");c.timeEnd("confluence.editor.synchrony");
c.timeEnd("confluence.editor")});r("synchrony.connected synchrony.connected.fake synchrony-unsupported-extension",3E4).fail(function(a){x(a);w(a);h.trigger("analyticsEvent",{name:"confluence.synchrony.editor.load.timeout"});e("#websocketRetry").on("click",function(){h.trigger("analyticsEvent",{name:"confluence.synchrony.editor.websocket.retry.click"});i.location.reload();return false});e("#websocketFindmore").on("click",function(){h.trigger("analyticsEvent",{name:"confluence.synchrony.editor.websocket.findmore.click"})});
l.done(function(){y||h.trigger("dismiss.editor.error.message",{messageKey:"collaborative-editor-load-failure",enablePublish:true})})});G.applyBlanket(k)});a.pipe(function(a){var a=q.getContent(a),f=K(a),h=e.when(j.request,s).pipe(function(a,b){c.time("confluence.editor.synchrony.unmarshal");var d=a;a[1]==="success"&&(d=[{stateAt:a[0].stateAt,state:b.unmarshal(a[0].state.value)},a[1]]);c.timeEnd("confluence.editor.synchrony.unmarshal");return d});e.when(h,f).pipe(function(a,b){var c=D(a,b);c?d.reject(c):
d.resolve()});if(!g.DarkFeatures.isEnabled("synchrony-pessimistic-CR")&&(a.syncRevSource==="synchrony-ack"||q.isUnpublished())){i.__DEBUG__&&o.debug("confluence.editor.synchrony: content up to date, not waiting for CR");d.fail(x,w);return e.when(a,b,h,[{},"success"],n)}return e.when(a,b,h,f,n)}).pipe(function(a,b,c,g){if(!f._bindEditor(a,b,c,g,d,l)){h.trigger("analyticsEvent",{name:"confluence.synchrony.bind.failure"});return e.Deferred().reject("editor-binding-failed")}k.resolve()}).fail(function(a){b.always(function(){o.logError("Failed to load the collaborative editor",
a);x(a);w(a);g.toInit(function(){m.onDisconnectedState()});v.setStatus("failed")})})};f.register=function(){v.registerPlugin(f)};f.getSynchronisedEditorContent=function(){var a=t.ackState();if(a.rev){var b=p.makeDom(a.state,{document:document,whitelist:A.makeWhitelist(p)});return{content:require("tinymce").activeEditor.serializer.serialize(b),syncRev:a.rev.toString()}}o.logError("Synchrony hasn't acked any data, can't fetch draft data");return null};c.timeEnd("confluence.editor.synchrony.jsLoad");
return f});require("confluence/module-exporter").safeRequire("confluence-collaborative-editor-plugin/synchrony-editor",function(i){i.register()});
}catch(e){WRMCB(e)};