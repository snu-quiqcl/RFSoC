WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:subcalendar-panel', location = 'com/atlassian/confluence/extra/calendar3/components/subcalendar-panel/subcalendar-panel.js' */
define("tc/subcalendar-panel",["jquery","tc/calendar-util","tc/myCalendarTour","tc/subcalendar-entry-view","tc/subcalendar-menu-builder","tc/non-space-calendars-handler","tc/event-edit-dialog"],function(g,e,b,d,f,c,h){var a=function(p,n,i){var j=g("div.sub-calendar-names",n);var o=function(t){var s=(function(){var u=new d({CalendarPlugin:p,subCalendar:t,calendarDiv:n,cache:i}).render();return u})();return s};var r=function(){if(p.getSubCalendarsWhichCanAddEvents(n).length){g(".add-event-button",n).removeClass("hidden");g(".toolbar-group-addevent, .add-event-button",n).removeClass("hidden")}else{g(".add-event-button",n).addClass("hidden");g(".toolbar-group-addevent, .add-event-button",n).addClass("hidden")}};var k=function(){if("true"===p.getParameter(n,"readOnly")){g("#add-calendar-menu").addClass("hidden")}else{g("#add-calendar-menu").removeClass("hidden")}};var m=function(){g("<div/>",{"class":"no-subcalendars-msg",text:"You haven\'t created or subscribed to any calendars"}).appendTo(j)};var q=function(t,w){var u=g.grep(w,function(z,y){return z.type==="parent"||z.subscriptionType==="parent"});var s=function(y){var z=g(t).find(".subcalendar-item");z.each(function(B,D){var A=g(D);var G=A.data("sub-calendar-id");var E=g.grep(y,function(H){return H.subCalendarId==G});var F=p.getParameter(n,"hideWatchMenuItem")==="true";if(E.length>0&&E[0].isWatchable&&!F){var C="not-watched";if(E[0].watchedViaContent){C="watching-via-content"}else{if(E[0].watched){C="watched"}}A.addClass(C)}A.addClass("disable-loading-watching-status");b.reposition()});AJS.trigger("calendar.watch.statuses.loaded",y)};var v={};var x=g.map(u,function(y,z){return y.id});v.include=x;g.ajax({cache:false,data:v,dataType:"json",error:function(y,A,z){p.showAjaxError(n,y,A,z,p.ERROR_CLASS_SUB_CALENDAR_LIST)},success:function(z){if(z.success){var y=z.payload;s(y);p.setGenericErrors(n,null,p.ERROR_CLASS_SUB_CALENDAR_LIST)}else{p.setGenericErrors(n,"Uh oh. Looks like something unexpectedly went wrong. Please check the Confluence log file.",p.ERROR_CLASS_SUB_CALENDAR_LIST)}},type:"GET",timeout:p.ajaxTimeout,url:Confluence.TeamCalendars.getCalendarServiceBaseUrl("/subcalendars/watching/status.json")})};var l=function(s){f.build(n,p,s)};return{initSubCalendarPanel:function(){var t=function(v){new h().getEditEventDialog({start:new Date(),localizedStartTime:p.getDefaultStartTime(v),localizedEndTime:p.getDefaultEndTime(v),allDay:(v.data(p.PREF_LAST_ALL_DAY_USED)||"true")==="true"},null,p,n).show()};g(".toolbar-group-addevent .trigger-addevent, .calendar-toolbar .add-event, .add-event-button",n).click(function(){t(n);return false});var s=p.setSubCalendarSpinnerIconVisible(true);var u=function(){if(s){s.resolve()}};p.refreshCachedSubCalendars(n,function(w){if("true"===p.getParameter(n,"showHiddenSubCalendars")&&g.isArray(w)){g.each(w,function(y,x){x.eventsHidden=false})}p.updateAvailableSubCalendarsInSubCalendarPanel(n);u();if(p.isCalendarInEditMode(n)){var v=function(){n.unbind("calendar-plugin.resized",v);if("true"===p.getParameter(n,"isShowCalendarWizard")){var y=function(){Confluence.TeamCalendars.Dialogs.getSubCalendarSubscribeDialog({heading:"Welcome to Team Calendars!",callbackHandler:p.getRenderedMacroCallbackHandler(n)}).show()};var x=function(){Confluence.TeamCalendars.Dialogs.getAddDialog(p.getRenderedMacroCallbackHandler(n),{title:"Welcome to Team Calendars!",addClass:"create-calendar-first-time"})};e.showCalendarPopupHaveAnEmptySubcalendar(y,x)}};n.bind("calendar-plugin.resized",v)}},function(){u()})},updateAvailableSubCalendarsInSubCalendarPanel:function(){j.empty();r();k();var s=e.getSortedSubCalendarsByTypeAndName(p.getSubCalendars(n));l(s);window.isTeamCalendarsLoaded=true;if(!s.length){e.toggleNoCalendarPage(true);g(".no-calendar-page #add-button").click(function(t){Confluence.TeamCalendars.Dialogs.getAddDialog(p.getRenderedMacroCallbackHandler(n));t.preventDefault()});m()}else{e.toggleNoCalendarPage(false)}g.each(s,function(t,u){j.append(o(u))});if(!e.isSingleCalendarView(n)){b.start()}q(j,s);c.handle(p,n,i,s)}}};return a});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:subcalendar-panel', location = 'com/atlassian/confluence/extra/calendar3/components/subcalendar-panel/subcalendar-entry-view.js' */
define("tc/subcalendar-entry-view",["jquery","underscore","tc/calendar-util","tc-backbone","tc/child-subcalendar-entry-view","tc/subcalendar-menu-view","tc/subcalendar-displayer"],function(f,b,d,h,g,e,a){var c=h.View.extend({initialize:function(i){this.cache=i.cache;this.CalendarPlugin=i.CalendarPlugin;this.subCalendar=i.subCalendar;this.calendarDiv=i.calendarDiv;this.template=Confluence.TeamCalendars.Templates.subCalendarPanelEntry;this.childSubCalendarIds=[];this.childSubCalendarViews=[];AJS.trigger("calendar.loaded",this.subCalendar)},events:{"click .subcalendar-name":"_onClick"},render:function(){this.$el.html(this.template({subCalendar:this.subCalendar,autoConvertSupported:this.CalendarPlugin.isAutoConvertSupported(this.calendarDiv),subCalendarClasses:this.CalendarPlugin.getParameter(this.calendarDiv,"subCalendarColorClass")}));this.entryView=this.$(".subcalendar-item");this._ellipsisLongCalendarNames();this._renderChildSubCalendars();this._initEventsVisibility();if(!d.isSingleCalendarView(this.calendarDiv)){this.subcalendarDisplayer=new a({CalendarPlugin:this.CalendarPlugin,calendarDiv:this.calendarDiv,entryView:this.entryView,subCalendar:this.subCalendar,childSubCalendarIds:this.childSubCalendarIds,childSubCalendarViews:this.childSubCalendarViews})}if(d.isSpaceCalendarView(this.calendarDiv)&&!d.isDummySubscriptionParentSubCalendar(this.subCalendar)&&this.subCalendar.spaceKey!==undefined){this.$(".subcalendar-name").addClass("header-color")}this.menuView=new e({cache:this.cache,CalendarPlugin:this.CalendarPlugin,calendarDiv:this.calendarDiv,subCalendar:this.subCalendar,subCalendarEntryView:this.entryView,autoConvertSupported:this.CalendarPlugin.isAutoConvertSupported(this.calendarDiv),subCalendarClasses:this.CalendarPlugin.getParameter(this.calendarDiv,"subCalendarColorClass"),template:Confluence.TeamCalendars.Templates.subCalendarMenu,subcalendarDisplayer:this.subcalendarDisplayer});this.$(".subcalendar-info").append(this.menuView.render());return this.$el},_ellipsisLongCalendarNames:function(){this.$(".subcalendar-name").attr("title",this.$(".ellipsis_text").text())},_renderChildSubCalendars:function(){if(this.subCalendar.childSubCalendars){this.childSubCalendarIds=[];this.childSubCalendarViews=[];var i=this;b.each(this.subCalendar.childSubCalendars,function(k){var j=k.customEventTypes;if(j&&j.length){b.each(j,function(l){i._renderChildSubCalendar(k,l)})}else{i._renderChildSubCalendar(k)}})}},_renderChildSubCalendar:function(k,j){var l=this.$(".child-subcalendars");var i={cache:this.cache,CalendarPlugin:this.CalendarPlugin,calendarDiv:this.calendarDiv,parentView:this.entryView,parentSubCalendar:this.subCalendar,childSubCalendar:k};if(j){i.customEventType=j;i.template=Confluence.TeamCalendars.Templates.customEventTypePanelEntry}else{i.template=Confluence.TeamCalendars.Templates.childSubCalendarPanelEntry}var m=new g(i).render();l.append(m);this.childSubCalendarIds.push(k.id);this.childSubCalendarViews.push(m.find(".child-subcalendar"))},_onClick:function(){if(!d.isSpaceCalendarView(this.calendarDiv)||d.isDummySubscriptionParentSubCalendar(this.subCalendar)||this.subCalendar.spaceKey===undefined){return}Confluence.TeamCalendars.fireEventForAnalytics("view.calendar.detail.click");window.location.href=AJS.contextPath()+"/display/"+encodeURIComponent(this.subCalendar.spaceKey)+"/calendar/"+encodeURIComponent(this.subCalendar.subscriptionId||this.subCalendar.id)+"?calendarName="+encodeURIComponent(this.subCalendar.name)},_initEventsVisibility:function(){var j=[];var i=[];if(d.isSubscriptionSubCalendar(this.subCalendar)){if(this.subCalendar.eventsHidden||f.inArray(this.subCalendar.id,i)!==-1){this.entryView.addClass("subcalendar-disabled");i.push(this.subCalendar.id)}else{if(!d.isDummySubscriptionParentSubCalendar(this.subCalendar)){j.push(this.subCalendar.id)}}}b.each(this.childSubCalendarViews,function(k){var l=this.CalendarPlugin.getSubCalendar(this.calendarDiv,k.data("subCalendarId"));if(!d.isSingleCalendarView(this.calendarDiv)&&(l.eventsHidden||f.inArray(l.id,i)!==-1)){k.addClass("subcalendar-disabled");i.push(l.id)}else{j.push(l.id)}},this);if(j.length){this.CalendarPlugin.addSubCalendarEventSource(this.calendarDiv,j)}if(i.length){this.entryView.addClass("subcalendar-disabled")}if(this.childSubCalendarViews.length){this.CalendarPlugin.checkCalendarHasAllChildDisable(this.entryView)}else{if(!d.isSingleCalendarView(this.calendarDiv)&&this.subCalendar.eventsHidden){this.entryView.addClass("subcalendar-disabled")}}}});return c});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:subcalendar-panel', location = 'com/atlassian/confluence/extra/calendar3/components/subcalendar-panel/subcalendar-menu-view.js' */
define("tc/subcalendar-menu-view",["jquery","underscore","tc-backbone","tc/myCalendarTour","tc/calendar-util"],function(e,j,i,h,f){var k=i.View.extend({initialize:function(l){this.cache=l.cache;this.CalendarPlugin=l.CalendarPlugin;this.calendarDiv=l.calendarDiv;this.subCalendar=l.subCalendar;this.parentSubCalendar=l.parentSubCalendar;this.$subCalendarEntryView=l.subCalendarEntryView;this.template=l.template;this.subcalendarDisplayer=l.subcalendarDisplayer},events:{"click .subcalendar-addevent":"_onAddEventClick","click .subcalendar-watch":"_onWatchClick","click .subcalendar-unwatch":"_onUnWatchClick","click .subcalendar-edit, .subcalendar-view":"_onEditClick","click .subcalendar-restrict":"_onRestrictClick","click .subcalendar-remove":"_onRemoveClick","click .subcalendar-share, .subcalendar-share-or-embed":"_onShareClick","click .subcalendar-subscribe":"_onSubscribeClick","click .subcalendar-reload":"_onRefreshClick","click .subcalendar-reminder":"_onReminderClick","click .custom-event-type-edit, .setting-reminder-setting":"_onEditEventTypeClick","click .color-cell":"_onColorCellClick","click .subcalendar-display-hide, .subcalendar-display-show":"_onDisplayClick"},render:function(){this.$el.html(this.template({subCalendar:this.subCalendar,autoConvertSupported:this.CalendarPlugin.isAutoConvertSupported(this.calendarDiv),subCalendarClasses:this.CalendarPlugin.getParameter(this.calendarDiv,"subCalendarColorClass"),parentSubCalendar:this.parentSubCalendar}));this._initExportLink();this._initDetailLink();this._initMenuItemsDropDown();return this.$el},_initMenuItemsDropDown:function(){this.$(".subcalendar-dropdown-menu").dropDown("Standard",{alignment:"right",hideHandler:function(){h.hideLeg()}})},_initExportLink:function(){this.$(".subcalendar-icalexport").attr("href",this.CalendarPlugin.getCalendarServiceBaseUrl(this.calendarDiv,"/export/subcalendar/"+encodeURIComponent(this.subCalendar.id+".ics")+"?os_authType=basic&isSubscribe=false"))},_initDetailLink:function(){this.$(".subcalendar-page").attr("href",AJS.contextPath()+"/display/"+encodeURIComponent(this.subCalendar.spaceKey)+"/calendar/"+encodeURIComponent(this.subCalendar.subscriptionId||this.subCalendar.id)+"?calendarName="+encodeURIComponent(this.subCalendar.name))},_onAddEventClick:function(l){Confluence.TeamCalendars.Dialogs.getEditEventDialog({start:new Date(),localizedStartTime:this.CalendarPlugin.getDefaultStartTime(this.calendarDiv),localizedEndTime:this.CalendarPlugin.getDefaultEndTime(this.calendarDiv),allDay:(this.calendarDiv.data(this.CalendarPlugin.PREF_LAST_ALL_DAY_USED)||"true")==="true",subCalendarId:this.subCalendar.id},this.subCalendar,this.CalendarPlugin,this.calendarDiv).show();l.preventDefault()},_onWatchClick:function(l){d(this.CalendarPlugin,this.calendarDiv,this.subCalendar,true,j.bind(function(){this.$subCalendarEntryView.addClass("watched").removeClass("not-watched")},this));l.preventDefault()},_onUnWatchClick:function(l){d(this.CalendarPlugin,this.calendarDiv,this.subCalendar,false,j.bind(function(){this.$subCalendarEntryView.removeClass("watched").addClass("not-watched")},this));l.preventDefault()},_onEditClick:function(l){this.CalendarPlugin.showSubCalendarEdit(this.calendarDiv,this.subCalendar);e("#edit-calendar-dialog").find(".button-panel-button.submit").removeClass("hidden");l.preventDefault()},_onRestrictClick:function(l){this.CalendarPlugin.getSubCalendarRestrictionsDialog(this.calendarDiv,this.subCalendar);l.preventDefault()},_onRemoveClick:function(l){if(this.CalendarPlugin.isSubCalendarDeletable(this.calendarDiv,this.subCalendar)){if(f.isJiraSubCalendar(this.subCalendar)){this.CalendarPlugin.deleteSubCalendar(this.calendarDiv,this.subCalendar)}else{this.CalendarPlugin.removeSubCalendarDialog(this.calendarDiv,this.subCalendar)}}else{this.CalendarPlugin.unsubscribeFromSubcalendar(this.calendarDiv,this.subCalendar)}l.preventDefault()},_onShareClick:function(l){this.CalendarPlugin.getSubCalendarShareDialog(this.calendarDiv,this.subCalendar);l.preventDefault()},_onSubscribeClick:function(l){this.CalendarPlugin.getSubCalendarIcalAddressDialog(this.calendarDiv,this.subCalendar);l.preventDefault()},_onRefreshClick:function(m){if(!this.CalendarPlugin.isSubCalendarEventsUpdatable(this.calendarDiv,this.subCalendar)||g(this.subCalendar)||f.isSubscriptionSubCalendar(this.subCalendar)){var l=this;e.ajax({cache:false,data:{subCalendarId:this.subCalendar.id},dataType:"json",error:function(n,p,o){l.CalendarPlugin.showAjaxError(l.calendarDiv,n,p,o,l.CalendarPlugin.ERROR_CLASS_SUB_CALENDAR_LIST_EVENTS+l.CalendarPlugin.getStringAsHex(l.subCalendar.id))},success:function(n){l.CalendarPlugin.setGenericErrors(l.calendarDiv,null,l.CalendarPlugin.ERROR_CLASS_SUB_CALENDAR_LIST_EVENTS+l.CalendarPlugin.getStringAsHex(l.subCalendar.id));if(n.success){l.CalendarPlugin.reloadSubCalendar(l.calendarDiv,l.subCalendar.id)}},type:"PUT",timeout:this.CalendarPlugin.ajaxTimeout,url:this.CalendarPlugin.getCalendarServiceBaseUrl(this.calendarDiv,"/subcalendars/admin/refresh.json")})}else{this.CalendarPlugin.reloadSubCalendar(this.calendarDiv,this.subCalendar.id)}m.preventDefault()},_onReminderClick:function(l){b(this.CalendarPlugin,this.calendarDiv,this.subCalendar,this.subCalendar.id,j.bind(function(){this.$subCalendarEntryView.find(".reminder-me").toggleClass("hidden");this.$subCalendarEntryView.find(".unreminder-me").toggleClass("hidden")},this),this.$subCalendarEntryView.find(".reminder-me.hidden").length?false:true);l.preventDefault()},_onEditEventTypeClick:function(l){var m=this.$subCalendarEntryView.data("customEventTypeId");if(!m){m=f.isInternalSubscriptionSubCalendar(this.subCalendar)?this.subCalendar.subscriptionType:this.subCalendar.type}this.CalendarPlugin.showCustomEventEditForm(this.calendarDiv,this.parentSubCalendar,m);l.preventDefault()},_onColorCellClick:function(n){if(!this.CalendarPlugin.isProcessingSubCalendar(this.calendarDiv)){this.CalendarPlugin.setProcessingSubCalendar(this.calendarDiv,true);var o=e(n.target);var l=this.subCalendar;var m=this;a(this.CalendarPlugin,this.calendarDiv,l,o.data("colour"),function(p){if(p.success){m.cache.removeCalendar(l.id);m.CalendarPlugin.setGenericErrors(m.calendarDiv,null,m.CalendarPlugin.ERROR_CLASS_SUB_CALENDAR_UPDATE);m.CalendarPlugin.setSubCalendars(m.calendarDiv,p.payload);m.CalendarPlugin.removeSubCalendarEventSource(m.calendarDiv,l.id);m.CalendarPlugin.updateAvailableSubCalendarsInSubCalendarPanel(m.calendarDiv);m.$subCalendarEntryView.removeClass().addClass("aui-dd-parent "+o.data("colour"))}else{m.CalendarPlugin.setGenericErrors(m.calendarDiv,"Unable to change the colour of the calendar. Please authenticate first.",m.CalendarPlugin.ERROR_CLASS_SUB_CALENDAR_UPDATE)}c(m.CalendarPlugin,m.calendarDiv)},c(m.CalendarPlugin,m.calendarDiv))}n.preventDefault()},_onDisplayClick:function(l){this.subcalendarDisplayer.toggleVisibility();l.preventDefault()}});var d=function(p,o,m,n,l){e.ajax({cache:false,data:{subCalendarId:m.id},dataType:"json",error:function(q,s,r){p.showAjaxError(o,q,s,r,p.ERROR_CLASS_SUB_CALENDAR_WATCH+p.getStringAsHex(m.id))},success:function(){if(l){l()}},type:n?"PUT":"DELETE",timeout:p.ajaxTimeout,url:p.getCalendarServiceBaseUrl(o,"/preferences/subcalendars/watch.json")})};var g=function(l){return l&&(f.isJiraSubCalendar(l)||e.grep(l.childSubCalendars||[],function(m){return g(m)}).length)};var b=function(p,o,n,m,l,q){e.ajax({cache:false,data:{subCalendarId:m,isReminder:q},dataType:"json",error:function(r,t,s){p.showAjaxError(o,r,t,s,p.ERROR_CLASS_SUB_CALENDAR_WATCH+p.getStringAsHex(n.id))},success:function(){if(l){l()}},type:"PUT",timeout:p.ajaxTimeout,url:p.getCalendarServiceBaseUrl(o,"/preferences/subcalendars/setreminder.json")})};var c=function(m,l){m.setProcessingSubCalendar(l,false)};var a=function(r,q,o,p,l,m){var n=r.setSubCalendarSpinnerIconVisible(true);e.ajax({cache:false,converters:{"text json":function(s){return s}},data:(function(){var s={subCalendarId:o.id,color:p};if(r.getParameter(q,"include")){s.include=r.getParameter(q,"include")}f.putCalendarContextParams(s);return s})(),dataType:"json",dataFilter:function(s){var t=e.parseJSON(s);if(t.success){r.mergeSubCalendarObjectsToArray(t.payload)}return t},error:function(s,u,t){r.showAjaxError(q,s,u,t,r.ERROR_CLASS_SUB_CALENDAR_UPDATE);if(m){m(s,u,t)}},success:function(s){if(l){l(s)}},complete:function(){if(n){n.resolve()}},type:"PUT",timeout:r.ajaxTimeout,url:r.getCalendarServiceBaseUrl(q,"/subcalendars/color.json")})};return k});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:subcalendar-panel', location = 'com/atlassian/confluence/extra/calendar3/components/subcalendar-panel/child-subcalendar-entry-view.js' */
define("tc/child-subcalendar-entry-view",["jquery","tc-backbone","tc/calendar-util","tc/subcalendar-menu-view","tc/subcalendar-displayer"],function(d,f,b,c,a){var e=f.View.extend({initialize:function(g){this.cache=g.cache;this.parentSubCalendar=g.parentSubCalendar;this.childSubCalendar=g.childSubCalendar;this.customEventType=g.customEventType;this.CalendarPlugin=g.CalendarPlugin;this.calendarDiv=g.calendarDiv;this.parentView=g.parentView;this.template=g.template},events:{"mouseenter .child-subcalendar":"_onHover","mouseleave .child-subcalendar":"_onHover","click .child-subcalendar-name":"_onClick"},render:function(){this.$el.html(this.template({childSubCalendar:this.childSubCalendar,customEventType:this.customEventType}));this.entryView=this.$(".child-subcalendar");var g={cache:this.cache,CalendarPlugin:this.CalendarPlugin,calendarDiv:this.calendarDiv,subCalendar:this.childSubCalendar,parentSubCalendar:this.parentSubCalendar,subCalendarEntryView:this.entryView,autoConvertSupported:this.CalendarPlugin.isAutoConvertSupported(this.calendarDiv),subCalendarClasses:this.CalendarPlugin.getParameter(this.calendarDiv,"subCalendarColorClass")};if(this.customEventType){g.template=Confluence.TeamCalendars.Templates.customEventTypeMenu}else{g.template=Confluence.TeamCalendars.Templates.childSubCalendarMenu}this.entryView.append(new c(g).render());this._ellipsisChildSubCalendarName();this.subcalendarDisplayer=new a({CalendarPlugin:this.CalendarPlugin,calendarDiv:this.calendarDiv,entryView:this.entryView,subCalendar:this.childSubCalendar,parentView:this.parentView,parentSubCalendar:this.parentSubCalendar});return this.$el},_ellipsisChildSubCalendarName:function(){var g=this.$(".child-subcalendar-name");if(!g.attr("threedots")){g.attr("title",this.$(".ellipsis_text").text())}},_onHover:function(){this.entryView.toggleClass("active-child-subcalendar")},_onClick:function(){this.subcalendarDisplayer.toggleVisibility()}});return e});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:subcalendar-panel', location = 'com/atlassian/confluence/extra/calendar3/components/subcalendar-panel/subcalendar-menu-builder.js' */
define("tc/subcalendar-menu-builder",["jquery","underscore","tc/calendar-util"],function(c,a,b){var d=function(p,r,h){var n=r.getParameter(p,"readOnly")==="true",l=r.getParameter(p,"isNotificationsEnabled")==="true",k=r.getParameter(p,"hideEditMenuItem")==="true",m=r.getParameter(p,"hideRemoveMenuItem")==="true",i=r.getParameter(p,"hideColorGrid")==="true",g=AJS.Meta.get("remote-user");function e(s,t){if(b.isSingleCalendarView(p)){j(s,t)}else{o(s,t)}}function o(t,u){var v=b.isJiraSubCalendar(t),s=b.isSubscriptionSubCalendar(t);t.displayName=t.name;if(b.isSubscriptionSubCalendar(t)&&!u){t.menuOptions={showMenu:false}}else{t.menuOptions={showMenu:true,showAddEvent:!n&&!v&&t.eventsEditable,showNotifications:l&&!u,showEdit:q(t)||b.isSubscriptionSubCalendar(t),showView:!k&&!n&&!t.editable,showRestrictions:!n&&t.administrable&&!v,showRemove:!m&&!n&&t.editable&&((!u||b.isSubscriptionSubCalendar(t))?true:t.eventsEditable),showShareAndSubscribe:t.eventsViewable&&!v,showSubscribe:!v,showColourGrid:!i&&(s||v)&&g.length>0,showReload:t.reloadable,showDisplayLink:true}}}function j(s,t){o(s,t);var u=s.menuOptions;u.showEdit=false;u.showRemove=false;if(b.isJiraSubCalendar(s)){u.showEdit=true;u.showRemove=true}u.showRestrictions=false;u.showDisplayLink=false;s.menuOptions=u}function q(s){return !n&&s.editable&&s.eventsEditable}function f(s,v){var t=v.subscriptionType||v.type;if(b.isEventTypeSanbox(t)||b.isJiraType(t)){var u=b.getPeriodReminderEventTypeSanboxOrJira(s,t);return u!==undefined&&u>0}else{if(b.isCustomEventType(t)){return v.customEventTypes[0].periodInMins>0}}}a.each(h,function(s){e(s,false);if(s.childSubCalendars){a.each(s.childSubCalendars,function(v){var t=v.typeKey;var u=r.getEventTypeNames(t);if(b.isSubscriptionSubCalendar(v)){e(v,true);v.menuOptions=c.extend(v.menuOptions,{showDisplayLink:false})}else{if(b.isJiraSubCalendar(v)){e(v,true);v.menuOptions=c.extend(v.menuOptions,{showReminder:g.length>0&&f(s,v),showSettingReminder:g.length>0&&!f(s,v)&&q(s),showDisplayLink:false})}else{v.menuOptions={showMenu:true,showColourGrid:g.length>0,showReload:true,showReminder:g.length>0&&f(s,v),showSettingReminder:g.length>0&&!f(s,v)&&q(s)};v.displayName=u}}})}})};return{build:d}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.extra.team-calendars:subcalendar-panel', location = 'com/atlassian/confluence/extra/calendar3/components/subcalendar-panel/subcalendar-displayer.js' */
define("tc/subcalendar-displayer",["jquery","underscore","tc/calendar-util"],function(d,b,c){var a=function(n){var l=n.CalendarPlugin,k=n.calendarDiv,h=n.entryView,i=n.subCalendar,e=n.childSubCalendarIds,f=n.childSubCalendarViews,m=n.parentView,g=n.parentSubCalendar;var j=function(){var q;var r=h.hasClass("child-subcalendar");if(r){q=[i.id]}else{q=b.clone(e)}var o=!h.hasClass("subcalendar-disabled");h.toggleClass("subcalendar-disabled",o);if(!r){h.toggleClass("allchildsubcalendar-disabled",o);b.each(f,b.bind(function(s){s.toggleClass("subcalendar-disabled",o)},this))}if(!c.isDummySubscriptionParentSubCalendar(r?g:i)){q.push(i.id)}if(!c.isSingleCalendarView(k)){l.setSubCalendarEventsHidden(k,q,o,m)}if(o){l.removeSubCalendarEventSource(k,q)}else{l.addSubCalendarEventSource(k,q)}var p="";if(r){if(o){p="hide.event.click."}else{p="show.event.click."}}else{if(o){p="hide.calendar.click."}else{p="show.calendar.click."}}if(c.isSingleCalendarView(k)){p+="singleCalendar"}else{p+=Confluence.TeamCalendars.getCalendarContext()}Confluence.TeamCalendars.fireEventForAnalytics(p)};return{toggleVisibility:function(){j()}}};return a});
}catch(e){WRMCB(e)};