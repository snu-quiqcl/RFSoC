WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:resources', location = 'com/atlassian/confluence/plugins/createcontent/soy/initial-templates.soy' */
// This file was automatically generated from initial-templates.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.Blueprints.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Blueprints == 'undefined') { Confluence.Templates.Blueprints = {}; }


Confluence.Templates.Blueprints.createDialogBody = function(opt_data, opt_ignored) {
  return Confluence.Templates.Blueprints.waitContainer(null) + '<div class="create-dialog-body loadable"><div class="template-select-container">' + Confluence.Templates.Blueprints.waitContainer(null) + '<div class="template-select-container-body loadable"></div></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Blueprints.createDialogBody.soyTemplateName = 'Confluence.Templates.Blueprints.createDialogBody';
}


Confluence.Templates.Blueprints.waitContainer = function(opt_data, opt_ignored) {
  return '<div class="wait-container">' + Confluence.Templates.Blueprints.waitIcon(null) + '</div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Blueprints.waitContainer.soyTemplateName = 'Confluence.Templates.Blueprints.waitContainer';
}


Confluence.Templates.Blueprints.waitIcon = function(opt_data, opt_ignored) {
  return '<div class="wait-icon"></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.Blueprints.waitIcon.soyTemplateName = 'Confluence.Templates.Blueprints.waitIcon';
}


Confluence.Templates.Blueprints.helpLink = function(opt_data, opt_ignored) {
  return '' + Confluence.Templates.Dialog.helpLink({href: "https:\/\/confluence.atlassian.com\/display\/ConfCloud\/Pages+and+Blogs"});
};
if (goog.DEBUG) {
  Confluence.Templates.Blueprints.helpLink.soyTemplateName = 'Confluence.Templates.Blueprints.helpLink';
}


Confluence.Templates.Blueprints.spaceHelpLink = function(opt_data, opt_ignored) {
  return '' + Confluence.Templates.Dialog.helpLink({href: "https:\/\/confluence.atlassian.com\/display\/ConfCloud\/Create+a+Space"});
};
if (goog.DEBUG) {
  Confluence.Templates.Blueprints.spaceHelpLink.soyTemplateName = 'Confluence.Templates.Blueprints.spaceHelpLink';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:resources', location = 'com/atlassian/confluence/plugins/createcontent/soy/discovery-tooltip.soy' */
// This file was automatically generated from discovery-tooltip.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Quick.Create.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Quick == 'undefined') { Confluence.Quick = {}; }
if (typeof Confluence.Quick.Create == 'undefined') { Confluence.Quick.Create = {}; }


Confluence.Quick.Create.discoveryTooltip = function(opt_data, opt_ignored) {
  return '<p class="title">' + soy.$$escapeHtml('TIME-SAVING TEMPLATES') + '</p><p>' + soy.$$filterNoAutoescape('Want some help creating awesome pages quickly? There are some useful templates here, to help get you started.') + '</p><p><button class="aui-button" id="closeDisDialog">' + soy.$$escapeHtml('Okay, got it') + '</button></p>';
};
if (goog.DEBUG) {
  Confluence.Quick.Create.discoveryTooltip.soyTemplateName = 'Confluence.Quick.Create.discoveryTooltip';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:resources', location = 'com/atlassian/confluence/plugins/createcontent/js/create-dialog-base.js' */
Confluence.Dialogs=Confluence.Dialogs||{};(function(c){function b(g,f){try{return require(g)}catch(d){console.error(d);return f}}Confluence.Dialogs.CreateDialogBase=function a(P){var h,ab,s=P.dialogId,y=P.webItemsPath,C=[],i=false,ad=b("confluence/api/event",{bind:function(){}}),v=require("confluence/confluence-storage-manager")("confluence-create-content-plugin"),K=b("confluence/legacy-message-queue-analytics",{send:function(){}}),G,E=true,ac=false,ae,Y,V;function D(af){if(!ab){return}if(ab.find(".button-panel-cancel-link:visible").is(".disabled")){return}if(Confluence.Blueprint.HowToUse){Confluence.Blueprint.HowToUse.notifyCancel(h)}if(af){X()}h.remove();c(".tipsy").remove();h=null;ab=null;c(window).removeProp("disabled");if(V){V.focus()}return false}function Z(){return c(".create-dialog-create-button:visible")}function U(){return c(".create-dialog-body .template:visible").length}function J(af){return af.data("content-blueprint-id")}function L(ah){var aj=J(ah),ag=ah.data("template-id"),ai=aj||ag,af=aj?"contentBlueprintId":"templateId";if(!ai){return aa("itemModuleCompleteKey",ah.data("item-module-complete-key"))}return aa(af,ai)}function n(ag,af){if(!U()){return false}if(c(this).attr("disabled")==="disabled"){return false}c(this).attr("disabled","disabled").before('<div class="create-dialog-button-spinner"></div>');c(".create-dialog-button-spinner").spin("small");var aj=H.getSpaceKey();var ai=c(".template.selected");var ah=L(ai);if(!ah){throw new Error("Expected at least one template to be selected")}ah.spaceKey=aj;ah.spaTransitionEnabled=af.spaTransitionEnabled;if(af.parentPageSpaceKey===aj){ah.parentPageId=af.parentPageId;ah.parentPageType=af.parentPageType;ah.parentPageTitle=af.parentPageTitle;ah.parentPageSpaceKey=af.parentPageSpaceKey}Confluence.Blueprint.fireWizard(ag,ah,h)}function A(){if(!U()){Z().attr("disabled","disabled")}else{Z().removeAttr("disabled")}}function aa(af,ag){return _.find(H.loadedWebitems[H.getSpaceKey()],function(ah){return ah[af]==ag})}function R(af){return aa("contentBlueprintId",af)}function N(ah){var ag=R(ah);var af=ag&&ag.wizard;var ai=f(!af);Z().text(ai)}function u(af,ag){af.addClass("selected").find("input[type='radio']").attr("checked","true");af.siblings().removeClass("selected").find("input[type='radio']").removeAttr("checked");if(ag&&ag.shouldFocusRadioButton){af.find("input[type='radio']").focus()}N(J(af));AJS.trigger(Confluence.Dialogs.Events.ITEM_SELECTED,{item:af})}function t(af,ak){var ah=af.find(".template");var aj=ah.filter(".selected");var ag=ah.index(aj)+ak;ag=ag%ah.length;var ai=ah.eq(ag);u(ai,{shouldFocusRadioButton:true});ai.focus();af.simpleScrollTo(ai)}function d(ag){var af=2;switch(ag){case 37:return -1;case 39:return +1;case 38:return -af;case 40:return +af}return 0}function Q(af){af.bind("keydown",function(ag){var ah=d(ag.which);if(ah){t(af,ah);return AJS.stopEvent(ag)}})}function j(af){return af==="com.atlassian.confluence.plugins.confluence-create-content-plugin:create-blank-page"||af==="com.atlassian.confluence.plugins.confluence-create-content-plugin:create-blog-post"}function B(ag,ah,af){AJS.flag({type:ag,title:ah,body:af})}function o(at,ak){var ar=H.getSpaceKey();var av=H.loadedWebitems[ar];av=H.filterWebItems(av);i=av&&av.length>0&&_.some(av,function(ax){return ax.isPromoted});C=q(av);if(!i&&at){av=C}var ag=Confluence.Templates.Blueprints.templates({webItems:av,spaceKey:ar});var ap=c(ag);var an=O(ap);if(window.location.search.includes("createDialogWACErrorMessage")){var ah=window.location.search.split("createDialogWACErrorMessage=")[1].split("&")[0];var aw={"all.purpose":["Something went wrong","We can not present you with the right template. Choose one of the available templates, or go back to www.atlassian.com and try again."],"disable.blueprint":["The template is not available","Your Confluence admin has disabled this template.  Contact your admin to make it available."]};B("error",aw[ah][0],aw[ah][1])}if(window.location.search.includes("createDialogWACWarningMessage")){var ao=window.location.search.split("createDialogWACWarningMessage=")[1].split("&")[0];var am={"no.personal.space":["No personal space available","Since you do not have a personal space, select a space before creating the template."],"old.editor.template":["This template will use the old editor","Your Confluence site is not ready to use the version of this template, which was created using the new editor."]};B("warning",am[ao][0],am[ao][1])}if(i&&an===undefined){var ar=H.getSpaceKey();var aj=c.parseJSON(v.getItem("showMore"))||{};var aq=aj[ar];if(!aq||aq<3){var ai=ap.find(".template");_.each(ai,function(ay){var ax=c(ay);var az=L(ax);if(!az.isPromoted&&!j(az.itemModuleCompleteKey)){ax.hide()}});var au=ap.append(Confluence.Templates.Blueprints.Promoted.showMore())[0];c("#promoted-link",au).click(function(){aj[ar]=(aq||0)+1;v.setItemQuietly("showMore",JSON.stringify(aj));c(this).closest(".templates").find(".template").css("display","");c(this).closest("li").remove();A()})}}var af=ab.find(".templates");if(af.length){if(ak){af.fadeOut(150,function(){af.replaceWith(ap.fadeIn(150));x();r();Q(ap)})}else{af.replaceWith(ap)}}else{c(".template-select-container-body").append(ap)}if(S()){var al=!at;F(C.length,al)}else{e()}if(ab.searcher){ab.searcher.refreshItems();ab.searcher.filter()}ab.find(".loading").removeClass("loading");ab.trigger("create-content.loaded");r();Q(ap);if(S()){x()}if(an!==undefined){E=false;ab.find(".templates").simpleScrollTo(an.first().click());E=true}A()}function m(af){AJS.log("Attempted to select a blueprint that could not be found in the create dialog: "+af)}function O(aj){var ag;if(window.location.search.includes("createDialogBlueprintModule")){var al=window.location.search.split("createDialogBlueprintModule=")[1].split("&")[0];ag=aj.find('.template[data-blueprint-module-complete-key="'+al+'"]');if(ag.length){return ag}m(al)}else{if(!h.initContext){return}var ak;var ai=Confluence.Blueprint.Selector.getSelectors();for(var ah=0,af=ai.length;ah<af;ah++){ak=ai[ah](h.initContext);if(ak&&ak.length){ag=aj.find('.template[data-item-module-complete-key="'+ak+'"]');if(ag.length){return ag}else{m(ak)}}}}}function x(){var af=c(".templates");af.css("height",af.outerHeight(false)-c("#discover-new-banner").outerHeight())}function r(){E=false;c(".template").click(function(){u(c(this))}).dblclick(function(){Z().click()});c(".template:visible:first").click();c(".template").click(function(){if(E){K.send("ui",{source:"createPageModal",actionSubject:"template",action:"clicked",actionSubjectId:"template",attributes:{templateName:c(this).find(".template-name").text()||"",templateId:this.dataset.templateId||"",blueprintId:this.dataset.contentBlueprintId||"",blueprintKey:this.dataset.blueprintModuleCompleteKey||""}})}});E=true}function q(ak){var aj="",ah=[],ai=[];for(var ag=0,af=ak.length;ag<af;ag++){if(ak[ag].isNew){ai=W();aj=(c.inArray(ak[ag].itemModuleCompleteKey,ai)!=-1);if(aj){ak[ag].isNew=false}else{ah.push(ak[ag])}}}return ah}function M(){var af=c.parseJSON(v.getItem("dismissed"));return af||[]}function W(){var af=c.parseJSON(v.getItem("used"));return af||[]}function e(){var af=c("#discover-new-banner");if(af.length){af.remove()}}function F(ai,ag){e();var af=Confluence.Templates.Blueprints.discoverNewBanner({newItemsNo:ai,showLinkToNew:ag});var ah=c(".template-select-container-body");ah.prepend(af);ah.find(".aui-button-link").click(function(){var aj=!c(this).data("is-filtered");H.fillWebItemsInDialog(aj,true)});c("#discover-new-banner .icon-close").click(function(){c("#discover-new-banner").slideUp(150);var al=M();var ak,am,aj;for(ak=0,aj=C.length;ak<aj;ak++){am=C[ak].itemModuleCompleteKey;if(c.inArray(am,al)==-1){al.push(am)}}v.setItemQuietly("dismissed",JSON.stringify(al));H.fillWebItemsInDialog(false)})}function S(){if(C.length==0||i){return false}var ag=M();if(ag.length==0){return true}for(var af=0;af<C.length;++af){if(c.inArray(C[af].itemModuleCompleteKey,ag)==-1){return true}}return false}function p(ag,af){V=af;ae="mouseClick";Y=void 0;var ag=ag||{},ai=function(ak){if(h){if(ak.keyCode===27){D(true);if(G===".create-page"){K.send("ui",{source:"createPageModal",actionSubject:"keyboardShortcut",action:"pressed",actionSubjectId:"close"})}}else{if(ak.keyCode===13){var al=ak.target.nodeName&&ak.target.nodeName.toLowerCase();if(al=="textarea"||al=="a"){return}if(G===".create-page"){ae="keyPress";Y="enter"}Z().click()}}}};G=ag.triggerSrc?"."+ag.triggerSrc:"";var ah={width:840,height:511,id:s,closeOnOutsideClick:false,keypressListener:ai,focusSelector:".templates"};h=c.extend(new AJS.Dialog(ah),H);ab=h.popup.element;h.addHeader(P.headingText);h.initContext=ag.initContext;var aj=ab.searcher=Confluence.DomFilterField({items:"#create-dialog .templates .template",inputId:"createDialogFilter",placeholderText:"Filter",postSearch:function(ak){E=false;if(ak.length==0){AJS.trigger(Confluence.Dialogs.Events.ITEM_SELECTED,{noVisibleItem:true})}else{ak.eq(0).click()}if(!ag.showStepOne){A()}if(ac){K.send("ui",{source:"createPageModal",actionSubject:"submitted",action:"search",actionSubjectId:"templateSearchBar"});ac=false}E=true},submitCallback:function(ak,al){E=false;ak.eq(0).dblclick();E=true}});aj.form.find("input").keyup(function(){ac=true});ab.find(".dialog-header").append(aj.form,P.helpLinkTemplate());h.addPanel("SinglePanel",Confluence.Templates.Blueprints.createDialogBody(),"loading");c.extend(h,{addButtonPanel:z,addFullButtonPanel:l,addBackButton:w,removeBackButton:k});h.addButtonPanel(h.getPage(0),function(ak){n(ak,{parentPageId:ag.parentPageId,parentPageTitle:ag.parentPageTitle,parentPageType:ag.parentPageType,parentPageSpaceKey:ag.parentPageSpaceKey,spaTransitionEnabled:ag.spaTransitionEnabled,})});h.prevPage=function(){ab.find(".create-dialog-button-spinner").remove();ab.find(".create-dialog-create-button").removeAttr("disabled");c(window).removeProp("disabled");return AJS.Dialog.prototype.prevPage.apply(h,arguments)};ab.options=ag=c.extend({showDialog:true,updateHeight:true},ag);h.getPanel(0).setPadding(0);h.gotoPanel(0);c("#create-dialog").find(".wait-icon").spin("medium");ag.showDialog&&h.show();Confluence.sessionCheck();ad.bind("blueprint.before-create",function(){var al=ae==="keyPress";var an=al?"keyboardShortcut":"button";var am=al?"pressed":"clicked";var ak=al?{key:Y}:void 0;K.send("ui",{source:"createPageModal",actionSubject:an,action:am,actionSubjectId:"create",attributes:ak})});return h}function f(af){return af?"Create":"Next"}function g(af){return function(ag,ah,aj){var ai=af&&af.call(this,ag,ah);if(ai!==true&&aj){aj.preventDefault()}else{return ai}}}function z(aj,ai,af,ah){var ag=f(af);aj.addButton(AJS.I18n.getText(ag),null,"create-dialog-create-button");aj.buttonpanel.find(".button-panel-button").removeClass("button-panel-button").addClass("aui-button");aj.buttonpanel.find(".create-dialog-create-button").click(function(ap){var ao=L(c(".template.selected"));if(!ao||(!ao.templateId&&!j(ao.itemModuleCompleteKey))){return}var al=ae==="keyPress";var an=al?"keyboardShortcut":"button";var am=al?"pressed":"clicked";var ak=al?{key:Y}:void 0;K.send("ui",{source:"createPageModal",actionSubject:an,action:am,actionSubjectId:"create",attributes:ak})});aj.buttonpanel.find(".create-dialog-create-button").addClass("aui-button-primary").click(function(ak){ai(ak);c("#create-dialog").find(".dialog-page-menu").remove(".dialog-page-menu[style*='display: none']")});aj.buttonpanel.find(".create-dialog-create-button").attr("data-test-id","create-dialog-create-button");if(ah){aj.buttonpanel.addClass(ah)}this.addCancel("Close",g(function(){if(G===".create-page"){K.send("ui",{source:"createPageModal",actionSubject:"button",action:"clicked",actionSubjectId:"close"})}return D(true)}))}function l(ah,ag,ai,af){this.addBackButton(ah,ai);this.addButtonPanel(ah,g(ag),af);return ah.buttonpanel}function w(af,ag){af.addButton("Back",g(function(ah){ag&&ag();if(ah.curpage==1){ah.fillWebItemsInDialog()}ah.prevPage();if(ah.curpage==0){x()}af.remove();ah.page.pop();if(U()&&!c(".template.selected").length){E=false;c(".template:visible:first").click();E=true}}),"button-panel-back")}function k(){var ag=this.getPage(this.curpage);var af=ag.buttonpanel.find(".button-panel-back");af.remove()}function T(ah,ag){var af=this,ag=_.isUndefined(ag)?true:ag;af.loadedWebitems=af.loadedWebitems||{};var ai=this.loadedWebitems[ah];if(ai){return AJS.$.Deferred().resolve([ai])}return c.ajax({url:Confluence.getContextPath()+y,dataType:"json",data:{spaceKey:ah},async:ag}).done(function(aj){af.loadedWebitems[ah]=aj})}function I(){var af=this;return AJS.$.getJSON(Confluence.getContextPath()+"/rest/create-dialog/1.0/spaces",{promotedSpaceKey:AJS.params.spaceKey,promotedSpacesLimit:10,otherSpacesLimit:1000}).done(function(ag){af.loadedSpaces=ag;AJS.trigger("create-dialog.data-ready")})}function X(){require("confluence/legacy-message-queue").push({type:"ATLASSIAN_CONFLUENCE_EXPERIENCE_ABORT",payload:{name:"create-page",reason:"dialog manually closed",}})}var H={openDialog:p,closeDialog:D,requestWebItems:T,requestSpaces:I,loadedWebitems:{},loadedSpaces:{},fillWebItemsInDialog:o,filterWebItems:function(af){return af},getSpaceKey:function(){return null}};return H}}(AJS.$));Confluence.Dialogs.Events={};Confluence.Dialogs.Events.ITEM_SELECTED="create-dialog.item-selected";
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:resources', location = 'com/atlassian/confluence/plugins/createcontent/js/loader.js' */
Confluence.Blueprint=Confluence.Blueprint||{};var resourcesLoaded=false;var noSpaceErrors={noAccess:"Request permission from your Confluence administrator.",createNew:"Pages are stored in spaces, which help you organize related work and keep it together.\u003cbr /\u003e\u003cbr /\u003eCreate a space first, so your pages have a place to live.",titleNoAccess:"Can\'t create new pages in this space",titleWithAccess:"Start by creating a space"};function createNewDialogBase(){Confluence.Blueprint.Dialog=Confluence.Dialogs.CreateDialogBase({dialogId:"create-dialog",webItemsPath:"/rest/create-dialog/1.0/blueprints/web-items",helpLinkTemplate:Confluence.Templates.Blueprints.helpLink,headingText:"Create"})}Confluence.Blueprint.loadDialog=function(c){var b=AJS.$.Deferred();var a;if(!resourcesLoaded||c.forceReload){if(c.forceReload){createNewDialogBase()}a=Confluence.Blueprint.Dialog.openDialog(c);var e=WRM.require("wrc!create-content");var d=AJS.$.Deferred();Confluence.Blueprint.Dialog.requestSpaces().done(function(){var g=Confluence.Blueprint.Dialog.loadedSpaces,f=g.promotedSpaces.spaces[0]||g.otherSpaces.spaces[0];if(f){Confluence.Blueprint.Dialog.requestWebItems(f.id).done(function(){d.resolve()})}else{$.ajax({url:AJS.contextPath()+"/rest/graph",type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify({operationName:"user",query:"query user {  user (current:true) {    operations { operation }  }}",variables:{location:"system.user"}}),success:function(k){var j=false;if(k&&k.data&&k.data.user&&Array.isArray(k.data.user.operations)){j=!!k.data.user.operations.find(function(l){return l.operation==="create_space"})}var i=$(".dialog-panel-body.loading .wait-container");var h=i.closest(".loading");i.replaceWith($("<div/>").addClass("no-spaces-found").append($("<div />").addClass("icon-wrapper").html('<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 18.38 18.38">  <title>group</title>  <rect x="2.9" y="2.9" width="14" height="14" rx="1.71" ry="1.71" transform="translate(-4.81 9.19) rotate(-45)" style="fill:#de350b"/>  <path d="M10,15a1,1,0,1,1,0-2h0a1,1,0,1,1,0,2Zm1-4a1,1,0,0,1-2,0V6a1,1,0,0,1,2,0Z" transform="translate(-0.71 -0.71)" style="fill:#fff"/></svg>')).append($("<div/>").html(noSpaceErrors[j?"createNew":"noAccess"])));h.removeClass("loading");$(".create-dialog-create-button").hide();$(".dialog-title").html(noSpaceErrors[j?"titleWithAccess":"titleNoAccess"])}})}});AJS.$.when(e,d.promise()).done(function(){AJS.trigger("blueprint.wizard-register.load");if(AJS.DarkFeatures.isEnabled("create-page-dialog.allow-parent-page")){Confluence.Dialogs.LocationPanel(Confluence.Blueprint.Dialog,{parentPageId:c.parentPageId,parentPageTitle:c.parentPageTitle,parentPageType:c.parentPageType,parentPageSpaceKey:c.parentPageSpaceKey,})}else{Confluence.Dialogs.LocationPanel(Confluence.Blueprint.Dialog)}c=AJS.$.extend(c,{createDialog:a,dialogBase:Confluence.Blueprint.Dialog});resourcesLoaded=true;b.resolve(Confluence.Blueprint.Dialog.openDialog(c))}).fail(function(){AJS.log("Could not load resources for create dialog")})}else{b.resolve(Confluence.Blueprint.Dialog.openDialog(c))}return b.promise()};createNewDialogBase();AJS.toInit(function(d){var c=false;AJS.bind("blueprint.wizard-register.load",function(){if(!c){AJS.trigger("blueprint.wizard-register.ready");c=true}});var b=d("#create-page-button:visible");if(!b.length){return}d(document).on("click",".create-child-page-link",function(){Confluence.Blueprint.loadDialog({location:"child-page"});return false});if(AJS.DarkFeatures.isEnabled("adg3.create-experience")){}else{var a=d("#quick-create-page-button");if(a.is(":visible")){AJS.whenIType("c").followLink("#quick-create-page-button")}else{AJS.whenIType("c").click("#create-page-button")}}});AJS.bind("shortcuts-loaded.keyboardshortcuts",function(b,a){AJS.$.each(a.shortcuts,function(d,c){if(c.param=="#createPageLink"){a.shortcuts.splice(d,1);return false}})});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:resources', location = 'com/atlassian/confluence/plugins/createcontent/js/create-dialog-launcher.js' */
(function(){function a(d,c,e){Confluence.Blueprint.Dialog.requestWebItems(d,c).done(function(f){var g=Confluence.Blueprint.Dialog.loadedWebitems[d];if(_.isEmpty(g)){AJS.log("create-from-template-macro: No Create dialog web items found for spaceKey >"+d+"<");return}e(f,g)}).fail(function(){AJS.log("create-from-template-macro: requestWebItems call for spaceKey >"+d+"< failed")})}function b(){var c={};AJS.$("#create-dialog-init-params div").each(function(){c[$(this).data("key")]=$(this).data("value")});return c}Confluence.Blueprint=$.extend(Confluence.Blueprint,{loadDialogAndOpenTemplate:function(o){var n=AJS.$.Deferred();if(!_.isObject(o)){n.reject("Confluence.Blueprint.loadDialogAndOpenTemplate called with no options");return n.promise()}var j=o.spaceKey,i=o.contentBlueprintId,e=o.templateId,k=o.title,d=o.initContext?o.initContext:b(),m=o.initContext&&o.initContext.parentPageId||"",c=o.contentId,l=o.onContentUpdated,h=o.onError,f=o.beforeUpdateRequest,g=o.templateOriginSpaceKey;if(j){a(g||j,true,function(q,r){var p=_.find(r,function(s){if(i){return s.contentBlueprintId==i}return s.templateId==e});if(!p){AJS.log("create-from-template-macro: No Create dialog web item found for contentBlueprintId >"+i+"< and templateId >"+e+"<");n.reject("create-from-template-macro: No Create dialog web item found for contentBlueprintId >"+i+"< and templateId >"+e+"<");AJS.flag({type:"error",body:"<p> "+"The template selected is not available anymore."+" </p>"});return}Confluence.Blueprint.loadDialog({showDialog:true,updateHeight:false,showStepOne:true,initContext:d}).done(function(t){var u=p.itemModuleCompleteKey;p=$.extend({},p);p.title=k;p.contentId=c;p.spaceKey=""+j;p.parentPageId=""+m;p.onContentUpdated=l;p.onError=h;p.beforeUpdateRequest=f;AJS.trigger(Confluence.Dialogs.Events.ITEM_SELECTED,{config:p});Confluence.Blueprint.fireWizard(q,p,t);t.removeBackButton();var s=p.howToUseTemplate&&!p.skipHowToUse;if(s||Confluence.Blueprint.hasWizard(u,p)){t.show()}n.resolve()})})}else{Confluence.Blueprint.loadDialog({initContext:d}).done(function(){n.resolve()})}return n.promise()}});AJS.getWindowQueryParams=function(){var h={};if(window.location.search.length>1){var c=window.location.search.substr(1).split("&");for(var e=0;e<c.length;e++){var g=c[e].split("=");var d=unescape(g[0]);var f=g.length>1?unescape(g[1]):"";h[d]=f}}return h};AJS.toInit(function(){var e=b();if(e.createSpaceDialog){Confluence.SpaceBlueprint.loaded.then(function(){Confluence.SpaceBlueprint.Dialog.launch()});return}var f=AJS.getWindowQueryParams();var d=f.createDialogSpaceKey;if(!f.createDialog||!d){return}var c=f.createDialogBlueprintKey;if(d&&c){a(d,false,function(h,i){var g=_.find(i,function(j){return j.blueprintModuleCompleteKey==c});if(g){f.createDialogBlueprintId=g.contentBlueprintId}else{AJS.log("No blueprint found with key: "+c)}});delete f.createDialogBlueprintKey}if(d&&!f.createDialogBlueprintId&&!f.createDialogTemplateId){AJS.log("Confluence.Blueprint.launchDialog triggered with incorrect options - please check the URL query: "+window.location.search);return}Confluence.Blueprint.loadDialogAndOpenTemplate({spaceKey:d,contentBlueprintId:f.createDialogBlueprintId,templateId:f.createDialogTemplateId,initContext:e})})})();
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:resources', location = 'com/atlassian/confluence/plugins/createcontent/js/space-blueprint.js' */
define("confluence-create-content/space-blueprint",[],function(){return{loaded:AJS.$.Deferred()}});require("confluence/module-exporter").exportModuleAsGlobal("confluence-create-content/space-blueprint","Confluence.SpaceBlueprint");AJS.deprecate.prop(window.Confluence.SpaceBlueprint,"Dialog",{sinceVersion:"6.0.6",extraInfo:"Use require('confluence-create-content/space-blueprint')"});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:resources', location = 'com/atlassian/confluence/plugins/createcontent/js/space-dialog.js' */
AJS.toInit(function(c){Confluence.SpaceBlueprint.Dialog=c.extend(Confluence.Dialogs.CreateDialogBase({dialogId:"create-dialog",webItemsPath:"/rest/create-dialog/1.0/space-blueprint/dialog/web-items",helpLinkTemplate:Confluence.Templates.Blueprints.spaceHelpLink,headingText:"Create space"}),{getParentPageId:function(){return undefined},getSpaceKey:function(){return undefined},launch:function(g,e){var f=g?{showDialog:false,updateHeight:false,showStepOne:true,initContext:{}}:{};var d=Confluence.SpaceBlueprint.Dialog.openDialog(f,c(e));createSpacePromise=WRM.require("wrc!create-space");webItemsPromise=Confluence.SpaceBlueprint.Dialog.requestWebItems();AJS.$.when(createSpacePromise,webItemsPromise).done(function(k,j){AJS.trigger("blueprint.wizard-register.load");if(!g&&Confluence.SpaceBlueprint.WelcomeDialog.isShowWelcomeDialog()){Confluence.SpaceBlueprint.WelcomeDialog.showWelcomeDialog();d.remove();return}Confluence.SpaceBlueprint.Dialog.fillWebItemsInDialog();var l=Confluence.SpaceBlueprint.Dialog.loadedWebitems[undefined];if(_.isEmpty(l)){AJS.log("Could not load space dialog - web items not found");return}if(!g){return}var i=_.find(l,function(m){return m.itemModuleCompleteKey==g});if(!i){AJS.log("Error finding space blueprint with id"+g);return}Confluence.Blueprint.fireWizard(j[0],i,d);d.removeBackButton();var h=i.howToUseTemplate&&!i.skipHowToUse;if(h||Confluence.Blueprint.hasWizard(g,i)){d.show()}}).fail(function(){AJS.log("Could not load resources for space dialog")})}});var a=c('#create-space-button, a[href="'+Confluence.getContextPath()+'/spaces/createspace-start.action"]'),b=c("#create-personal-space-link");if(b.length){b.unbind("click");b.click(function(){Confluence.SpaceBlueprint.Dialog.launch("com.atlassian.confluence.plugins.confluence-create-content-plugin:create-personal-space-item");return false})}if(!a.length){return}c('a[href="'+Confluence.getContextPath()+'/spaces/createspace-start.action"]').unbind("click");a.click(function(d){Confluence.SpaceBlueprint.Dialog.launch();return false});Confluence.SpaceBlueprint.loaded.resolve()});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:resources', location = 'com/atlassian/confluence/plugins/createcontent/js/blueprint-object.js' */
(function(x,b){var q={};var p;var A;var I={};var F={};function s(P,O,N){if(P==="space"){return"space-blueprint/create-space?favorite=true"}if(y("blueprint",N.replace(":","_"))){return"content/blueprint/"+N+"/instance"}if(P==="view"){return"content-blueprint/create-content"}return"content-blueprint/create-draft"}function M(N){return N==="com.atlassian.confluence.plugins.confluence-create-content-plugin:create-blank-page"}function d(N){return N==="com.atlassian.confluence.plugins.confluence-create-content-plugin:create-blog-post"}function H(R,S,Q){if(!R||R<0){return false}if(Q&&R===Q.parentPageId){return true}var O=S===AJS.Meta.get("space-key");var P=AJS.Meta.get("content-type")==="page";var N=x("#page-restricted-container").length;return(O&&P&&!N)}function j(P,N,S,R,O){var Q={type:P,status:N,space:{key:S},metadata:{properties:{editor:{value:"v2"}}}};if(H(R,S,O)){Q.ancestors=[{id:R}]}return Q}function n(P,N,S,R,O){var Q={title:O.title||"",type:P,status:N,space:{key:S}};if(k(O.contentId)){Q.id=O.contentId;if(N==="draft"){Q.version={number:1}}}if(H(R,S,O)){Q.ancestors=[{id:R}]}return Q}function G(N){return AJS.DarkFeatures.isEnabled(N)}function k(N){return !!N}function C(){return G("fabric.editor.all-pages")}function m(){return C()||G("fabric.editor.blank.page")}function y(N,O){return m()||(G("fabric.editor."+N+"."+O))}function w(){b("confluence/legacy-message-queue").push({type:"ATLASSIAN_CONFLUENCE_EXPERIENCE_SUCCEED",payload:{name:"create-page"}})}function f(R,T,S,Q,P){var O=Confluence.getContextPath()+"/rest/api/content";var N=j(R,"draft",T,S,P);D(O,N,P)}function c(O,P){var N=Confluence.getContextPath()+"/rest/api/content";D(N,{type:O,status:"draft",space:{key:P}})}function a(O,N,T,R,Q){var S=O.contentTemplateId||O.templateId;var P={content:n("page",N,T,R,O),contentBlueprintSpec:{context:Q,blueprintId:O.contentBlueprintId}};if(S){P.contentBlueprintSpec.contentTemplateId=S}return P}function v(P,S,R,Q){var O=Confluence.getContextPath()+"/rest/api/template/page/"+P.templateId+"/instance";var N=a(P,"draft",S,R,Q);D(O,N,P)}function g(P,N,V,O,W,X){var T=AJS.$(".create-dialog-button-spinner");var Q=AJS.$("#create-dialog .dialog-button-panel");var S=Q.find(".create-dialog-create-button");if(T.length===0){Q.prepend('<div class="create-dialog-button-spinner"></div>');T=AJS.$(".create-dialog-button-spinner").spin("small")}var R=Confluence.getContextPath()+"/rest/api/template/"+P.templateId+"?expand=body.atlas_doc_format";var U=false;x.ajax({url:R,type:"GET",dataType:"json",contentType:"application/json",data:""}).done(function(Z){var Y=Z.body&&Z.body.atlas_doc_format&&Z.body.atlas_doc_format.value;if(Y&&(Y.indexOf("com.atlassian.confluence.template")!==-1)){U=true}if(Z.editorVersion!=="v2"){L(P,N,V,O)}else{if(U){if(X){X.closeDialog()}b("confluence/legacy-message-queue").push({type:"ATLASSIAN_CONFLUENCE_VARIABLEINPUT_GET_TEMPLATEINFO",payload:{spaceKey:N,parentPageId:V,templateId:P.templateId,title:P.title}})}else{W(P,N,V,O)}}}).fail(function(ac,ad,aa){var Z=JSON.parse(ac.responseText).errorMessage||"";var ab="We can\'t create that blueprint right now.";var Y=b("aui/flag");Y({type:"error",title:ab,body:Z});if(S.length&&S.prop("disabled")){S.prop("disabled",false)}}).always(function(){T.spinStop();T.remove()})}function L(N,S,Q,P){var R=Confluence.getContextPath()+"/pages/createpage-entervariables.action?templateId="+encodeURIComponent(N.templateId)+"&spaceKey="+encodeURIComponent(S)+"&title="+encodeURIComponent(N.title||"")+"&newSpaceKey="+encodeURIComponent(S)+"&atl_token="+AJS.Meta.get("atl-token")||"";for(var O in P){R+="&"+encodeURIComponent(O)+"="+encodeURIComponent(P[O])}if(H(Q,S,N)){R+="&fromPageId="+encodeURIComponent(Q)}w();window.location=R}function E(O){var N=b("confluence/legacy-message-queue");var Q=String(O.id);var P={containerType:"space",containerId:Q,source:"createSpaceModal",action:"created",actionSubject:"space",attributes:{spaceTemplateKey:p.name}};N.push({type:"ATLASSIAN_CONFLUENCE_ANALYTICS_NEXT_TRACK",payload:P})}function l(O){var N=b("confluence/legacy-message-queue");var P={actionSubject:"spaceCreation",action:"failed",source:"createSpaceModal",attributes:{spaceTemplateKey:p.name,error:O}};N.push({type:"ATLASSIAN_CONFLUENCE_ANALYTICS_NEXT_OPERATIONAL",payload:P})}function D(Q,P,O){var T=AJS.$(".create-dialog-button-spinner");var S=AJS.$("#create-dialog .dialog-button-panel");var N=S.find(".create-dialog-create-button");if(T.length===0){S.prepend('<div class="create-dialog-button-spinner"></div>');T=AJS.$(".create-dialog-button-spinner").spin("small")}var R=Q.indexOf("space-blueprint")!==-1?true:false;x.ajax({url:Q,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(P)}).done(function(W){if(R){E(W)}else{w()}var U=W.createSuccessRedirectUrl||W.url;if(!U){var V=W._links.editui||W.content._links.editui||W._links.webui||W.content._links.webui;U=Confluence.getContextPath()+V}if(O&&O.spaTransitionEnabled){b("confluence/legacy-message-queue").push({type:"ATLASSIAN_CONFLUENCE_CREATE_PAGE_NAVIGATE",payload:{url:U,data:W,requestData:P}})}else{window.location=U}}).fail(function(ae,U,Z){var Y="Error creating blueprint content: ";var ab="";var ac="We can\'t create that blueprint right now.";var aa=b("aui/flag");var V=G("frontend.create.page.experience.fail.error.attributes");try{var X=JSON.parse(ae.responseText);ab=X.errorMessage||X.message||JSON.stringify(X)||X}catch(W){ab=ae.responseText}if(R){l(ab)}else{var ad={name:"create-page",error:new Error(Y+ab)};if(!ab&&V){ad.attributes={textStatus:U,err:Z,xhr:ae}}b("confluence/legacy-message-queue").push({type:"ATLASSIAN_CONFLUENCE_EXPERIENCE_FAIL",payload:ad})}aa({type:"error",title:ac});if(N.length&&N.prop("disabled")){N.prop("disabled",false)}}).always(function(){T.spinStop();T.remove()})}function u(P,R,U,W,S,N,Q){var X=AJS.$(".create-dialog-button-spinner");var T=AJS.$("#create-dialog .dialog-button-panel");var V=T.find(".create-dialog-create-button");if(X.length===0){T.prepend('<div class="create-dialog-button-spinner"></div>');X=AJS.$(".create-dialog-button-spinner").spin("small")}function O(Z){var Y=b("aui/flag");Y({type:"error",title:"We can\'t create that blueprint right now.",body:Z||""})}if(Q){Q()}x.ajax({url:P,type:"PUT",dataType:"json",contentType:"application/json",data:JSON.stringify(R)}).done(function(Y){var Z=U.popup.element;if(Z){Z.find(".button-panel-cancel-link:visible").removeClass("disabled")}U.closeDialog();if(V.length&&V.prop("disabled")){V.prop("disabled",false)}if(W){W(Y)}else{if(Y&&Y.content&&Y.content._links&&Y.content._links.editui){window.location.assign(Confluence.getContextPath()+Y.content._links.editui)}else{O()}}}).fail(function(Z){var Y=1;if(N<Y&&Z&&Z.status===409){return u(P,R,U,W,S,++N,null)}if(V.length&&V.prop("disabled")){V.prop("disabled",false)}if(S){S(Z)}else{O(Z.message)}}).always(function(){X.spinStop();X.remove()})}function h(aa,S,Y,ab){AJS.trigger("blueprint.before-create");var ac=b("confluence/confluence-storage-manager")("confluence-create-content-plugin");var T=x.parseJSON(ac.getItem("used"))||[];T.push(p.itemModuleCompleteKey);ac.setItemQuietly("used",JSON.stringify(T));var ae=_.isString(aa)?aa:"";var P=p.createResult;var W=p.blueprintModuleCompleteKey;var U=S.updateParams;delete S.updateParams;var R;var ad;var X;var Q=ab&&ab.personalSpace||P==="space";var Z=k(U&&U.contentId);if(Z&&!Q){R=Confluence.getContextPath()+"/rest/create-dialog/1.0/content/blueprint/instance";ad=i(ae,S,null);ad.contentId=U.contentId;var O=a(ad,"draft",A,S.parentPageId,ad.context);u(R,O,U.dialog,U.onContentUpdated,U.onError,0,U.beforeUpdateRequest)}else{var V=ab&&ab.getSubmissionRestPath?ab.getSubmissionRestPath():"/rest/create-dialog/1.0/"+s(P,A,W);R=Confluence.getContextPath()+V;var N=(S&&S.parentPageId)||(Y&&Y.getParentPageId())||"";if(ab&&ab.personalSpace){ad=r(S)}else{if(P==="space"){ad=B(S)}else{ad=i(ae,S,N);if(y("blueprint",W.replace(":","_"))){X=P==="view"?"current":"draft";ad=a(ad,X,A,ad.parentPageId,ad.context)}}}D(R,ad,S)}AJS.trigger("blueprint.after-create")}function r(N){return{name:N.name}}function B(O){var P={context:O,name:O.name,spaceKey:O.spaceKey,description:O.description,permissions:O.spacePermission,spaceBlueprintId:p.contentBlueprintId};var N=O.copySpacePermissionsFromSpaceKey;if(N&&N.length>0){P.copySpacePermissionsFromSpaceKey=N}return P}function i(Q,N,O){var P=N||{};return{context:P,spaceKey:A,title:P.title||Q||"",parentPageId:P.parentPageId||O,contentTemplateId:P.contentTemplateId||"",contentBlueprintId:p.contentBlueprintId,contentTemplateKey:P.contentTemplateKey||"",viewPermissionsUsers:P.viewPermissionsUsers||""}}function z(P){var N=b("confluence/confluence-storage-manager")("confluence-create-content-plugin");var O=x.parseJSON(N.getItem("used"))||[];if(x.inArray(P,O)===-1){O.push(P)}N.setItemQuietly("used",JSON.stringify(O))}Confluence.Blueprint=AJS.$.extend(Confluence.Blueprint,{register:function(N,O){q[N]=O},validateTitle:function(O,R,S,N){var Q=x.trim(O.val()),P;if(!Q){P=S||"Title is required."}else{if(!Confluence.Blueprint.canCreatePage(R,Q)){P=N||"A page with this name already exists."}}if(P){O.focus().siblings(".error").html(P);return false}return true},canCreatePage:function(P,O){var N=false;x.ajax({url:Confluence.getContextPath()+"/rest/create-dialog/1.0/blueprints/can-create-page",dataType:"json",data:{spaceKey:P,pageTitle:O},async:false}).done(function(Q){N=Q}).fail(function(Q){AJS.log("Failed to call 'can-create-page' - "+Q)});return N},hasWizard:function J(O,N){return(F[O]||(N&&N.wizard))&&!I[O]},setWizard:function K(P,O){var N=x({});O(N);F[P]=N},getWizard:function(N){return F[N]||x({})},setDirectCallback:function(O,N){I[O]=N},getDirectCallback:function(N){return I[N]},fireWizard:function(Y,T,ad){var S=ad.initContext||{};A=T.spaceKey;p=T;var P=T.contentId;var Q=T.itemModuleCompleteKey;var ac=T&&T.parentPageId||ad.getParentPageId();z(Q);if(Q){if(T.directLink){var R={templateId:T.templateId,spaceKey:A,title:T.title||"",newSpaceKey:A,fromPageId:(ac&&A===AJS.Meta.get("space-key"))?ac:""};x.extend(R,S);var N=T.directLink;for(var U in R){N=N.replace(new RegExp("{"+e(U)+"}","g"),R[U])}w();window.location=Confluence.getContextPath()+o(N);return}if(M(Q)&&m()){return f("page",A,ac,S,T)}if(d(Q)){return f("blogpost",A,ac,S,T)}var ab;var X=this.getDirectCallback(Q);if(X){ab=function Z(){var ae={spaceKey:A,pageData:{},initContext:S};X(Y,ae,{parentPageId:T.parentPageId,parentPageTitle:T.parentPageTitle,parentPageSpace:T.parentPageSpace,parentPageType:T.parentPageType});var af=x.extend(S,{pageData:ae.pageData});w();new Confluence.DialogWizard(ad,h).doFinalAction(Y,ae,af,h)}}else{if(T.wizard){var O=T.wizard.pages[0].id;ab=function V(){var ae=Confluence.Blueprint.getWizard(Q);var af=x.extend(S,{spaceKey:A,pages:{},parentPageId:ac,title:T.title});if(k(P)){af.updateParams={contentId:P,dialog:ad,onContentUpdated:T.onContentUpdated,onError:T.onError,beforeUpdateRequest:T.beforeUpdateRequest}}Confluence.DialogWizard(ad,h).newPage(T,O,{},af,ae);x("#create-dialog").find("a, area, button, input, object, select, textarea").removeAttr("tabindex");x("#create-dialog").find(".button-panel-back").click(function(){ad.page[ad.curpage].element.find(".dialog-title").focus()});ad.page[ad.curpage].element.find(".dialog-title").attr("tabindex","-1").focus()}}else{if(q[Q]){ab=function W(){q[Q](ad,A,h)}}else{if(T.contentBlueprintId){ab=function aa(){h(null,x.extend(S,T),ad)}}else{throw Error("No way to process item: "+Q)}}}}if(T.howToUseTemplate){Confluence.Blueprint.HowToUse.check(ad,T,ab)}else{ab()}}else{if(T.templateId){if(y("template",T.templateId)){g(T,A,ac,S,v,ad)}else{L(T,A,ac,S)}}else{throw new Error("Unknown item: "+T)}}}});function t(){var N={};if(AJS.Meta.get("page-title")){N.parentPageId=AJS.Meta.get("page-id");N.parentPageTitle=AJS.Meta.get("page-title")}else{N.parentPageId=AJS.Meta.get("parent-page-id");N.parentPageTitle=AJS.Meta.get("from-page-title")}return N}function o(P){var O=P.match(/^(.*)\?(.+)$/);if(!O){return P}var Q=O[1];var N=O[2].split("&").filter(function(R){return/^.+=.+$/.test(R)}).join("&");return Q+(N?"?":"")+N}function e(N){return N.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")}Confluence.Blueprint.Util={};Confluence.Blueprint.Util.getParentPageLocation=t})(AJS.$,require);
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:resources', location = 'com/atlassian/confluence/plugins/createcontent/js/create-dialog-blueprint-selector.js' */
(function(b){var a=[];Confluence.Blueprint.Selector={registerSelector:function(c){if(c&&typeof(c)==="function"){a.push(c)}},getSelectors:function(){return a}}})(AJS.$);
}catch(e){WRMCB(e)};