"use strict";(self._cf=self._cf||[]).push([[28189],{528189:(e,t,s)=>{s.d(t,{Z:()=>G});var n=s(122551),r=s(991332),i=s(953307),a=s(29298),o=s(26011),c=s.n(o),d=s(781095),u=s(644960),p=s(429185),l=s(603494),h=s(978671),f=s(282315),m=s(78651);const I=JSON.parse('{"u2":"@atlaskit/smart-user-picker","i8":"6.0.6"}'),b=I.u2,y=I.i8,g=(0,m.Z)("fabric-elements"),U=(e,t)=>{const{fieldId:s,objectId:n,containerId:r,childObjectId:i,prefetch:a,maxOptions:o,includeTeams:c,productKey:d,principalId:u,siteId:p,orgId:l,filterOptions:h}=e,{sessionId:f,query:m}=t,I=o||100;return{context:s,childObjectId:i,containerId:r,hasFilterOptions:Boolean(h),includeTeams:c,maxNumberOfResults:I,objectId:n,prefetch:a,principalId:u,productKey:d,queryLength:(m||"").length,siteId:p,orgId:l,sessionId:f}},Z=(e,t,s={})=>(0,r.Z)({source:"smart-user-picker"},((e,t,s,n={})=>({eventType:e,action:t,actionSubject:s,attributes:(0,r.Z)({packageName:b,packageVersion:y},n)}))("operational",e,t,s)),E=(e,t,s={})=>Z("loaded","preparedUsers",(0,r.Z)((0,r.Z)({},U(e,t)),s)),w=(e,t,s={})=>Z("mounted","prefetch",(0,r.Z)((0,r.Z)({},U(e,t)),s)),v=(e,t,s={})=>Z("filtered","users",(0,r.Z)((0,r.Z)({},U(e,t)),s)),S=(e,t,s={})=>Z("requested","users",(0,r.Z)((0,r.Z)({},U(e,t)),s)),O=(e,t,s={})=>Z("successful","usersRequest",(0,r.Z)((0,r.Z)({},U(e,t)),s)),x=(e,t,s={})=>Z("failed","usersRequest",(0,r.Z)((0,r.Z)({},U(e,t)),s));var T=s(609115);const j=async e=>{switch(e){case"cs":return s.e(35848).then(s.bind(s,85097)).then((e=>e.default));case"da":return s.e(66229).then(s.bind(s,195386)).then((e=>e.default));case"de":return s.e(89880).then(s.bind(s,435774)).then((e=>e.default));case"en":return s.e(15729).then(s.bind(s,702280)).then((e=>e.default));case"en_GB":return s.e(20688).then(s.bind(s,839710)).then((e=>e.default));case"es":return s.e(25038).then(s.bind(s,487418)).then((e=>e.default));case"et":return s.e(85990).then(s.bind(s,90676)).then((e=>e.default));case"fi":return s.e(37634).then(s.bind(s,436480)).then((e=>e.default));case"fr":return s.e(58522).then(s.bind(s,287959)).then((e=>e.default));case"hu":return s.e(87808).then(s.bind(s,976773)).then((e=>e.default));case"is":return s.e(67687).then(s.bind(s,322948)).then((e=>e.default));case"it":return s.e(32069).then(s.bind(s,653233)).then((e=>e.default));case"ja":return s.e(26264).then(s.bind(s,926631)).then((e=>e.default));case"ko":return s.e(92655).then(s.bind(s,651919)).then((e=>e.default));case"nb":return s.e(11319).then(s.bind(s,633529)).then((e=>e.default));case"nl":return s.e(78750).then(s.bind(s,889783)).then((e=>e.default));case"pl":return s.e(31884).then(s.bind(s,963958)).then((e=>e.default));case"pt_BR":case"pt-BR":return s.e(25613).then(s.bind(s,823115)).then((e=>e.default));case"pt_PT":case"pt-PT":return s.e(30593).then(s.bind(s,734126)).then((e=>e.default));case"ro":return s.e(47920).then(s.bind(s,577740)).then((e=>e.default));case"ru":return s.e(20018).then(s.bind(s,490181)).then((e=>e.default));case"sk":return s.e(23574).then(s.bind(s,594112)).then((e=>e.default));case"sv":return s.e(69186).then(s.bind(s,681134)).then((e=>e.default));case"th":return s.e(98562).then(s.bind(s,129331)).then((e=>e.default));case"tr":return s.e(73266).then(s.bind(s,501407)).then((e=>e.default));case"uk":return s.e(22589).then(s.bind(s,999978)).then((e=>e.default));case"vi":return s.e(82750).then(s.bind(s,631563)).then((e=>e.default));case"zh_TW":return s.e(4012).then(s.bind(s,785212)).then((e=>e.default));case"zh":return s.e(47660).then(s.bind(s,527305)).then((e=>e.default));default:{const t=e.split(/[_-]/);return 2===t.length?j(t[0]):s.e(15729).then(s.bind(s,702280)).then((e=>e.default))}}},q={},P=(0,l.ZP)((e=>{const{intl:t,children:s}=e,i=(e=>{const[t,s]=n.useState(q);return n.useEffect((()=>{let t=!1;return s(q),j(e).then((e=>{t||s(e)})).catch((e=>{console.error(e)})),()=>{t=!0}}),[e]),t})(t.locale),a=(0,n.useMemo)((()=>(0,r.Z)((0,r.Z)({},t.messages),i)),[t.messages,i]);return n.createElement(T.Z,{locale:t.locale,messages:a},s)}));var A=s(870643),C=s(573231),R=s(849278),F=s(253851);const k="smart-user-picker",L=new R.I("smart-user-picker-rendered",{platform:{component:k},type:F.Z.Load,performanceType:F.R.PageSegmentLoad}),$=new R.I("smart-user-picker-options-shown",{platform:{component:k},type:F.Z.Operation,performanceType:F.R.InlineResult});class N extends n.Component{componentDidCatch(){L.getInstance(this.props.id).failure()}render(){return this.props.children}}N.displayName="UfoErrorBoundary";const B=e=>({metadata:{contextType:e}}),D=e=>(e||[]).map((({id:e,type:t})=>({id:e,type:t})));class K extends n.Component{constructor(e){var t;super(e),(0,a.Z)(this,"state",{users:[],loading:!1,closed:!0,query:"",defaultValue:[],bootstrapOptions:[]}),(0,a.Z)(this,"abortOptionsShownUfoExperience",(()=>{this.optionsShownUfoExperienceInstance.state.id===h.h.STARTED.id&&this.optionsShownUfoExperienceInstance.abort()})),(0,a.Z)(this,"startOptionsShownUfoExperience",(()=>{this.abortOptionsShownUfoExperience(),this.optionsShownUfoExperienceInstance.start()})),(0,a.Z)(this,"fireEvent",((e,...t)=>{const{createAnalyticsEvent:s}=this.props;s&&g(e(this.props,this.state,...t))(s)})),(0,a.Z)(this,"filterOptions",((e,t,s)=>s?s(e,t):e)),(0,a.Z)(this,"memoizedFilterOptions",(0,p.Z)(this.filterOptions)),(0,a.Z)(this,"getUsers",c()((async()=>{const{query:e,sessionId:t,closed:s}=this.state,{baseUrl:n,childObjectId:r,containerId:i,fieldId:a,includeGroups:o,includeTeams:c,includeUsers:d,intl:u,maxOptions:p,objectId:l,onEmpty:h,onError:f,orgId:m,principalId:I,productAttributes:b,productKey:y,searchQueryFilter:g,siteId:U}=this.props,Z=p||100,E=window.performance.now(),w={baseUrl:n,context:{containerId:i,contextType:a,objectId:l,principalId:I,productKey:y,siteId:U,organizationId:m,childObjectId:r,sessionId:t,productAttributes:b},includeUsers:d,includeGroups:o,includeTeams:c,maxNumberOfResults:Z,query:e,searchQueryFilter:g};try{var v;this.fireEvent(S);const t=await(0,A.Z)(w,u),s=window.performance.now()-E,n=0===t.length&&h?null!==(v=await h(e))&&void 0!==v?v:[]:t;this.setState((r=>{const i=r.query===e,a=i?n:r.users,o=!i;return this.fireEvent(O,{users:D(t),elapsedTimeMilli:s,displayedUsers:D(n),productAttributes:b,applicable:i}),{users:a,loading:o}}))}catch(T){s||f||this.optionsShownUfoExperienceInstance.failure(B(this.props.fieldId)),this.setState({users:[]});let e=!1,t=[];try{t=f&&await f(T,w)||[]}catch(j){e=!0}e&&this.optionsShownUfoExperienceInstance.failure(B(this.props.fieldId)),this.setState({users:t,loading:!1});const n=window.performance.now()-E;this.fireEvent(x,{elapsedTimeMilli:n,productAttributes:b})}}),null!==(t=this.props.debounceTime)&&void 0!==t?t:0)),(0,a.Z)(this,"onInputChange",((e,t)=>{const s=e||"",{closed:n}=this.state;s!==this.state.query&&(n||(this.startOptionsShownUfoExperience(),this.setState({loading:!0,query:s,sessionId:t}),this.props.onInputChange&&this.props.onInputChange(s,t)))})),(0,a.Z)(this,"filterUsers",(()=>{const{loading:e,users:t,query:s}=this.state,n=this.memoizedFilterOptions(t,s,this.props.filterOptions);if(this.props.bootstrapOptions&&0!==this.props.bootstrapOptions.length&&""===s){const e=this.memoizedFilterOptions(this.props.bootstrapOptions,s,this.props.filterOptions);return this.fireEvent(v,{filtered:D(e),all:D(this.props.bootstrapOptions)}),e}if(!e)return n;const r=n.filter((e=>{return t=e.name,n=s,null!=t&&(null===n||""===n||void 0===n||t.toLowerCase().includes(n.toLowerCase()));var t,n}));return this.fireEvent(v,{filtered:D(r),all:D(t)}),n})),(0,a.Z)(this,"onFocus",(e=>{const t={query:"",closed:!1};this.startOptionsShownUfoExperience(),0===this.state.users.length?(t.sessionId=e,t.loading=!0):this.fireEvent(E,{users:D(this.state.users),preparedSessionId:this.state.sessionId,sessionId:e}),this.setState((e=>(0,r.Z)((0,r.Z)({},e),t))),this.props.onFocus&&this.props.onFocus(e)})),(0,a.Z)(this,"onBlur",(e=>{this.getUsers.cancel(),this.abortOptionsShownUfoExperience();const t=0===this.state.query.length?this.state.users:[];this.setState({loading:!1,closed:!0,users:t}),this.props.onBlur&&this.props.onBlur(e)})),this.optionsShownUfoExperienceInstance=$.getInstance(e.inputId||e.fieldId)}async componentDidMount(){try{const e=await(0,C.Z)(this.props.baseUrl,this.props.defaultValue,this.props.productKey);this.setState({defaultValue:e})}catch(t){const e=await(this.props.onValueError&&this.props.onValueError(t,this.props.defaultValue)||Promise.resolve([]));this.setState({defaultValue:e})}const{prefetch:e}=this.props;if(e){const e=(0,d.v4)();this.fireEvent(w,{sessionId:e}),this.setState({sessionId:e})}}componentDidUpdate(e,t){var s,n;s=e,n=this.props,(s.siteId!==n.siteId||s.orgId!==n.orgId||s.productKey!==n.productKey||s.principalId!==n.principalId||s.containerId!==n.containerId||s.objectId!==n.objectId||s.childObjectId!==n.childObjectId||this.props.fieldId!==e.fieldId)&&this.setState({users:[]}),this.state.sessionId===t.sessionId&&this.state.query===t.query||""===this.state.query&&this.props.bootstrapOptions?this.state.closed||this.state.loading||[h.h.FAILED.id,h.h.SUCCEEDED.id].includes(this.optionsShownUfoExperienceInstance.state.id)||this.optionsShownUfoExperienceInstance.success(B(this.props.fieldId)):this.getUsers()}render(){return n.createElement(P,null,n.createElement(f.f,(0,i.Z)({},this.props,{onInputChange:this.onInputChange,onBlur:this.onBlur,onFocus:this.onFocus,defaultValue:this.state.defaultValue,isLoading:this.props.isLoading||this.state.loading&&!this.state.closed&&(!this.props.bootstrapOptions||""!==this.state.query),options:this.filterUsers()})))}}K.displayName="SmartUserPickerWithoutAnalytics",(0,a.Z)(K,"defaultProps",{baseUrl:"",includeUsers:!0,includeGroups:!1,includeTeams:!1,prefetch:!1,principalId:"Context",debounceTime:150});const V=(0,u.Z)()((0,l.ZP)(K)),G=e=>{const t=e.inputId||e.fieldId;return((e,t)=>{const s=e.getInstance(t);(0,n.useState)((()=>{s.start()})),(0,n.useEffect)((()=>(s.state!==h.h.FAILED&&s.success(),()=>{[h.h.STARTED,h.h.IN_PROGRESS].includes(s.state)&&s.abort()})),[])})(L,t),n.createElement(N,{id:t},n.createElement(P,null,n.createElement(V,e)))}},573231:(e,t,s)=>{s.d(t,{Z:()=>g});var n=s(497293),r=s(749648),i=s(991332);const a="Unknown",o={id:a,name:a,type:"user"},c={id:a,name:a,type:"team"};function d(e,t){const s=(()=>{const e=new Headers;return e.append("Content-Type","application/json"),e})();return fetch(new Request(`${e}`,{method:"POST",credentials:"include",mode:"cors",headers:s,body:JSON.stringify(t)})).then((e=>e.ok?e:Promise.reject({code:e.status,reason:e.statusText}))).then((e=>e.json())).then((e=>{var t;return e.errors?Promise.reject({reason:(null===(t=e.errors[0])||void 0===t?void 0:t.category)||"default"}):e.data}))}const u=(e,t)=>{const s=r.v.getGraphQLUrl(e);return new Promise((e=>{(async(e,t)=>{const s=(e=>({query:"query usersQuery($accountIds: [ID!]!) {\n    users(accountIds: $accountIds) {\n      name\n      accountId\n      picture\n    }\n  }",variables:{accountIds:e}}))(t);return await d(e,s)})(s,t).then((t=>{e(t.users.map((({accountId:e,name:t,picture:s})=>({avatarUrl:s,id:e,name:t,type:"user"}))))})).catch((()=>{e(t.map((e=>(0,i.Z)((0,i.Z)({},o),{},{id:e}))))}))}))},p=e=>{const t=`${r.v.getTeamsUrl(e.baseUrl)}/${e.id}`;return fetch(t,{method:"GET",credentials:"include",headers:{"content-type":"application/json"}}).then((e=>200===e.status?e.json():Promise.reject({message:`error calling Legion, statusCode=${e.status}, statusText=${e.statusText}`}))).then((t=>{return s=t,{id:e.id,name:s.displayName,type:"team",avatarUrl:s.smallAvatarImageUrl};var s})).catch((()=>(0,i.Z)((0,i.Z)({},c),{},{id:e.id})))},l=e=>e.values.map(h).filter((e=>!!e)).map((e=>e)),h=e=>e?{id:e.accountId,type:n.FW,avatarUrl:e.avatarUrls?e.avatarUrls["16x16"]:"",name:e.displayName,email:e.emailAddress}:null,f=e=>e.results.map(m).filter((e=>!!e)).map((e=>e)),m=e=>e?{id:e.accountId,type:n.FW,avatarUrl:e.profilePicture?e.profilePicture.path:"",name:e.publicName,email:e.email}:null,I=e=>void 0!==e.name,b=async(e,t)=>{if(0===t.length)return[];const s=t.map((t=>p({baseUrl:e,id:t.id})));return await Promise.all(s)},y=async(e,t,s)=>{if(0===s.length)return[];const n=s.map((e=>e.id));return"jira"===t||"confluence"===t?await(e=>{const t=`${r.v.getUsersServiceUrl(e.productKey,e.baseUrl)}`;let s=new URLSearchParams;return e.accountIds.map((e=>s.append("accountId",e))),s.append("maxResults","2000"),fetch(`${t}?${s}`,{method:"GET",credentials:"include",headers:{"content-type":"application/json"}}).then((e=>200===e.status?e.json():Promise.reject({message:`error calling users service, statusCode=${e.status}, statusText=${e.statusText}`}))).then("jira"===e.productKey?l:f)})({baseUrl:e,productKey:t,accountIds:n}):await u(e,n)};const g=async function(e,t,s){if(!t||Array.isArray(t)&&0===t.length)return[];const n=Array.isArray(t)?t:[t];if(!n.some((e=>!I(e))))return t;const[r,i]=await Promise.all([y(e,s,n.filter((e=>!I(e)&&"user"===e.type))),b(e,n.filter((e=>!I(e)&&"team"===e.type)))]);return((e,t)=>{const s=new Map(e.map((e=>[e&&e.id,e])));return t.map((e=>s.get(e.id)||{id:e.id,type:e.type,name:a}))})(n.filter((e=>I(e))).map((e=>e)).concat(r).concat(i),n)}}}]);
//# sourceMappingURL=28189.XUJbTgYQ6B.js.map