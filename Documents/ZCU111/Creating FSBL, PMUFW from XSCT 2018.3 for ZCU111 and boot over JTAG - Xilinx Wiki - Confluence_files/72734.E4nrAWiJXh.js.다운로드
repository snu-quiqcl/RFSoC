(self._cf=self._cf||[]).push([[72734],{608259:function(e,t){!function(e){const t=Symbol("newer"),i=Symbol("older");class n{constructor(e,t){"number"!=typeof e&&(t=e,e=0),this.size=0,this.limit=e,this.oldest=this.newest=void 0,this._keymap=new Map,t&&(this.assign(t),e<1&&(this.limit=this.size))}_markEntryAsUsed(e){e!==this.newest&&(e[t]&&(e===this.oldest&&(this.oldest=e[t]),e[t][i]=e[i]),e[i]&&(e[i][t]=e[t]),e[t]=void 0,e[i]=this.newest,this.newest&&(this.newest[t]=e),this.newest=e)}assign(e){let n,s=this.limit||Number.MAX_VALUE;this._keymap.clear();let r=e[Symbol.iterator]();for(let o=r.next();!o.done;o=r.next()){let e=new a(o.value[0],o.value[1]);if(this._keymap.set(e.key,e),n?(n[t]=e,e[i]=n):this.oldest=e,n=e,0==s--)throw new Error("overflow")}this.newest=n,this.size=this._keymap.size}get(e){var t=this._keymap.get(e);return t?(this._markEntryAsUsed(t),t.value):void 0}set(e,n){var s=this._keymap.get(e);return s?(s.value=n,this._markEntryAsUsed(s),this):(this._keymap.set(e,s=new a(e,n)),this.newest?(this.newest[t]=s,s[i]=this.newest):this.oldest=s,this.newest=s,++this.size,this.size>this.limit&&this.shift(),this)}shift(){var e=this.oldest;if(e)return this.oldest[t]?(this.oldest=this.oldest[t],this.oldest[i]=void 0):(this.oldest=void 0,this.newest=void 0),e[t]=e[i]=void 0,this._keymap.delete(e.key),--this.size,[e.key,e.value]}find(e){let t=this._keymap.get(e);return t?t.value:void 0}has(e){return this._keymap.has(e)}delete(e){var n=this._keymap.get(e);return n?(this._keymap.delete(n.key),n[t]&&n[i]?(n[i][t]=n[t],n[t][i]=n[i]):n[t]?(n[t][i]=void 0,this.oldest=n[t]):n[i]?(n[i][t]=void 0,this.newest=n[i]):this.oldest=this.newest=void 0,this.size--,n.value):void 0}clear(){this.oldest=this.newest=void 0,this.size=0,this._keymap.clear()}keys(){return new r(this.oldest)}values(){return new o(this.oldest)}entries(){return this}[Symbol.iterator](){return new s(this.oldest)}forEach(e,i){"object"!=typeof i&&(i=this);let n=this.oldest;for(;n;)e.call(i,n.value,n.key,this),n=n[t]}toJSON(){for(var e=new Array(this.size),i=0,n=this.oldest;n;)e[i++]={key:n.key,value:n.value},n=n[t];return e}toString(){for(var e="",i=this.oldest;i;)e+=String(i.key)+":"+i.value,(i=i[t])&&(e+=" < ");return e}}function a(e,n){this.key=e,this.value=n,this[t]=void 0,this[i]=void 0}function s(e){this.entry=e}function r(e){this.entry=e}function o(e){this.entry=e}e.LRUMap=n,s.prototype[Symbol.iterator]=function(){return this},s.prototype.next=function(){let e=this.entry;return e?(this.entry=e[t],{done:!1,value:[e.key,e.value]}):{done:!0,value:void 0}},r.prototype[Symbol.iterator]=function(){return this},r.prototype.next=function(){let e=this.entry;return e?(this.entry=e[t],{done:!1,value:e.key}):{done:!0,value:void 0}},o.prototype[Symbol.iterator]=function(){return this},o.prototype.next=function(){let e=this.entry;return e?(this.entry=e[t],{done:!1,value:e.value}):{done:!0,value:void 0}}}(t)},73377:function(e,t,i){!function(e,t){"use strict";if(!e.setImmediate){var i,n,a,s,r,o=1,d={},l=!1,c=e.document,m=Object.getPrototypeOf&&Object.getPrototypeOf(e);m=m&&m.setTimeout?m:e,"[object process]"==={}.toString.call(e.process)?i=function(e){process.nextTick((function(){u(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,i=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=i,t}}()?e.MessageChannel?((a=new MessageChannel).port1.onmessage=function(e){u(e.data)},i=function(e){a.port2.postMessage(e)}):c&&"onreadystatechange"in c.createElement("script")?(n=c.documentElement,i=function(e){var t=c.createElement("script");t.onreadystatechange=function(){u(e),t.onreadystatechange=null,n.removeChild(t),t=null},n.appendChild(t)}):i=function(e){setTimeout(u,0,e)}:(s="setImmediate$"+Math.random()+"$",r=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(s)&&u(+t.data.slice(s.length))},e.addEventListener?e.addEventListener("message",r,!1):e.attachEvent("onmessage",r),i=function(t){e.postMessage(s+t,"*")}),m.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var a={callback:e,args:t};return d[o]=a,i(o),o++},m.clearImmediate=h}function h(e){delete d[e]}function u(e){if(l)setTimeout(u,0,e);else{var t=d[e];if(t){l=!0;try{!function(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(void 0,i)}}(t)}finally{h(e),l=!1}}}}}("undefined"==typeof self?void 0===i.g?this:i.g:self)},421979:(e,t,i)=>{"use strict";i.d(t,{h:()=>a});var n=i(755181);function a(e,t){const i=[];return(0,n.f)(e,{any:e=>{t(e)&&i.push(e)}}),i}},450265:(e,t,i)=>{"use strict";i.d(t,{H:()=>r});var n=i(953307),a=i(29298),s=i(122551);const r=e=>class extends s.Component{constructor(...e){super(...e),(0,a.Z)(this,"state",{imageStatus:"loading"}),(0,a.Z)(this,"onLoad",(()=>{this.setState({imageStatus:"complete"});const{onExternalImageLoaded:e}=this.props;e&&this.img&&e({width:this.img.naturalWidth,height:this.img.naturalHeight})})),(0,a.Z)(this,"onError",(()=>{this.setState({imageStatus:"error"})}))}componentDidMount(){this.fetchImage(this.props)}UNSAFE_componentWillReceiveProps(e){e.url!==this.props.url&&(this.setState({imageStatus:"loading"}),this.fetchImage(e))}componentWillUnmount(){this.img&&(this.img.removeEventListener("load",this.onLoad),this.img.removeEventListener("error",this.onError),this.img=null)}fetchImage({url:e}){e&&(this.img||(this.img=new Image,this.img.addEventListener("load",this.onLoad),this.img.addEventListener("error",this.onError)),this.img.src=e)}render(){const{imageStatus:t}=this.state;return s.createElement(e,(0,n.Z)({},this.props,{imageStatus:t}))}}},144024:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,a=(n=i(122551))&&n.__esModule?n:{default:n},s=i(386056);const r=e=>a.default.createElement(s.Icon,Object.assign({dangerouslySetGlyph:'<svg width="24" height="24" viewBox="0 0 24 24" role="presentation"><path d="M13.31 5.343l7.359 13.17A1 1 0 0119.796 20H4.204a1 1 0 01-.873-1.488l7.36-13.169a1.5 1.5 0 012.618 0zM12 8.5a1.091 1.091 0 00-1.081 1.239l.513 3.766a.573.573 0 001.136 0l.513-3.766A1.091 1.091 0 0012 8.5zm0 8.63a1.125 1.125 0 100-2.25 1.125 1.125 0 000 2.25z" fill="currentColor" fill-rule="evenodd"/></svg>'},e));r.displayName="EditorWarningIcon";var o=r;t.default=o},773140:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,a=(n=i(122551))&&n.__esModule?n:{default:n},s=i(386056);const r=e=>a.default.createElement(s.Icon,Object.assign({dangerouslySetGlyph:'<svg width="24" height="24" viewBox="0 0 24 24" role="presentation"><g fill="currentColor" fill-rule="evenodd"><path d="M17 10.005V19H7V5h5.99v2.49a1.5 1.5 0 001.5 1.5h4.5v-.522c0-.297-.132-.578-.359-.768l-5.074-4.236c-.36-.3-.813-.464-1.282-.464H7a2 2 0 00-2 2v14a2 2 0 002 2h10a2 2 0 002-2v-8.995h-2z"/><rect x="8" y="12" width="8" height="2" rx="1"/><rect x="8" y="15" width="4" height="2" rx="1"/></g></svg>'},e));r.displayName="FileIcon";var o=r;t.default=o},410050:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var n=i(953307),a=i(122551),s=i(316864),r=i(959723),o=i.n(r),d=i(931318);const l=a.createContext({}),c=()=>{const e=(0,a.useContext)(l);return a.createElement(d.o,e)},m=o()({__loadable_id__:"Y2DkS",name:"MediaCard",loader:()=>Promise.all([i.e(61769),i.e(78248),i.e(54936),i.e(11216),i.e(65829),i.e(33465),i.e(13084),i.e(65604),i.e(50926)]).then(i.bind(i,552119)).then((e=>e.Card)),loading:()=>a.createElement(c,null)}),h=o()({__loadable_id__:"428dZ",name:"MediaCardErrorBoundary",loader:()=>Promise.all([i.e(78248),i.e(54936),i.e(11216),i.e(92669)]).then(i.bind(i,165860)).then((e=>e.default)),loading:()=>a.createElement(c,null)}),u=o()({__loadable_id__:"T9n6F",name:"MediaCardWithMediaClient",loader:()=>Promise.all([i.e(54936),i.e(11216),i.e(91306),i.e(52140),i.e(45442),i.e(1054),i.e(65829),i.e(35446)]).then(i.bind(i,849646)),loading:()=>a.createElement(c,null),render:(e,t)=>a.createElement(p,(0,n.Z)({},t,{withMediaClient:e.withMediaClient}))}),p=e=>{const{withMediaClient:t,dimensions:i,featureFlags:n,onClick:r}=e,o=(0,s.jj)(n),d=a.useMemo((()=>t(m,o)),[t,o]);return a.createElement(h,{dimensions:i,onClick:r},a.createElement(d,e))},f=e=>a.createElement(l.Provider,{value:e},a.createElement(u,e))},83710:(e,t,i)=>{"use strict";i.d(t,{P:()=>d});var n=i(29298),a=i(321534),s=i(122551),r=i(144024);const o=a.iv`
  display: flex;
  color: ${"var(--ds-icon-warning, #ff991f)"};
`;class d extends s.Component{render(){const{size:e}=this.props;return(0,a.tZ)("div",{css:o},(0,a.tZ)(r.default,{label:"Error",size:e}))}}d.displayName="ErrorIcon",(0,n.Z)(d,"defaultProps",{size:"small"})},931318:(e,t,i)=>{"use strict";i.d(t,{o:()=>l});var n=i(122551),a=i(840181),s=i(904728),r=i(685753),o=i(773140),d=i(316864);class l extends n.Component{render(){const{dimensions:e,testId:t,featureFlags:i}=this.props,l=(0,a.M)(e);return(0,d.OC)("newCardExperience",i)?n.createElement(s.P,{"data-testid":t||"media-card-loading","data-test-loading":!0,dimensions:l},n.createElement(r.Z,null)):n.createElement(s.i,{"data-testid":t||"media-card-loading","data-test-loading":!0,dimensions:l},n.createElement(o.default,{label:"loading",size:"medium"}))}}l.displayName="CardLoading"},840181:(e,t,i)=>{"use strict";i.d(t,{M:()=>n});const n=(e={width:"100%",height:"100%"})=>({height:"number"==typeof e.height?`${e.height}px`:e.height,width:"number"==typeof e.width?`${e.width}px`:e.width})},904728:(e,t,i)=>{"use strict";i.d(t,{i:()=>u,P:()=>h});var n=i(953307),a=i(321534),s=i(866738),r=i(479517),o=i(131436);const d=a.F4`
  0%{
    opacity: 1;
  }

  50%{
    opacity: 0.6;
  }

  100%{
    opacity: 1;
  }
`,l=({dimensions:e,theme:t})=>a.iv`
  ${s.be}
  background: ${(0,r.Z)({light:`var(--ds-background-neutral, ${o.IR})`,dark:`var(--ds-background-neutral, ${o.H8})`})({theme:t})};
  color: ${(0,r.Z)({light:`var(--ds-icon, ${o.uv})`,dark:`var(--ds-icon, ${o.Sk})`})({theme:t})};
  ${s.E0}
  max-height: 100%;
  max-width: 100%;
  width: ${e.width};
  height: ${e.height};
`,c=e=>a.iv`
  ${l(e)}
  > span {
    animation: ${d} 0.8s infinite;
  }
`;var m=i(529845);const h=e=>{const t=(0,m.m)();return(0,a.tZ)("div",(0,n.Z)({css:l({dimensions:e.dimensions,theme:t})},e),e.children)},u=e=>{const t=(0,m.m)();return(0,a.tZ)("div",(0,n.Z)({css:c({dimensions:e.dimensions,theme:t})},e),e.children)}},700406:(e,t,i)=>{"use strict";i.d(t,{h:()=>a});var n=i(501341);const a={on(e,t){n.nA.eventEmitter&&n.nA.eventEmitter.on(e,t)},off(e,t){n.nA.eventEmitter&&n.nA.eventEmitter.off(e,t)},emit(e,t){if(n.nA.eventEmitter)return n.nA.eventEmitter.emit(e,t)}}},316864:(e,t,i)=>{"use strict";i.d(t,{WH:()=>o,q8:()=>r,OC:()=>l,jj:()=>c});var n=i(122551);const a=["confluence","jira"],s={confluence:{newCardExperience:"confluence.frontend.media.cards.new.experience",captions:"confluence.frontend.fabric.editor.media.captions",mediaInline:"confluence.frontend.fabric.editor.media.inline",folderUploads:"confluence.frontend.media.picker.folder.uploads",observedWidth:"",timestampOnVideo:"confluence.frontend.media.timestamp.on.video",mediaUploadApiV2:"confluence.enable.media.upload.api.v2",memoryCacheLogging:"confluence-frontend-media-card-memory-cache-logging",fetchFileStateAfterUpload:"confluence-frontend-media-client-fetch-file-state-after-upload"},jira:{newCardExperience:"issue.details.media-cards-new-experience",captions:"issue.details.editor.media.captions",mediaInline:"",folderUploads:"issue.details.media-picker-folder-upload",observedWidth:"",timestampOnVideo:"issue.details.media-cards-timestamp-on-video",mediaUploadApiV2:"issue.details.enable-media-upload-api-version-2",memoryCacheLogging:"jira-frontend-media-card-memory-cache-logging",fetchFileStateAfterUpload:"jira-frontend-media-client-fetch-file-state-after-upload"}},r=e=>Object.entries(e).filter((([e,t])=>!!t)).map((([e])=>e)),o=e=>{const t=r(e),i=[];return t.forEach((e=>a.forEach((t=>i.push(s[t][e]))))),i.filter((e=>""!==e))},d={newCardExperience:!1,captions:!1,mediaInline:!1,folderUploads:!1,observedWidth:!1,timestampOnVideo:!1,mediaUploadApiV2:!0,memoryCacheLogging:!1,fetchFileStateAfterUpload:!1};function l(e,t){const i=(e=>{try{return"undefined"!=typeof window&&window.localStorage?window.localStorage.getItem(e):null}catch(t){}return null})(e);if(null!==i)try{return JSON.parse(i)}catch(n){}return t&&e in t?t[e]:d[e]}const c=e=>{const t=(0,n.useRef)();return((e,t)=>{if(!e&&!t)return!0;if(!e||!t)return!1;const i={newCardExperience:e.newCardExperience===t.newCardExperience,captions:e.captions===t.captions,mediaInline:e.mediaInline===t.mediaInline,folderUploads:e.folderUploads===t.folderUploads,observedWidth:e.observedWidth===t.observedWidth,timestampOnVideo:e.timestampOnVideo===t.timestampOnVideo,mediaUploadApiV2:e.mediaUploadApiV2===t.mediaUploadApiV2,memoryCacheLogging:e.memoryCacheLogging===t.memoryCacheLogging,fetchFileStateAfterUpload:e.fetchFileStateAfterUpload===t.fetchFileStateAfterUpload};return Object.values(i).every((e=>e))})(e,t.current)||(t.current=e),t.current}},501341:(e,t,i)=>{"use strict";i.d(t,{pl:()=>r,Wf:()=>s,nA:()=>a});var n=i(791306);const a={streams:new(i(608259).LRUMap)(1e3),stateDeferreds:new Map,eventEmitter:new n.EventEmitter2};function s(e){return!!e.clientId}const r=e=>{if(function(e){return!!e.asapIssuer}(e))return e;return{id:e.clientId,baseUrl:e.baseUrl,token:e.token}}},866738:(e,t,i)=>{"use strict";i.d(t,{LH:()=>s,dp:()=>r,be:()=>o,AG:()=>d,E0:()=>l});var n=i(321534),a=i(676424);const s=(e="100%")=>`\n    max-width: ${e}${"number"==typeof e?"px":""};\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  `,r=(e="100%")=>{const t="number"==typeof e?"px":"";return`\n    width: ${e}${t};\n    height: ${e}${t};\n  `},o="\n  display: flex;\n  align-items: center;\n  justify-content: center;\n",d=(e=0,t=0)=>`\n  position: absolute;\n  top: ${e}px;\n  left: ${t}px;\n`,l=`\n  border-radius: ${(0,a.E0)()}px;\n`;(0,a.E0)(),(0,a.E0)(),n.F4`
  0%{
    opacity: 0;
  }

  100%{
    opacity: 1;
  }
`},315555:(e,t,i)=>{"use strict";i.d(t,{PB:()=>y,ll:()=>v});var n=i(991332),a=i(29298),s=i(122551),r=i(421979),o=i(83710),d=i(904728),l=i(840181);class c extends s.Component{render(){const e=(0,l.M)(this.props.dimensions);return s.createElement(d.P,{dimensions:e},this.icon)}get icon(){const{size:e}=this.props;return s.createElement(o.P,{size:e})}}c.displayName="CardError",(0,a.Z)(c,"defaultProps",{size:"medium"});var m=i(931318),h=i(410050),u=i(101054),p=i(450265);const f=new Map;class g extends s.Component{constructor(...e){super(...e),(0,a.Z)(this,"state",{}),(0,a.Z)(this,"saveFileState",(async(e,t)=>{const{collection:i,featureFlags:n}=this.props,a=(0,u.y)(t,n),s={collectionName:i};try{const t=await a.file.getCurrentState(e,s);this.setState({fileState:t})}catch(r){}})),(0,a.Z)(this,"renderLoadingCard",(()=>{const{cardDimensions:e}=this.props;return s.createElement(m.o,{dimensions:e})})),(0,a.Z)(this,"getOnCardClickCallback",(e=>{const{eventHandlers:t}=this.props;if(t&&t.media&&t.media.onClick)return(i,n)=>{const a=i.mediaItemDetails&&"video"===i.mediaItemDetails.mediaType;!(e&&a)&&t&&t.media&&t.media.onClick&&t.media.onClick(i,n)}}))}async componentDidMount(){const{rendererContext:e,mediaProvider:t,contextIdentifierProvider:i,id:a,url:s,collection:o}=this.props;if(!t)return;i&&this.setState({contextIdentifierProvider:await i});const d=(await t).viewMediaClientConfig,l=a&&f.has(a)||s&&f.has(s);var c;e&&e.adDoc&&!l&&(c=e.adDoc,c?(0,r.h)(c,(e=>"media"===e.type)).reduce(((e,t)=>{if(t.attrs){const{type:i,url:n,id:a}=t.attrs;"file"===i&&a?e.push({mediaItemType:"file",id:a}):"external"===i&&n&&e.push({mediaItemType:"external-image",dataURI:n,name:n})}return e}),[]):[]).forEach((e=>{"file"===e.mediaItemType&&e.id===a?f.set(e.id,(0,n.Z)((0,n.Z)({},e),{},{collectionName:o})):"external-image"===e.mediaItemType&&f.set(e.dataURI,e)})),this.setState({mediaClientConfig:d}),a&&this.saveFileState(a,d)}UNSAFE_componentWillReceiveProps(e){const{mediaClientConfig:t}=this.state,{id:i}=e;t&&i&&i!==this.props.id&&this.saveFileState(i,t)}componentWillUnmount(){const{id:e,url:t}=this.props;e?f.delete(e):t&&f.delete(t)}renderExternal(e){const{mediaClientConfig:t}=this.state,{cardDimensions:i,resizeMode:n,appearance:a,url:r,imageStatus:o,disableOverlay:d,alt:l,featureFlags:c,ssr:m}=this.props;if("loading"===o||!r)return this.renderLoadingCard();const u={dataURI:r,name:r,mediaItemType:"external-image"};return s.createElement(h.Z,{mediaClientConfig:t,alt:l,identifier:u,dimensions:i,appearance:a,resizeMode:n,disableOverlay:d,shouldOpenMediaViewer:e,mediaViewerDataSource:{list:Array.from(f.values())},featureFlags:c,ssr:null==m?void 0:m.mode})}render(){const{contextIdentifierProvider:e,mediaClientConfig:t,fileState:i}=this.state,{id:n,alt:a,type:r,collection:o,occurrenceKey:d,cardDimensions:l,resizeMode:m,rendererAppearance:u,disableOverlay:p,useInlinePlayer:g,originalDimensions:y,shouldOpenMediaViewer:w,featureFlags:E,shouldEnableDownloadButton:C,ssr:b}=this.props,x="mobile"===u,k=!x&&(void 0===g||g),S=this.getOnCardClickCallback(k),I="boolean"==typeof w?w:!x&&!S;if("external"===r)return this.renderExternal(I);if("link"===r)return null;const _=b?b.config:t;if(!_||!n)return this.renderLoadingCard();if(!n||"file"!==r)return s.createElement(c,{dimensions:l});const M=e&&e.objectId,A={id:n,mediaItemType:"file",collectionName:o,occurrenceKey:d};return s.createElement("div",v({id:n,alt:a,collection:o,contextIdentifierProvider:e,originalDimensions:y,fileState:i}),s.createElement(h.Z,{identifier:A,alt:a,contextId:M,mediaClientConfig:_,dimensions:l,originalDimensions:y,onClick:S,resizeMode:m,isLazy:!x,disableOverlay:p,useInlinePlayer:k,shouldOpenMediaViewer:I,mediaViewerDataSource:{list:Array.from(f.values())},featureFlags:E,shouldEnableDownloadButton:C,ssr:null==b?void 0:b.mode}))}}g.displayName="MediaCardInternal";const v=({id:e,alt:t,collection:i,contextIdentifierProvider:n,originalDimensions:a,fileState:s})=>{const r=n&&n.objectId,o=a&&a.width,d=a&&a.height;let l="file",c=1,m="";return s&&"error"!==s.status&&(c=s.size,l=s.name,m=s.mimeType),{"data-context-id":r,"data-type":"file","data-node-type":"media","data-width":o,"data-height":d,"data-id":e,"data-collection":i,"data-file-name":l,"data-file-size":c,"data-file-mime-type":m,"data-alt":t}},y=(0,p.H)(g)}}]);
//# sourceMappingURL=72734.E4nrAWiJXh.js.map