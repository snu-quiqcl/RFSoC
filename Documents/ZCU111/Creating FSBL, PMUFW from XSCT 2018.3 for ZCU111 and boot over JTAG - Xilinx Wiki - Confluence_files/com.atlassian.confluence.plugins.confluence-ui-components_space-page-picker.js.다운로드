WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:space-page-picker', location = '/js/space-page-picker.js' */
define("confluence-ui-components/js/space-page-picker",["underscore","ajs","jquery"],function(J,s,y){var H={conf_all:"All spaces",conf_favorites:"Favourite spaces",conf_global:"Site spaces",conf_personal:"Personal spaces",conf_current:"Current space"};var i={"currentContent()":"Current page"};var A={data:null,suggestCategories:null};var r="SPACE-PAGE-TRIGGER-VALUE";var m={placeholder:"Select a space or page",multiple:true,formatInputTooShort:function(){return "Start typing to search"},formatResult:function(M,O,R){if(M.children){O.addClass("space-page-picker-result-category");return y.fn.select2.defaults.formatResult.apply(this,arguments)}else{if(M.id){O.attr("title",M.text);O.addClass("space-page-picker-result-label-with-icon");var L=y("<span/>").addClass(M.className+" item-text").html(y.fn.select2.defaults.formatResult.apply(this,arguments));var Q=(M.subText)?y("<span/>").addClass("space-name").html(M.subText):y("");var N=y("<span/>").attr(e(M.id),M.id).append(L).append(Q);var P=y("<span/>").append(N);return P}else{O.addClass(M.className);return y.fn.select2.defaults.formatResult.apply(this,arguments)}}},formatSelection:function(M,N){N.addClass("space-page-picker-selected-item");N.attr("title",M.text);var L=y("<span/>").attr(e(M.id),M.id).addClass(M.className+" item-text").html(y.fn.select2.defaults.formatSelection.apply(this,arguments));N.append(L)},escapeMarkup:function(L){return L},formatResultCssClass:function(L){return(L.children||L.id)?"":"select2-result-space-page-separator"},containerCssClass:"space-page-picker-container",dropdownCssClass:"space-page-picker-drop"};var p=function(L,N){var M=L.data("select2").opts.manualInit;if(M===true){return}C(L.val(),L,N)};function K(N,M,L){var O=J.map(N,function(P){return M[P]});return(L)?O:((O.length>0)?O[0]:null)}var q=function(L){var N;if(L.suggestCategories){var O={text:"Suggested categories",children:J.map(L.suggestCategories,function(P){return g(P)})}}if(L.suggestedContentFunctions){var M=J.map(L.suggestedContentFunctions,function(P){return x(P)})}return function(Q){if(N){Q.callback(N);return}var P=[];N={results:[]};if(a(L)){var S=y.getJSON(s.contextPath()+"/rest/recentlyviewed/1.0/recent/spaces").done(function(T){var U=(O)?[O]:[];(T.length>0)&&U.push({text:"Suggested spaces",children:J.map(T,function(V){return z(V.key,J.escape(V.name),null,true)})});(U.length>0)&&(N.results=N.results.concat(U))}).fail(function(){s.debug("Couldn't fetch recent spaces");var T=(O)?[O]:[];(T.length>0)&&(N.results=N.results.concat(T))});P.push(S)}if(n(L)){var R=y.getJSON(s.contextPath()+"/rest/recentlyviewed/1.0/recent/pages",{noTrashedContent:true}).done(function(T){if(T.length>0||M){var U=[];if(M){U=U.concat(M)}if(T.length>0){U=U.concat(J.map(T,function(V){return t(V.id,J.escape(V.title),J.escape(V.space),"content-type-page",true)}))}N.results.push({text:"Suggested pages",children:U})}}).fail(function(){s.debug("Couldn't fetch recent pages")});P.push(R)}y.when.apply(y,J.map(P,function(U){var T=y.Deferred();U.always(function(){T.resolve()});return T})).done(function(){if(N.results.length===0){N.results=[{text:"",children:[]}]}Q.callback(N)})}};var u=function(L){var M="";if(!L||L.length===2&&L.indexOf("space")>=0&&L.indexOf("page")>=0){M="type=spacedesc&type=personalspacedesc&type=page"}else{if(L.length===1&&L[0]==="space"){M="type=spacedesc&type=personalspacedesc"}else{if(L.length===1&&L[0]==="page"){M="type=page"}else{return}}}return window.Select2.query.ajax({url:s.contextPath()+"/rest/quicknav/1/search?"+M,data:function(N,O){return{query:N,maxPerCategory:25}},quietMillis:250,results:function(Q,U){var T=Q.contentNameMatches;if(T.length<=1){return{results:[]}}else{var V=[];var O=function(W){return G(W.spaceKey,W.spaceName,W.id,W.name,W.className)};for(var R=0;R<T.length-1;R++){var S=[];for(var P=0;P<T[R].length;P++){var N=O(T[R][P]);if(N){S.push(N)}}if(S.length>0){V=V.concat(S);V.push({id:"",text:"",subText:"",className:"",disabled:true})}}return{results:[{text:"Search results",children:V}]}}}})};var I=function(M){var L=u(M.contentType);var N=q(M);return function(O){if(O.term.length<2){N(O)}else{L(O)}}};function e(L){return(L.indexOf("page:")===0)?"data-item-id":"data-item-key"}function z(L,O,M,N){M=(M)?M:((L.indexOf("~")===0)?"content-type-personalspacedesc":"content-type-spacedesc");return h("space",L,O,"",M,N)}function g(L){var M=H[L];return h("space-cat",L,M,"","content-type-space-category",M)}function x(L){var M=i[L];return h("content-function",L,M,"","content-type-page",M)}function t(P,O,L,M,N){return h("page",P,O,L,M,N)}function h(R,O,Q,N,M,P){var L=f(R,O);Q=(!Q)?O:Q;M=(P)?M:(M+" content-not-found");return{id:L,text:Q,subText:N,className:M,disabled:(P?false:true)}}function k(L){return"space-cat:"+L}function j(L){return"content-function:"+L}function v(L){return"space:"+L}function w(L){return"page:"+L}function G(P,M,Q,N,O){var L;if(O==="content-type-spacedesc"||O==="content-type-personalspacedesc"){L=z(P,M,O,true)}else{if(O==="content-type-page"){L=t(Q,N,M,O,true)}}return L}function f(){var L=Array.prototype.slice.apply(arguments);return L.join(":")}function a(L){return((!L.contentType||L.contentType.length===0||L.contentType.indexOf("space")>=0)&&L.showRecentlyViewedSpaces!==false)}function n(L){return((!L.contentType||L.contentType.length===0||L.contentType.indexOf("page")>=0)&&L.showRecentlyViewedPages!==false)}function E(M,L){var N=c("SpaceCat",M,L.inputSpaceCatId,(L.inputSpaceCatName)?L.inputSpaceCatName:L.inputSpaceCatId);return B(M,N.id,N.name)}function F(M,L){var O=L.inputContentFunctionId||"legacy-macro-param-content-funcs";var N=c("ContentFunction",M,O,L.inputContentFunctionName||O);return B(M,N.id,N.name)}function l(M,L){var N=c("Space",M,L.inputSpaceId,(L.inputSpaceName)?L.inputSpaceName:L.inputSpaceId);return B(M,N.id,N.name)}function o(M,L){var N=c("Page",M,L.inputPageId,(L.inputPageName)?L.inputPageName:L.inputPageId);return B(M,N.id,N.name)}function c(P,N,Q,M){var L;if(!Q){L=N.attr("id");if(!L){return null}Q=L+P}if(!M){var O=N.attr("name")||L;M=O+P}return{id:Q,name:M}}function B(M,O,L){var N=y("#"+O);if(N.length===0){N=y(Confluence.UI.Components.templates.hiddenField({id:O,name:L}));M.after(N)}return N}function b(M,O,N){if(!M){return}var L=J.filter(O,function(P){return P.indexOf(N)===0});L=J.map(L,function(P){return P.substring(N.length,P.length)});M.val(L.join(","))}function d(S,N,O,L){O=(O)?(J.isArray(O)?O:O.split(",")):[];L=(L)?L.split(","):[];var R=J.union(O,L);var M=J.map(R,function(U){return N+U});var P=S.val();var T=P?P.split(","):[];var Q=J.union(T,M);if(Q.length>0){S.val(Q.join(","))}}function D(M){var L=J.extend({},A,m,M);if(!M.data){L=J.extend({},{initSelection:p,query:I(L)},L)}var N=y(L.orgElement);if(!N||N.length!==1){return L}if(!N.val()&&!L.manualInit){N.val(r)}N.addClass("select2-input");return L}function C(R,U,N){var M=U.data("select2").opts;var P=M.placeholder||U.data("placeholder");var T=E(U,M);var W=F(U,M);var L=l(U,M);var X=o(U,M);U.on("change",function(ad){b(T,ad.val,"space-cat:");b(W,ad.val,"content-function:");b(L,ad.val,"space:");b(X,ad.val,"page:")});U.val("");var ab=(U["0"].tagName==="SELECT")?(U.context.multiple):(M.multiple);var V=[];var Y=[];var ac=[];var O=[];var aa={};var Q=(R)?R.split(","):[];Q=J.filter(Q,function(ad){var ae=ad.split(":");if(ae.length===2){return true}else{if(ae.length<0||ae.length>=3||(ae.length===1&&(ae[0]!==r&&ae[0]!==P))){s.debug("Error value: "+ae)}}});R=Q.join(",");U.val(R);d(U,"space-cat:",M.spaceCatKeys,(T)?T.val():"");d(U,"content-function:",M.pageCatKeys,(W)?W.val():"");d(U,"space:",M.spaceKeys,(L)?L.val():"");d(U,"page:",M.pageIds,(X)?X.val():"");R=U.val();Q=(R)?R.split(","):[];b(T,Q,"space-cat:");b(W,Q,"content-function:");b(L,Q,"space:");b(X,Q,"page:");if(Q.length===0){return}J.each(Q,function(ad,ae){var ah=ad.split(":");if(ah.length===2){var ag=ah[0];var af=ah[1];if(ag==="space-cat"){V.push(af)}else{if(ag==="content-function"){ac.push(af)}else{if(ag==="space"){Y.push(af)}else{if(ag==="page"){O.push(af)}}}}}});J.each(V,function(ad){aa[k(ad)]=g(ad)});J.each(ac,function(ad){aa[j(ad)]=x(ad)});var Z=[];if(Y.length>0){var S=y.getJSON(s.contextPath()+"/rest/prototype/1/space",{spaceKey:Y}).done(function(af){var ad=[];J.each(af.space,function(ag){aa[v(ag.key)]=z(ag.key,J.escape(ag.name),null,true);ad.push(ag.key)});var ae=J.difference(Y,ad);J.each(ae,function(ag){aa[v(ag)]=z(ag,ag,null,false)})}).fail(function(){s.debug("Couldn't resolve spaceKeys:",Y);J.each(Y,function(ad){aa[v(ad)]=z(ad,ad,null,false)})});Z.push(S)}J.each(O,function(ad){var ae=y.getJSON(s.contextPath()+"/rest/api/content/"+ad,{expand:"space"}).done(function(af){aa[w(af.id)]=t(af.id,J.escape(af.title),J.escape(af.space.name),"content-type-page",true)}).fail(function(){s.debug("Couldn't resolve pageId:",ad);aa[w(ad)]=t(ad,ad,"","content-type-page",false)});Z.push(ae)});y.when.apply(y,J.map(Z,function(ae){var ad=new y.Deferred();ae.always(function(){ad.resolve()});return ad.promise()})).done(function(){N(K(Q,aa,ab))})}return{build:D,setValue:function(M,L){C(M,L,function(N){L.auiSelect2("data",N)})}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:space-page-picker', location = '/js/internal/space-page-picker-legacy.js' */
window.Confluence.UI.Components.SpacePagePicker=require("confluence-ui-components/js/space-page-picker");AJS.deprecate.prop(window.Confluence.UI.Components.SpacePagePicker,"build",{sinceVersion:"1.4.34",extraInfo:"Use require('confluence-ui-components/js/space-page-picker')"});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:space-page-picker', location = '/soy/space-page-picker.soy' */
// This file was automatically generated from space-page-picker.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.UI.Components.templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.UI == 'undefined') { Confluence.UI = {}; }
if (typeof Confluence.UI.Components == 'undefined') { Confluence.UI.Components = {}; }
if (typeof Confluence.UI.Components.templates == 'undefined') { Confluence.UI.Components.templates = {}; }


Confluence.UI.Components.templates.hiddenField = function(opt_data, opt_ignored) {
  return '<input type="hidden" id="' + soy.$$escapeHtml(opt_data.id) + '" name="' + soy.$$escapeHtml(opt_data.name) + '" />';
};
if (goog.DEBUG) {
  Confluence.UI.Components.templates.hiddenField.soyTemplateName = 'Confluence.UI.Components.templates.hiddenField';
}

}catch(e){WRMCB(e)};